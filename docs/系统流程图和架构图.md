# Barotrauma 反应堆模拟器系统流程图和架构图

## 1. 系统架构图

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           Barotrauma 反应堆模拟器                          │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌───────────────┐     ┌───────────────┐     ┌───────────────┐              │
│  │   用户界面层   │────>│  状态管理层   │────>│  物理模型层   │              │
│  │   (Svelte)    │     │  (reactorStore) │     │  (models/)    │              │
│  └───────────────┘     └───────────────┘     └───────────────┘              │
│                                                                             │
│  ┌───────────────┐     ┌───────────────┐     ┌───────────────┐              │
│  │  Web Workers  │<────│  状态管理层   │<────│  物理模型层   │              │
│  │  (计算密集型)  │     │  (reactorStore) │     │  (models/)    │              │
│  └───────────────┘     └───────────────┘     └───────────────┘              │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 2. 系统流程图

### 2.1 反应堆控制流程

```
┌─────────────────────────┐
│  开始模拟               │
└──────────┬──────────────┘
           ▼
┌─────────────────────────┐
│  读取当前状态           │
└──────────┬──────────────┘
           ▼
┌─────────────────────────┐
│  计算中子物理模型       │
│  - 空泡系数效应         │
│  - 氙中毒效应           │
│  - 控制棒效应           │
└──────────┬──────────────┘
           ▼
┌─────────────────────────┐
│  计算总反应性           │
└──────────┬──────────────┘
           ▼
┌─────────────────────────┐
│  更新反应堆功率         │
└──────────┬──────────────┘
           ▼
┌─────────────────────────┐
│  计算热工水力参数       │
│  - 质量平衡             │
│  - 能量平衡             │
│  - 水位控制             │
└──────────┬──────────────┘
           ▼
┌─────────────────────────┐
│  更新系统状态           │
└──────────┬──────────────┘
           ▼
┌─────────────────────────┐
│  检查故障和警报         │
└──────────┬──────────────┘
           ▼
┌─────────────────────────┐
│  生成趋势数据           │
└──────────┬──────────────┘
           ▼
┌─────────────────────────┐
│  渲染用户界面           │
└──────────┬──────────────┘
           ▼
┌─────────────────────────┐
│  等待下一个时间步长     │
└──────────┬──────────────┘
           ▼
┌─────────────────────────┐
│  结束当前时间步         │
└─────────────────────────┘
```

### 2.2 数据流程图

```
┌───────────────┐     ┌───────────────┐     ┌───────────────┐
│   用户输入     │────>│  状态管理层    │────>│  Web Workers  │
└───────────────┘     └───────────────┘     │  (计算密集型)  │
                                            └───────────────┘
                                                    │
                                                    ▼
┌───────────────┐     ┌───────────────┐     ┌───────────────┐
│   用户界面     │<────│  状态管理层    │<────│  物理模型层    │
└───────────────┘     └───────────────┘     └───────────────┘
```

## 3. 模块关系图

### 3.1 核心模块关系

```
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│  reactorStore   │────>│  workerManager  │────>│  physics models │
└─────────────────┘     └─────────────────┘     └─────────────────┘
       ^                        │                        │
       │                        │                        │
       └────────────────────────┘────────────────────────┘
```

### 3.2 物理模型模块关系

```
┌─────────────────┐     ┌─────────────────┐
│  voidCoefficient │────>│  xenonPoisoning │
└─────────────────┘     └─────────────────┘
       │                        │
       ▼                        │
┌─────────────────┐     ┌─────────────────┐
│  controlRodPhysics │<────│  reactorCore   │
└─────────────────┘     └─────────────────┘
```

## 4. 系统架构详细说明

### 4.1 前端架构

- **框架**: SvelteKit
- **状态管理**: Svelte stores (reactorStore)
- **样式**: Tailwind CSS
- **图表**: Chart.js

### 4.2 后端架构

- **计算引擎**: Web Workers
- **物理模型**: TypeScript 模块
- **状态管理**: Svelte stores

### 4.3 数据流

1. **用户输入** → 前端组件
2. **组件事件** → reactorStore
3. **状态更新** → workerManager
4. **计算请求** → Web Workers
5. **计算结果** → reactorStore
6. **状态变化** → 前端组件
7. **UI 更新** → 用户界面

## 5. 关键流程说明

### 5.1 启动流程

1. 初始化系统状态
2. 启动 Web Workers
3. 开始模拟循环
4. 渲染初始界面

### 5.2 停堆流程

1. 接收停堆指令
2. 插入控制棒
3. 监测反应性变化
4. 确认功率下降
5. 完成停堆操作

### 5.3 故障处理流程

1. 检测故障条件
2. 触发警报系统
3. 执行安全措施
4. 更新故障状态
5. 记录故障数据

## 6. 系统组件关系

```
┌────────────────────────────────────────────────────────────────────────────┐
│                                    系统组件                               │
├───────────────┬───────────────┬───────────────┬───────────────┬───────────────┤
│  反应堆核心    │  汽轮机系统   │  冷却系统     │  控制系统     │  监控系统     │
├───────────────┼───────────────┼───────────────┼───────────────┼───────────────┤
│  - 堆芯模型    │  - 汽轮机模型  │  - 泵模型     │  - PID控制    │  - 数据采集   │
│  - 中子物理    │  - 旁路系统    │  - 流量控制   │  - 逻辑控制   │  - 趋势分析   │
│  - 热工水力    │  - 发电机模型  │  - 温度控制   │  - 安全逻辑   │  - 警报系统   │
└───────────────┴───────────────┴───────────────┴───────────────┴───────────────┘
```

## 7. 总结

本系统流程图和架构图文档详细说明了 Barotrauma 反应堆模拟器的整体结构和关键流程，包括：

1. **系统架构**：前端-状态管理层-物理模型层-Web Workers 的分层结构
2. **核心流程**：反应堆控制、物理计算、状态更新、界面渲染
3. **模块关系**：reactorStore 作为中心，连接用户界面和物理模型
4. **数据流**：清晰的单向数据流，确保系统稳定性和可预测性

通过这种结构化的设计，模拟器能够准确模拟 RBMK-1000 反应堆的关键特性，包括正空泡系数、控制棒石墨尖端效应和氙中毒等复杂物理现象，为用户提供逼真的反应堆运行体验。

---

© 2026 lbn2011和ai共同开发

本系统流程图和架构图文档如有更新，恕不另行通知。