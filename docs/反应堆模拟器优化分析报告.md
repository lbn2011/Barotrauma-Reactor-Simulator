# Barotrauma反应堆模拟器详细优化分析报告

## 项目现状分析

基于对项目代码和切尔诺贝利遗产延续手册详细技术文档的深度分析，当前项目已经实现了一个功能相对完整的RBMK-1000反应堆模拟器，包括22个控制面板和基本的物理模拟系统。然而，通过与真实RBMK-1000系统和参考资料的对比，仍有较大的优化空间。

## 一、RBMK-1000反应堆技术特性深度分析

### 1.1 RBMK-1000核心设计特性

**真实RBMK-1000的关键特性**：
- **石墨慢化**：使用石墨作为慢化剂而非水，这是RBMK设计的核心特征
- **正空泡系数**：当反应堆形成空泡（水变成蒸汽）时，堆芯功率增加而非减少
- **在线换料**：世界上唯一具有此特点的商业动力堆之一（除加拿大CANDU外）
- **未浓缩铀燃料**：出于经济原因使用未浓缩铀，导致反应堆中毒问题
- **控制棒设计缺陷**：控制棒尖端使用石墨"水置换器"，导致紧急停堆时功率瞬间增加
- **缺乏安全壳结构**：没有压力密封的安全壳来容纳放射性物质

**当前模拟器状态**：
- 基本控制棒功能已实现，但缺乏真实的物理响应特性
- 缺乏正空泡系数效应的准确模拟
- 氙中毒效应有基础实现，但不够详细
- 控制棒响应时间与真实值不符（真实值需要30秒以上完全插入）

### 1.2 真实RBMK-1000技术参数

**反应堆核心参数**：
- 额定热输出：3000 MW
- 额定电输出：1000 MW
- 工作压力：约6.5-7.0 MPa
- 堆芯温度：正常运行时280-320°C
- 冷却剂流量：每回路约40,000 m³/h
- 控制棒数量：211根控制棒
- 控制棒插入速度：约0.5-1 cm/s
- 控制棒完全插入时间：30秒以上

**汽轮机参数**：
- 额定转速：3600 RPM（美国标准）/ 3000 RPM（欧洲标准）
- 涡轮机重量：数百吨
- 滑行停机时间：最长3小时
- 润滑油系统：必须持续运行，包括备用直流油泵
- 液压油系统：独立于润滑油系统

**辅助系统参数**：
- 凝汽器真空：应维持在95%以上（约0.05 MPa绝对压力）
- 除氧器压力：16-25 psig（约0.11-0.17 MPa）
- 除氧器水位：正常0英寸
- 热井水位：正常0英寸
- 凝结水储罐容量：每个960,000加仑（约3,634,000升）

## 二、真实性优化详细建议

### 2.1 物理模型深度优化

#### 2.1.1 热工水力模型增强

**当前状态**：
- 简单的线性模型（如温度 = 250 + 功率 × 0.8）
- 有限的系统间相互影响
- 缺乏真实的热工水力计算

**详细优化建议**：

**1. 实现质量守恒方程**
```typescript
// 质量守恒模型
interface MassBalanceModel {
  // 反应堆质量平衡
  reactorMassBalance: {
    inletFlow: number;      // 给水流量 (kg/s)
    outletFlow: number;     // 蒸汽流量 (kg/s)
    waterLevel: number;     // 水位 (m)
    pressure: number;       // 压力 (MPa)
    temperature: number;    // 温度 (°C)
  };
  
  // 凝汽器质量平衡
  condenserMassBalance: {
    steamInlet: number;     // 蒸汽入口 (kg/s)
    condensateOutlet: number; // 凝结水出口 (kg/s)
    coolingWaterFlow: number; // 冷却水流量 (kg/s)
    vacuumLevel: number;    // 真空度 (%)
  };
  
  // 除氧器质量平衡
  deaeratorMassBalance: {
    feedwaterInlet: number; // 给水入口 (kg/s)
    steamInlet: number;     // 蒸汽入口 (kg/s)
    outletFlow: number;     // 出口流量 (kg/s)
    level: number;          // 液位 (m)
    pressure: number;       // 压力 (MPa)
  };
}
```

**2. 实现能量守恒方程**
```typescript
// 能量守恒模型
interface EnergyBalanceModel {
  // 反应堆能量平衡
  reactorEnergyBalance: {
    nuclearPower: number;      // 核功率 (MW)
    thermalPower: number;      // 热功率 (MW)
    steamGeneration: number;   // 蒸汽生成量 (kg/s)
    coolantHeatCapacity: number; // 冷却剂热容 (kJ/kg·K)
    temperatureRise: number;   // 温升 (°C)
  };
  
  // 汽轮机能量平衡
  turbineEnergyBalance: {
    steamInletEnthalpy: number;   // 入口蒸汽焓 (kJ/kg)
    steamOutletEnthalpy: number;  // 出口蒸汽焓 (kJ/kg)
    mechanicalPower: number;     // 机械功率 (MW)
    efficiency: number;          // 效率 (%)
  };
  
  // 发电机能量平衡
  generatorEnergyBalance: {
    mechanicalInput: number;  // 机械输入 (MW)
    electricalOutput: number; // 电输出 (MW)
    losses: number;           // 损失 (MW)
    efficiency: number;       // 效率 (%)
  };
}
```

**3. 考虑冷却剂流动的阻力损失**
```typescript
// 流动阻力模型
interface FlowResistanceModel {
  // 管道流动阻力
  pipeResistance: {
    diameter: number;          // 管道直径 (m)
    length: number;           // 管道长度 (m)
    roughness: number;        // 粗糙度 (m)
    flowRate: number;         // 流量 (m³/s)
    pressureDrop: number;     // 压降 (Pa)
    reynoldsNumber: number;   // 雷诺数
    frictionFactor: number;    // 摩擦系数
  };
  
  // 泵性能特性
  pumpPerformance: {
    head: number;             // 扬程 (m)
    flowRate: number;         // 流量 (m³/s)
    power: number;            // 功率 (kW)
    efficiency: number;       // 效率 (%)
    npsr: number;             // 净正吸入扬程 (m)
  };
}
```

**4. 模拟不同压力下的水/蒸汽特性**
```typescript
// 水/蒸汽热力学特性
interface WaterSteamProperties {
  pressure: number;           // 压力 (MPa)
  temperature: number;        // 温度 (°C)
  saturationTemp: number;     // 饱和温度 (°C)
  enthalpyLiquid: number;    // 液体焓 (kJ/kg)
  enthalpyVapor: number;     // 蒸汽焓 (kJ/kg)
  entropyLiquid: number;     // 液体熵 (kJ/kg·K)
  entropyVapor: number;      // 蒸汽熵 (kJ/kg·K)
  densityLiquid: number;      // 液体密度 (kg/m³)
  densityVapor: number;      // 蒸汽密度 (kg/m³)
  voidFraction: number;      // 空泡分数
}

// 使用IAPWS-97公式计算水/蒸汽特性
function calculateWaterSteamProperties(pressure: number, temperature: number): WaterSteamProperties {
  // 实现IAPWS-97标准公式
  // 这里简化处理，实际应使用完整的热力学库
  const saturationTemp = calculateSaturationTemperature(pressure);
  const voidFraction = calculateVoidFraction(pressure, temperature);
  
  return {
    pressure,
    temperature,
    saturationTemp,
    enthalpyLiquid: calculateEnthalpyLiquid(pressure, temperature),
    enthalpyVapor: calculateEnthalpyVapor(pressure, temperature),
    entropyLiquid: calculateEntropyLiquid(pressure, temperature),
    entropyVapor: calculateEntropyVapor(pressure, temperature),
    densityLiquid: calculateDensityLiquid(pressure, temperature),
    densityVapor: calculateDensityVapor(pressure, temperature),
    voidFraction
  };
}
```

#### 2.1.2 中子物理模型增强

**1. 正空泡系数效应**
```typescript
// 正空泡系数模型
interface VoidCoefficientModel {
  baseReactivity: number;         // 基础反应性
  voidFraction: number;           // 空泡分数 (0-1)
  voidCoefficient: number;        // 空泡系数 (正数表示正空泡系数)
  powerChange: number;            // 功率变化
  feedbackDelay: number;          // 反馈延迟 (秒)
}

function calculateVoidCoefficientEffect(
  currentPower: number,
  voidFraction: number,
  voidCoefficient: number = 0.05  // RBMK典型值
): number {
  // 正空泡系数：空泡分数增加 -> 反应性增加 -> 功率增加
  const reactivityChange = voidCoefficient * voidFraction;
  const powerMultiplier = 1 + reactivityChange;
  
  return currentPower * powerMultiplier;
}
```

**2. 氙-135中毒效应**
```typescript
// 氙-135中毒模型
interface XenonPoisoningModel {
  xenonConcentration: number;     // 氙浓度
  iodineConcentration: number;    // 碘浓度
  neutronFlux: number;            // 中子通量
  powerLevel: number;             // 功率水平
  poisoningFactor: number;        // 中毒因子
  recoveryTime: number;           // 恢复时间 (小时)
}

// 氙-135动力学方程
function calculateXenonPoisoning(
  neutronFlux: number,
  timeStep: number,
  currentXenon: number,
  currentIodine: number
): { xenon: number; iodine: number } {
  // 氙-135产生率
  const xenonProductionRate = 0.0639 * currentIodine + 0.0003 * neutronFlux;
  
  // 氙-135衰变率
  const xenonDecayRate = 0.00011 * currentXenon + 0.000002 * neutronFlux * currentXenon;
  
  // 碘-135产生率和衰变率
  const iodineProductionRate = 0.064 * neutronFlux;
  const iodineDecayRate = 0.000103 * currentIodine;
  
  // 时间步进
  const newXenon = currentXenon + (xenonProductionRate - xenonDecayRate) * timeStep;
  const newIodine = currentIodine + (iodineProductionRate - iodineDecayRate) * timeStep;
  
  return { xenon: newXenon, iodine: newIodine };
}

// 计算氙中毒对反应性的影响
function calculateXenonReactivity(xenonConcentration: number): number {
  const xenonAbsorptionCrossSection = 2.65e6; // 靶
  const thermalNeutronFlux = 1e13; // n/cm²/s
  const reactivityLoss = -xenonConcentration * xenonAbsorptionCrossSection * thermalNeutronFlux;
  
  return reactivityLoss;
}
```

**3. 控制棒物理特性**
```typescript
// 控制棒物理模型
interface ControlRodPhysics {
  position: number;              // 位置 (0-100%)
  insertionSpeed: number;        // 插入速度 (cm/s)
  graphiteTipEffect: boolean;    // 石墨尖端效应
  displacementEffect: number;    // 水置换效应
  worth: number;                  // 反应性价值
  delayedResponse: number;       // 延迟响应时间 (秒)
}

// 控制棒插入时的功率瞬态
function calculateControlRodInsertionTransient(
  currentPower: number,
  insertionDepth: number,
  hasGraphiteTip: boolean = true
): { immediatePower: number; delayedPower: number } {
  // 石墨尖端效应：初始插入时功率短暂增加
  const graphiteTipPowerIncrease = hasGraphiteTip ? 
    Math.sin(insertionDepth * Math.PI / 20) * 0.1 : 0; // 前20%插入深度
  
  const immediatePower = currentPower * (1 + graphiteTipPowerIncrease);
  
  // 延迟的吸收效应
  const absorptionEffect = insertionDepth / 100;
  const delayedPower = currentPower * (1 - absorptionEffect);
  
  return {
    immediatePower,
    delayedPower
  };
}
```

#### 2.1.3 系统间耦合增强

**1. 给水系统-堆芯水位耦合**
```typescript
// 给水-堆芯耦合模型
interface FeedwaterCoreCoupling {
  feedwaterFlow: number;         // 给水流量 (kg/s)
  feedwaterTemperature: number;  // 给水温度 (°C)
  coreWaterLevel: number;        // 堆芯水位 (m)
  coreTemperature: number;      // 堆芯温度 (°C)
  steamGeneration: number;       // 蒸汽生成量 (kg/s)
  levelResponseTime: number;     // 水位响应时间 (秒)
}

function calculateCoreWaterLevel(
  feedwaterFlow: number,
  steamGeneration: number,
  currentLevel: number,
  timeStep: number
): number {
  const massBalance = feedwaterFlow - steamGeneration;
  const levelChange = massBalance * timeStep / CORE_CROSS_SECTION_AREA;
  
  return currentLevel + levelChange;
}
```

**2. 蒸汽压力-汽轮机效率耦合**
```typescript
// 蒸汽压力-汽轮机耦合模型
interface SteamPressureTurbineCoupling {
  steamPressure: number;          // 蒸汽压力 (MPa)
  steamTemperature: number;      // 蒸汽温度 (°C)
  turbineEfficiency: number;      // 汽轮机效率
  turbineLoad: number;            // 汽轮机负荷 (MW)
  steamFlow: number;              // 蒸汽流量 (kg/s)
}

function calculateTurbineEfficiency(
  steamPressure: number,
  steamTemperature: number,
  turbineLoad: number
): number {
  // 基于蒸汽参数的效率曲线
  const pressureFactor = Math.min(steamPressure / 7.0, 1.0); // 额定压力7.0 MPa
  const temperatureFactor = Math.min(steamTemperature / 280, 1.0); // 额定温度280°C
  const loadFactor = 0.8 + 0.2 * Math.sin(turbineLoad * Math.PI / 100); // 负荷效率曲线
  
  return 0.85 * pressureFactor * temperatureFactor * loadFactor;
}
```

**3. 凝结水温度-除氧器性能耦合**
```typescript
// 凝结水-除氧器耦合模型
interface CondensateDeaeratorCoupling {
  condensateTemperature: number;  // 凝结水温度 (°C)
  condensateFlow: number;        // 凝结水流量 (kg/s)
  deaeratorPressure: number;     // 除氧器压力 (MPa)
  deaeratorEfficiency: number;   // 除氧器效率
  oxygenContent: number;         // 含氧量 (ppb)
}

function calculateDeaeratorEfficiency(
  condensateTemperature: number,
  deaeratorPressure: number,
  steamFlow: number
): number {
  // 除氧器效率取决于温度和压力
  const saturationTemp = calculateSaturationTemperature(deaeratorPressure);
  const temperatureApproach = saturationTemp - condensateTemperature;
  
  // 温度接近度越小，效率越高
  const efficiencyFactor = Math.max(0, 1 - temperatureApproach / 10);
  
  return 0.95 * efficiencyFactor;
}
```

### 2.2 系统完整性详细优化

#### 2.2.1 完善系统细节

**1. 蒸汽发生器水位控制系统**
```typescript
// 蒸汽发生器水位控制
interface SteamGeneratorLevelControl {
  level: number;                  // 水位 (m)
  setpoint: number;               // 设定值 (m)
  feedwaterFlow: number;          // 给水流量 (kg/s)
  steamFlow: number;              // 蒸汽流量 (kg/s)
  controlMode: 'single' | 'three-element'; // 控制模式
  levelAlarm: {
    high: number;                 // 高水位警报
    low: number;                  // 低水位警报
    highHigh: number;             // 高高水位警报
    lowLow: number;               // 低低水位警报
  };
}

// 三冲量水位控制
function threeElementLevelControl(
  level: number,
  steamFlow: number,
  feedwaterFlow: number,
  setpoint: number
): number {
  const levelError = setpoint - level;
  const flowError = steamFlow - feedwaterFlow;
  
  // PID控制器
  const levelController = calculatePID(levelError);
  const flowController = calculatePID(flowError);
  
  return levelController + flowController;
}
```

**2. 汽轮机旁路系统**
```typescript
// 汽轮机旁路系统
interface TurbineBypassSystem {
  bypassValves: {
    position: number;             // 阀门位置 (0-100%)
    capacity: number;             // 容量 (kg/s)
    pressureSetpoint: number;     // 压力设定点 (MPa)
  };
  steamPressure: number;          // 蒸汽压力 (MPa)
  turbineStatus: 'online' | 'offline' | 'bypassing';
}

function controlBypassSystem(
  steamPressure: number,
  pressureSetpoint: number,
  turbineStatus: string
): number {
  if (turbineStatus === 'offline') {
    // 汽轮机离线时，旁路阀控制压力
    const pressureError = steamPressure - pressureSetpoint;
    const valvePosition = calculateBypassValvePosition(pressureError);
    return valvePosition;
  } else if (steamPressure > pressureSetpoint * 1.05) {
    // 压力过高时部分旁路
    return Math.min((steamPressure - pressureSetpoint) / pressureSetpoint * 50, 100);
  }
  return 0;
}
```

**3. 堆芯冷却剂净化系统**
```typescript
// 冷却剂净化系统
interface CoolantPurificationSystem {
  flowRate: number;              // 流量 (kg/s)
  efficiency: number;            // 净化效率 (%)
  impurityLevel: number;         // 杂质水平 (ppm)
  filterStatus: {
    filter1: 'online' | 'offline' | 'regenerating';
    filter2: 'online' | 'offline' | 'regenerating';
  };
  chemicalAddition: {
    boricAcid: number;           // 硼酸添加量 (kg/h)
    pHControl: number;           // pH控制剂添加量 (kg/h)
  };
}

function calculatePurificationEfficiency(
  flowRate: number,
  impurityLevel: number,
  filterEfficiency: number
): number {
  // 净化效率取决于流量和杂质水平
  const flowFactor = Math.min(flowRate / MAX_FLOW_RATE, 1.0);
  const impurityFactor = Math.max(0, 1 - impurityLevel / MAX_IMPURITY_LEVEL);
  
  return filterEfficiency * flowFactor * impurityFactor;
}
```

#### 2.2.2 实现真实的启动流程

**基于手册的15步启动程序详细实现**：

**启动前准备阶段**：
```typescript
// 启动前检查清单
interface StartupPreparation {
  // 第1步：屏幕视图优化
  viewOptimization: {
    schematicDisplay: boolean;   // 示意图显示
    trendDisplay: boolean;       // 趋势显示
    alarmDisplay: boolean;       // 警报显示
  };
  
  // 第2步：趋势设置
  trendSetup: {
    reactorWaterLevel: { color: 'red'; enabled: boolean };
    deaeratorLevel: { color: 'lightgreen'; enabled: boolean };
    hotwellLevel: { color: 'darkgreen'; enabled: boolean };
    feedwaterFlow: { color: 'blue'; enabled: boolean };
    steamFlow: { color: 'magenta'; enabled: boolean };
    neutronRate: { color: 'white'; enabled: boolean };
    neutronFlux: { color: 'lightblue'; enabled: boolean };
    thermalPower: { color: 'darkgray'; enabled: boolean };
    condenserVacuum: { color: 'yellow'; enabled: boolean };
    generatorLoad: { color: 'bluegray'; enabled: boolean };
  };
  
  // 第3步：凝结水储罐检查
  condensateTanks: {
    tank1Level: number;          // 罐1水位 (%)
    tank2Level: number;          // 罐2水位 (%)
    minimumRequired: 50;         // 最低要求 (%)
  };
  
  // 第4步：热井水位检查
  hotwellWaterLevel: {
    level: number;               // 水位 (英寸)
    setpoint: number;            // 设定值 (英寸)
    controlMode: 'auto' | 'manual';
  };
}

function performStartupPreparation(): StartupPreparation {
  return {
    viewOptimization: {
      schematicDisplay: true,
      trendDisplay: true,
      alarmDisplay: true
    },
    trendSetup: {
      reactorWaterLevel: { color: 'red', enabled: true },
      deaeratorLevel: { color: 'lightgreen', enabled: true },
      hotwellLevel: { color: 'darkgreen', enabled: true },
      feedwaterFlow: { color: 'blue', enabled: true },
      steamFlow: { color: 'magenta', enabled: true },
      neutronRate: { color: 'white', enabled: true },
      neutronFlux: { color: 'lightblue', enabled: true },
      thermalPower: { color: 'darkgray', enabled: true },
      condenserVacuum: { color: 'yellow', enabled: true },
      generatorLoad: { color: 'bluegray', enabled: true }
    },
    condensateTanks: {
      tank1Level: 60,
      tank2Level: 60,
      minimumRequired: 50
    },
    hotwellWaterLevel: {
      level: 0,
      setpoint: 0,
      controlMode: 'auto'
    }
  };
}
```

**系统启动阶段**：
```typescript
// 系统启动程序
interface SystemStartupProcedure {
  // 第5步：启动凝结水泵
  condensatePumpStartup: {
    pumpNumber: 1 | 2 | 3;
    status: 'starting' | 'running' | 'stopped';
    flowRate: number;            // 流量 (GPM)
    dischargePressure: number;    // 排放压力 (psig)
  };
  
  // 第6步：除氧器注水
  deaeratorFilling: {
    level: number;               // 水位 (英寸)
    controlMode: 'manual' | 'auto';
    flowValvePosition: number;   // 流量阀位置 (%)
  };
  
  // 第7步：凝结水精处理系统
  condensatePolisher: {
    polisher1: { status: string; efficiency: number };
    polisher2: { status: string; efficiency: number };
    regenerationMode: boolean;
  };
  
  // 第8步：凝汽器循环水泵
  condenserCirculationPump: {
    pumpNumber: 1 | 2;
    status: 'starting' | 'running' | 'stopped';
    flowRate: number;            // 流量 (GPM)
    minimumRequired: 500000;     // 最低要求 (GPM)
  };
  
  // 第9步：HEPA过滤器检查
  hepaFilterCheck: {
    status: 'online' | 'offline' | 'bypass';
    bypassFlow: number;          // 旁路流量
    radiationLevel: number;      // 辐射水平 (雷姆)
    filterEfficiency: number;    // 过滤器效率 (%)
  };
}

async function executeSystemStartup(): Promise<SystemStartupProcedure> {
  // 启动凝结水泵
  const condensatePump = await startCondensatePump(1);
  
  // 除氧器注水
  const deaerator = await fillDeaerator();
  
  // 启动凝结水精处理系统
  const polisher = await startCondensatePolisher();
  
  // 启动凝汽器循环水泵
  const circulationPump = await startCondenserCirculationPump(1);
  
  // 检查HEPA过滤器
  const hepaFilter = await checkHEPAFilter();
  
  return {
    condensatePumpStartup: condensatePump,
    deaeratorFilling: deaerator,
    condensatePolisher: polisher,
    condenserCirculationPump: circulationPump,
    hepaFilterCheck: hepaFilter
  };
}
```

**反应堆启动阶段**：
```typescript
// 反应堆启动程序
interface ReactorStartupProcedure {
  // 第10步：反应堆给水泵
  reactorFeedPump: {
    pumpNumber: 1 | 2 | 3;
    status: 'starting' | 'running' | 'stopped';
    flowRate: number;            // 流量 (GPM)
    dischargePressure: number;    // 排放压力 (psig)
  };
  
  // 第11步：反应堆鼓水位控制
  drumLevelControl: {
    controlMode: 'single' | 'three-element';
    activeValve: 'startup' | 'main';
    setpoint: number;            // 设定值 (%)
    currentLevel: number;        // 当前水位 (%)
  };
  
  // 第12步：紧急堆芯冷却系统
  emergencyCoreCooling: {
    status: 'standby' | 'active' | 'offline';
    autoMode: boolean;
    pump1: { status: string; flowRate: number };
    pump2: { status: string; flowRate: number };
    dieselPump: { status: string; flowRate: number };
  };
  
  // 第13步：反应堆紧急停堆控制
  reactorScramControl: {
    status: 'armed' | 'disarmed';
    protectionCircuits: string[];
    lastScramTime: number;
  };
  
  // 第14步：再循环泵启动
  recirculationPump: {
    loop1: { pump1: string; pump2: string };
    loop2: { pump1: string; pump2: string };
    minimumRequired: 'one_per_loop';
  };
}

async function executeReactorStartup(): Promise<ReactorStartupProcedure> {
  // 启动反应堆给水泵
  const feedPump = await startReactorFeedPump(1);
  
  // 设置反应堆鼓水位控制
  const drumLevel = await setupDrumLevelControl();
  
  // 检查紧急堆芯冷却系统
  const eccSystem = await checkEmergencyCoreCooling();
  
  // 检查反应堆紧急停堆控制
  const scramControl = await checkReactorScramControl();
  
  // 启动再循环泵
  const recircPumps = await startRecirculationPumps();
  
  return {
    reactorFeedPump: feedPump,
    drumLevelControl: drumLevel,
    emergencyCoreCooling: eccSystem,
    reactorScramControl: scramControl,
    recirculationPump: recircPumps
  };
}
```

**汽轮机启动阶段**：
```typescript
// 汽轮机启动程序
interface TurbineStartupProcedure {
  // 第15步：停止离线堆芯冷却
  offlineCoreCooling: {
    status: 'stopping' | 'stopped';
    inletValve: 'open' | 'closed';
    outletValve: 'open' | 'closed';
  };
  
  // 第16步：除氧器蒸汽供应
  deaeratorSteamSupply: {
    pressure: number;            // 压力 (psig)
    setpoint: number;            // 设定值 (psig)
    controlMode: 'auto' | 'manual';
    exhaustValvePosition: number; // 排气阀位置 (%)
  };
  
  // 第17步：主蒸汽排放控制
  mainSteamDump: {
    pressureSetpoint: number;    // 压力设定点 (psig)
    valvePosition: number;       // 阀门位置 (%)
    controlMode: 'auto' | 'manual';
  };
  
  // 第18步：反应堆疏水控制
  reactorDrain: {
    levelSetpoint: number;       // 水位设定点 (英寸)
    valvePosition: number;       // 阀门位置 (%)
    controlMode: 'auto' | 'manual';
  };
  
  // 第19步：涡轮机辅助系统
  turbineAuxiliary: {
    lubricationOil: {
      systemStatus: 'starting' | 'running' | 'stopped';
      pressure: number;          // 压力 (psig)
      temperature: number;       // 温度 (°C)
      backupSystem: 'standby' | 'active';
    };
    hydraulicOil: {
      systemStatus: 'starting' | 'running' | 'stopped';
      pressure: number;          // 压力 (psig)
      valveControl: 'normal' | 'emergency';
    };
    turningGear: {
      status: 'engaged' | 'disengaged';
      rpm: number;               // 转速 (RPM)
    };
    steamSeal: {
      status: 'starting' | 'running' | 'stopped';
      pressure: number;          // 压力 (psig)
    };
  };
}

async function executeTurbineStartup(): Promise<TurbineStartupProcedure> {
  // 停止离线堆芯冷却
  const offlineCooling = await stopOfflineCoreCooling();
  
  // 设置除氧器蒸汽供应
  const deaeratorSteam = await setupDeaeratorSteamSupply();
  
  // 设置主蒸汽排放控制
  const steamDump = await setupMainSteamDump();
  
  // 设置反应堆疏水控制
  const reactorDrain = await setupReactorDrain();
  
  // 启动涡轮机辅助系统
  const turbineAux = await startTurbineAuxiliary();
  
  return {
    offlineCoreCooling: offlineCooling,
    deaeratorSteamSupply: deaeratorSteam,
    mainSteamDump: steamDump,
    reactorDrain: reactorDrain,
    turbineAuxiliary: turbineAux
  };
}
```

**临界和并网阶段**：
```typescript
// 临界和并网程序
interface CriticalityAndGridConnection {
  // 第20步：真空系统启动
  vacuumSystem: {
    status: 'starting' | 'running' | 'stopped';
    vacuumLevel: number;        // 真空度 (%)
    vacuumBreaker: 'open' | 'closed';
    minimumSteamPressure: 250;  // 最低蒸汽压力 (psig)
  };
  
  // 第21步：蒸汽压力建立
  steamPressureBuildup: {
    currentPressure: number;     // 当前压力 (psig)
    targetPressure: number;     // 目标压力 (psig)
    dumpValvePosition: number;   // 排放阀位置 (%)
  };
  
  // 第22步：涡轮机复位
  turbineReset: {
    status: 'resetting' | 'reset' | 'failed';
    speedSetpoint: number;       // 速度设定点 (RPM)
    clearanceConditions: string[];
  };
  
  // 第23步：反应堆功率控制设置
  reactorPowerControl: {
    autoControl: boolean;
    powerSetpoint: number;       // 功率设定点 (%)
    scramReset: boolean;
  };
  
  // 第24步：控制棒提升
  controlRodWithdrawal: {
    mode: 'center_only' | 'all_rods';
    speed: 'slow' | 'medium' | 'fast';
    criticalityStatus: 'subcritical' | 'critical' | 'supercritical';
    negativeLogFlux: number;     // 负对数通量
  };
  
  // 第25步：涡轮机启动
  turbineStartup: {
    mode: 'auto' | 'manual';
    currentSpeed: number;        // 当前转速 (RPM)
    speedStops: [900, 1800, 2700, 3600];
    vibration: number;           // 振动 (mm/s)
    differentialExpansion: number; // 差胀 (mm)
  };
  
  // 第26步：发电机同步
  generatorSynchronization: {
    syncIndicator: 'off' | 'rotating' | 'stable';
    syncSpeed: number;           // 同步速度 (RPM)
    breakerStatus: 'open' | 'closed';
    syncAngle: number;           // 同步角度 (度)
  };
}

async function executeCriticalityAndGridConnection(): Promise<CriticalityAndGridConnection> {
  // 启动真空系统
  const vacuumSystem = await startVacuumSystem();
  
  // 建立蒸汽压力
  const steamPressure = await buildSteamPressure();
  
  // 涡轮机复位
  const turbineReset = await resetTurbine();
  
  // 设置反应堆功率控制
  const powerControl = await setupReactorPowerControl();
  
  // 控制棒提升
  const rodWithdrawal = await withdrawControlRods();
  
  // 涡轮机启动
  const turbineStartup = await startupTurbine();
  
  // 发电机同步
  const generatorSync = await synchronizeGenerator();
  
  return {
    vacuumSystem,
    steamPressureBuildup: steamPressure,
    turbineReset,
    reactorPowerControl: powerControl,
    controlRodWithdrawal: rodWithdrawal,
    turbineStartup,
    generatorSynchronization: generatorSync
  };
}
```

#### 2.2.3 增强故障模拟

**1. 管道破裂故障**
```typescript
// 管道破裂故障模型
interface PipeRuptureFault {
  location: 'primary' | 'secondary' | 'feedwater' | 'steam';
  ruptureSize: 'small' | 'medium' | 'large' | 'catastrophic';
  ruptureArea: number;           // 破裂面积 (cm²)
  leakRate: number;              // 泄漏率 (kg/s)
  pressureDrop: number;          // 压降 (MPa)
  waterLoss: number;             // 水损失 (kg)
  detectionTime: number;         // 检测时间 (秒)
  isolationStatus: 'detected' | 'isolating' | 'isolated' | 'failed';
}

function simulatePipeRupture(
  location: string,
  ruptureSize: string,
  systemPressure: number
): PipeRuptureFault {
  const ruptureAreas = {
    small: 10,
    medium: 50,
    large: 200,
    catastrophic: 1000
  };
  
  const ruptureArea = ruptureAreas[ruptureSize as keyof typeof ruptureAreas];
  const leakRate = calculateLeakRate(ruptureArea, systemPressure);
  const pressureDrop = calculatePressureDrop(leakRate, location);
  
  return {
    location: location as any,
    ruptureSize: ruptureSize as any,
    ruptureArea,
    leakRate,
    pressureDrop,
    waterLoss: 0,
    detectionTime: calculateDetectionTime(ruptureSize),
    isolationStatus: 'detected'
  };
}

function calculateLeakRate(area: number, pressure: number): number {
  // 使用伯努利方程计算泄漏率
  const dischargeCoefficient = 0.6;
  const waterDensity = 1000; // kg/m³
  const gravity = 9.81; // m/s²
  
  return dischargeCoefficient * area * Math.sqrt(2 * pressure * 1e6 / waterDensity);
}
```

**2. 泵故障**
```typescript
// 泵故障模型
interface PumpFault {
  pumpId: string;
  faultType: 'mechanical' | 'electrical' | 'cavitation' | 'seal_failure';
  severity: 'minor' | 'major' | 'catastrophic';
  status: 'running' | 'degraded' | 'failed' | 'tripped';
  performance: {
    flowRate: number;            // 流量 (% of rated)
    head: number;                // 扬程 (% of rated)
    efficiency: number;          // 效率 (%)
    vibration: number;           // 振动 (mm/s)
    temperature: number;         // 温度 (°C)
  };
  faultTime: number;             // 故障时间 (秒)
  recoveryTime: number;          // 恢复时间 (秒)
}

function simulatePumpFault(
  pumpId: string,
  faultType: string,
  currentPerformance: any
): PumpFault {
  const faultEffects = {
    mechanical: {
      flowRate: 0.5,
      head: 0.6,
      efficiency: 0.4,
      vibration: 10,
      temperature: 80
    },
    electrical: {
      flowRate: 0,
      head: 0,
      efficiency: 0,
      vibration: 0,
      temperature: 25
    },
    cavitation: {
      flowRate: 0.7,
      head: 0.5,
      efficiency: 0.3,
      vibration: 15,
      temperature: 60
    },
    seal_failure: {
      flowRate: 0.8,
      head: 0.9,
      efficiency: 0.7,
      vibration: 5,
      temperature: 70
    }
  };
  
  const effects = faultEffects[faultType as keyof typeof faultEffects];
  
  return {
    pumpId,
    faultType: faultType as any,
    severity: 'major',
    status: 'degraded',
    performance: {
      flowRate: currentPerformance.flowRate * effects.flowRate,
      head: currentPerformance.head * effects.head,
      efficiency: currentPerformance.efficiency * effects.efficiency,
      vibration: effects.vibration,
      temperature: effects.temperature
    },
    faultTime: Date.now(),
    recoveryTime: calculateRecoveryTime(faultType)
  };
}
```

**3. 紧急停堆（SCRAM）过程**
```typescript
// 紧急停堆模型
interface ScramProcedure {
  triggerReason: string;
  triggerTime: number;
  scramType: 'automatic' | 'manual' | 'emergency';
  controlRodInsertion: {
    totalRods: number;
    insertedRods: number;
    insertionProgress: number;    // 插入进度 (%)
    estimatedTime: number;        // 预计时间 (秒)
    powerReduction: number;      // 功率降低 (%)
  };
  safetySystems: {
    eccSystem: 'standby' | 'activating' | 'active';
    containmentIsolation: 'normal' | 'isolating' | 'isolated';
    ventilation: 'normal' | 'emergency' | 'filtered';
    electricalBackup: 'normal' | 'battery' | 'generator';
  };
  postScramStatus: {
    reactorStatus: string;
    coreTemperature: number;
    pressure: number;
    waterLevel: number;
    radiationLevel: number;
  };
}

function executeScram(
  triggerReason: string,
  scramType: string,
  currentReactorState: any
): ScramProcedure {
  const triggerTime = Date.now();
  const totalRods = 211;
  const insertionTime = 35; // 秒
  
  return {
    triggerReason,
    triggerTime,
    scramType: scramType as any,
    controlRodInsertion: {
      totalRods,
      insertedRods: 0,
      insertionProgress: 0,
      estimatedTime: insertionTime,
      powerReduction: 0
    },
    safetySystems: {
      eccSystem: 'activating',
      containmentIsolation: 'isolating',
      ventilation: 'filtered',
      electricalBackup: 'normal'
    },
    postScramStatus: {
      reactorStatus: 'SCRAMMING',
      coreTemperature: currentReactorState.core.temperature,
      pressure: currentReactorState.core.pressure,
      waterLevel: currentReactorState.core.waterLevel,
      radiationLevel: currentReactorState.radiation.level
    }
  };
}

function updateScramProgress(scram: ScramProcedure, deltaTime: number): ScramProcedure {
  const progress = deltaTime / scram.controlRodInsertion.estimatedTime;
  const newProgress = Math.min(scram.controlRodInsertion.insertionProgress + progress, 1.0);
  
  // 石墨尖端效应：前20%插入时功率短暂增加
  let powerMultiplier = 1.0;
  if (newProgress < 0.2) {
    powerMultiplier = 1 + Math.sin(newProgress * Math.PI / 0.2) * 0.1;
  }
  
  // 主要吸收效应
  const absorptionEffect = newProgress * 0.9;
  powerMultiplier *= (1 - absorptionEffect);
  
  return {
    ...scram,
    controlRodInsertion: {
      ...scram.controlRodInsertion,
      insertedRods: Math.floor(scram.controlRodInsertion.totalRods * newProgress),
      insertionProgress: newProgress,
      powerReduction: (1 - powerMultiplier) * 100
    }
  };
}
```

### 2.3 参数真实性详细校准

#### 2.3.1 反应堆核心参数

**真实RBMK-1000参数范围**：
```typescript
// 反应堆核心参数校准
interface ReactorCoreParameters {
  // 温度参数
  temperature: {
    normalOperating: { min: 280; max: 320; unit: '°C' };
    alarm: { high: 330; critical: 350; unit: '°C' };
    scram: { temperature: 360; unit: '°C' };
  };
  
  // 压力参数
  pressure: {
    normalOperating: { min: 6.0; max: 7.5; unit: 'MPa' };
    alarm: { high: 7.8; critical: 8.0; unit: 'MPa' };
    scram: { pressure: 8.5; unit: 'MPa' };
  };
  
  // 水位参数
  waterLevel: {
    normalOperating: { min: 65; max: 75; unit: '%' };
    alarm: { high: 85; low: 55; unit: '%' };
    scram: { high: 90; low: 45; unit: '%' };
  };
  
  // 功率参数
  power: {
    normalOperating: { min: 0; max: 100; unit: '%' };
    alarm: { high: 105; unit: '%' };
    scram: { power: 120; unit: '%' };
  };
  
  // 中子参数
  neutron: {
    flux: {
      normalOperating: { min: 1e13; max: 3e14; unit: 'n/cm²/s' };
      scram: { flux: 5e14; unit: 'n/cm²/s' };
    };
    rate: {
      normalOperating: { min: -10; max: 10; unit: '%/s' };
      scram: { rate: 20; unit: '%/s' };
    };
  };
}

const REACTOR_CORE_PARAMETERS: ReactorCoreParameters = {
  temperature: {
    normalOperating: { min: 280, max: 320, unit: '°C' },
    alarm: { high: 330, critical: 350, unit: '°C' },
    scram: { temperature: 360, unit: '°C' }
  },
  pressure: {
    normalOperating: { min: 6.0, max: 7.5, unit: 'MPa' },
    alarm: { high: 7.8, critical: 8.0, unit: 'MPa' },
    scram: { pressure: 8.5, unit: 'MPa' }
  },
  waterLevel: {
    normalOperating: { min: 65, max: 75, unit: '%' },
    alarm: { high: 85, low: 55, unit: '%' },
    scram: { high: 90, low: 45, unit: '%' }
  },
  power: {
    normalOperating: { min: 0, max: 100, unit: '%' },
    alarm: { high: 105, unit: '%' },
    scram: { power: 120, unit: '%' }
  },
  neutron: {
    flux: {
      normalOperating: { min: 1e13, max: 3e14, unit: 'n/cm²/s' },
      scram: { flux: 5e14, unit: 'n/cm²/s' }
    },
    rate: {
      normalOperating: { min: -10, max: 10, unit: '%/s' },
      scram: { rate: 20, unit: '%/s' }
    }
  }
};
```

#### 2.3.2 汽轮机参数

**真实汽轮机参数范围**：
```typescript
// 汽轮机参数校准
interface TurbineParameters {
  // 转速参数
  speed: {
    normalOperating: { min: 3580; max: 3620; unit: 'RPM' };
    alarm: { high: 3650; low: 3550; unit: 'RPM' };
    trip: { overspeed: 3960; unit: 'RPM' };
  };
  
  // 振动参数
  vibration: {
    normalOperating: { max: 0.05; unit: 'mm/s' };
    alarm: { high: 0.08; unit: 'mm/s' };
    trip: { vibration: 0.12; unit: 'mm/s' };
  };
  
  // 差胀参数
  differentialExpansion: {
    normalOperating: { min: -2; max: 2; unit: 'mm' };
    alarm: { high: 3; low: -3; unit: 'mm' };
    trip: { high: 4; low: -4; unit: 'mm' };
  };
  
  // 负荷参数
  load: {
    normalOperating: { min: 0; max: 1000; unit: 'MW' };
    rampRate: { max: 10; unit: 'MW/min' };
  };
  
  // 蒸汽参数
  steam: {
    inletPressure: {
      normalOperating: { min: 6.0; max: 7.5; unit: 'MPa' };
      alarm: { high: 7.8; unit: 'MPa' };
    };
    inletTemperature: {
      normalOperating: { min: 270; max: 290; unit: '°C' };
      alarm: { high: 300; unit: '°C' };
    };
    exhaustPressure: {
      normalOperating: { max: 0.01; unit: 'MPa' };
      alarm: { high: 0.02; unit: 'MPa' };
    };
  };
}

const TURBINE_PARAMETERS: TurbineParameters = {
  speed: {
    normalOperating: { min: 3580, max: 3620, unit: 'RPM' },
    alarm: { high: 3650, low: 3550, unit: 'RPM' },
    trip: { overspeed: 3960, unit: 'RPM' }
  },
  vibration: {
    normalOperating: { max: 0.05, unit: 'mm/s' },
    alarm: { high: 0.08, unit: 'mm/s' },
    trip: { vibration: 0.12, unit: 'mm/s' }
  },
  differentialExpansion: {
    normalOperating: { min: -2, max: 2, unit: 'mm' },
    alarm: { high: 3, low: -3, unit: 'mm' },
    trip: { high: 4, low: -4, unit: 'mm' }
  },
  load: {
    normalOperating: { min: 0, max: 1000, unit: 'MW' },
    rampRate: { max: 10, unit: 'MW/min' }
  },
  steam: {
    inletPressure: {
      normalOperating: { min: 6.0, max: 7.5, unit: 'MPa' },
      alarm: { high: 7.8, unit: 'MPa' }
    },
    inletTemperature: {
      normalOperating: { min: 270, max: 290, unit: '°C' },
      alarm: { high: 300, unit: '°C' }
    },
    exhaustPressure: {
      normalOperating: { max: 0.01, unit: 'MPa' },
      alarm: { high: 0.02, unit: 'MPa' }
    }
  }
};
```

#### 2.3.3 辅助系统参数

**真实辅助系统参数范围**：
```typescript
// 辅助系统参数校准
interface AuxiliarySystemParameters {
  // 凝汽器参数
  condenser: {
    vacuum: {
      normalOperating: { min: 95; max: 99; unit: '%' };
      alarm: { low: 90; unit: '%' };
      trip: { vacuum: 85; unit: '%' };
    };
    hotwellLevel: {
      normalOperating: { min: -1; max: 1; unit: 'inches' };
      alarm: { high: 3; low: -3; unit: 'inches' };
    };
    coolingWater: {
      temperature: {
        inlet: { normal: 25; max: 35; unit: '°C' };
        outlet: { normal: 35; max: 45; unit: '°C' };
      };
      flow: {
        normalOperating: { min: 400000; max: 600000; unit: 'GPM' };
        alarm: { low: 350000; unit: 'GPM' };
      };
    };
  };
  
  // 除氧器参数
  deaerator: {
    pressure: {
      normalOperating: { min: 0.11; max: 0.17; unit: 'MPa' };
      alarm: { high: 0.18; low: 0.10; unit: 'MPa' };
    };
    level: {
      normalOperating: { min: -1; max: 1; unit: 'inches' };
      alarm: { high: 3; low: -3; unit: 'inches' };
    };
    temperature: {
      normalOperating: { min: 100; max: 120; unit: '°C' };
      alarm: { high: 125; unit: '°C' };
    };
  };
  
  // 给水泵参数
  feedwaterPump: {
    dischargePressure: {
      normalOperating: { min: 7.5; max: 9.0; unit: 'MPa' };
      alarm: { low: 7.0; unit: 'MPa' };
    };
    flow: {
      normalOperating: { min: 50000; max: 80000; unit: 'kg/h' };
      alarm: { low: 45000; unit: 'kg/h' };
    };
    vibration: {
      normalOperating: { max: 0.05; unit: 'mm/s' };
      alarm: { high: 0.08; unit: 'mm/s' };
    };
  };
  
  // 应急冷却系统参数
  emergencyCooling: {
    pumpFlow: {
      required: { min: 8500000; unit: 'lb/h' };
      actual: { current: number; unit: 'lb/h' };
    };
    activationTime: {
      automatic: { max: 5; unit: 'seconds' };
      manual: { max: 10; unit: 'seconds' };
    };
  };
}

const AUXILIARY_SYSTEM_PARAMETERS: AuxiliarySystemParameters = {
  condenser: {
    vacuum: {
      normalOperating: { min: 95, max: 99, unit: '%' },
      alarm: { low: 90, unit: '%' },
      trip: { vacuum: 85, unit: '%' }
    },
    hotwellLevel: {
      normalOperating: { min: -1, max: 1, unit: 'inches' },
      alarm: { high: 3, low: -3, unit: 'inches' }
    },
    coolingWater: {
      temperature: {
        inlet: { normal: 25, max: 35, unit: '°C' },
        outlet: { normal: 35, max: 45, unit: '°C' }
      },
      flow: {
        normalOperating: { min: 400000, max: 600000, unit: 'GPM' },
        alarm: { low: 350000, unit: 'GPM' }
      }
    }
  },
  deaerator: {
    pressure: {
      normalOperating: { min: 0.11, max: 0.17, unit: 'MPa' },
      alarm: { high: 0.18, low: 0.10, unit: 'MPa' }
    },
    level: {
      normalOperating: { min: -1, max: 1, unit: 'inches' },
      alarm: { high: 3, low: -3, unit: 'inches' }
    },
    temperature: {
      normalOperating: { min: 100, max: 120, unit: '°C' },
      alarm: { high: 125, unit: '°C' }
    }
  },
  feedwaterPump: {
    dischargePressure: {
      normalOperating: { min: 7.5, max: 9.0, unit: 'MPa' },
      alarm: { low: 7.0, unit: 'MPa' }
    },
    flow: {
      normalOperating: { min: 50000, max: 80000, unit: 'kg/h' },
      alarm: { low: 45000, unit: 'kg/h' }
    },
    vibration: {
      normalOperating: { max: 0.05, unit: 'mm/s' },
      alarm: { high: 0.08, unit: 'mm/s' }
    }
  },
  emergencyCooling: {
    pumpFlow: {
      required: { min: 8500000, unit: 'lb/h' },
      actual: { current: 0, unit: 'lb/h' }
    },
    activationTime: {
      automatic: { max: 5, unit: 'seconds' },
      manual: { max: 10, unit: 'seconds' }
    }
  }
};
```

#### 2.3.4 响应时间校准

**真实系统响应时间**：
```typescript
// 系统响应时间校准
interface SystemResponseTimes {
  // 控制棒响应
  controlRods: {
    insertionSpeed: { min: 0.5; max: 1.0; unit: 'cm/s' };
    fullInsertionTime: { min: 30; max: 45; unit: 'seconds' };
    withdrawalSpeed: { min: 0.5; max: 1.0; unit: 'cm/s' };
  };
  
  // 泵响应
  pumps: {
    startupTime: { normal: 7; max: 15; unit: 'seconds' };
    tripTime: { max: 2; unit: 'seconds' };
    flowChangeTime: { max: 10; unit: 'seconds' };
  };
  
  // 阀门响应
  valves: {
    small: { openCloseTime: { min: 1; max: 3; unit: 'seconds' } };
    medium: { openCloseTime: { min: 3; max: 10; unit: 'seconds' } };
    large: { openCloseTime: { min: 10; max: 30; unit: 'seconds' } };
    emergency: { openCloseTime: { max: 1; unit: 'seconds' } };
  };
  
  // 温度响应
  temperature: {
    coreResponse: { timeConstant: 300; unit: 'seconds' };
    coolantResponse: { timeConstant: 60; unit: 'seconds' };
    steamResponse: { timeConstant: 30; unit: 'seconds' };
  };
  
  // 压力响应
  pressure: {
    primarySystem: { timeConstant: 120; unit: 'seconds' };
    secondarySystem: { timeConstant: 60; unit: 'seconds' };
    condenserVacuum: { timeConstant: 180; unit: 'seconds' };
  };
  
  // 水位响应
  waterLevel: {
    reactorCore: { timeConstant: 90; unit: 'seconds' };
    deaerator: { timeConstant: 60; unit: 'seconds' };
    hotwell: { timeConstant: 30; unit: 'seconds' };
  };
  
  // 涡轮机响应
  turbine: {
    speedChange: { rampRate: { max: 100; unit: 'RPM/min' } };
    loadChange: { rampRate: { max: 10; unit: 'MW/min' } };
    coastDown: { maxTime: 7200; unit: 'seconds' }; // 2小时
  };
}

const SYSTEM_RESPONSE_TIMES: SystemResponseTimes = {
  controlRods: {
    insertionSpeed: { min: 0.5, max: 1.0, unit: 'cm/s' },
    fullInsertionTime: { min: 30, max: 45, unit: 'seconds' },
    withdrawalSpeed: { min: 0.5, max: 1.0, unit: 'cm/s' }
  },
  pumps: {
    startupTime: { normal: 7, max: 15, unit: 'seconds' },
    tripTime: { max: 2, unit: 'seconds' },
    flowChangeTime: { max: 10, unit: 'seconds' }
  },
  valves: {
    small: { openCloseTime: { min: 1, max: 3, unit: 'seconds' } },
    medium: { openCloseTime: { min: 3, max: 10, unit: 'seconds' } },
    large: { openCloseTime: { min: 10, max: 30, unit: 'seconds' } },
    emergency: { openCloseTime: { max: 1, unit: 'seconds' } }
  },
  temperature: {
    coreResponse: { timeConstant: 300, unit: 'seconds' },
    coolantResponse: { timeConstant: 60, unit: 'seconds' },
    steamResponse: { timeConstant: 30, unit: 'seconds' }
  },
  pressure: {
    primarySystem: { timeConstant: 120, unit: 'seconds' },
    secondarySystem: { timeConstant: 60, unit: 'seconds' },
    condenserVacuum: { timeConstant: 180, unit: 'seconds' }
  },
  waterLevel: {
    reactorCore: { timeConstant: 90, unit: 'seconds' },
    deaerator: { timeConstant: 60, unit: 'seconds' },
    hotwell: { timeConstant: 30, unit: 'seconds' }
  },
  turbine: {
    speedChange: { rampRate: { max: 100, unit: 'RPM/min' } },
    loadChange: { rampRate: { max: 10, unit: 'MW/min' } },
    coastDown: { maxTime: 7200, unit: 'seconds' }
  }
};
```

## 三、面板控制选项详细优化

### 3.1 UI/UX深度优化

#### 3.1.1 实现多视图模式

**1. 单个系统详细视图**
```typescript
// 单个系统详细视图配置
interface SingleSystemDetailView {
  systemId: string;
  systemName: string;
  components: {
    id: string;
    name: string;
    type: 'pump' | 'valve' | 'heat_exchanger' | 'tank' | 'sensor';
    status: 'normal' | 'warning' | 'alarm' | 'offline';
    parameters: {
      name: string;
      value: number;
      unit: string;
      min: number;
      max: number;
      alarm: { high: number; low: number };
    }[];
    controls: {
      type: 'button' | 'slider' | 'toggle' | 'input';
      label: string;
      currentValue: any;
      range?: [number, number];
      options?: string[];
    }[];
  }[];
  alarms: {
    id: string;
    message: string;
    severity: 'info' | 'warning' | 'critical';
    timestamp: number;
    acknowledged: boolean;
  }[];
  trends: {
    parameterId: string;
    data: { time: number; value: number }[];
    timeRange: number;
  }[];
}

// 示例：反应堆给水泵详细视图
const reactorFeedPumpDetailView: SingleSystemDetailView = {
  systemId: 'reactor_feed_pump_1',
  systemName: '反应堆给水泵 #1',
  components: [
    {
      id: 'pump_1',
      name: '主给水泵',
      type: 'pump',
      status: 'normal',
      parameters: [
        { name: '流量', value: 65000, unit: 'kg/h', min: 0, max: 80000, alarm: { high: 75000, low: 45000 } },
        { name: '排放压力', value: 8.2, unit: 'MPa', min: 0, max: 10, alarm: { high: 9.0, low: 7.0 } },
        { name: '振动', value: 0.03, unit: 'mm/s', min: 0, max: 0.1, alarm: { high: 0.08, low: 0 } },
        { name: '轴承温度', value: 65, unit: '°C', min: 20, max: 90, alarm: { high: 80, low: 30 } }
      ],
      controls: [
        { type: 'button', label: '启动', currentValue: false },
        { type: 'button', label: '停止', currentValue: false },
        { type: 'slider', label: '流量设定', currentValue: 65000, range: [0, 80000] }
      ]
    },
    {
      id: 'inlet_valve_1',
      name: '入口阀',
      type: 'valve',
      status: 'normal',
      parameters: [
        { name: '阀门位置', value: 100, unit: '%', min: 0, max: 100, alarm: { high: 100, low: 0 } },
        { name: '上游压力', value: 0.5, unit: 'MPa', min: 0, max: 1, alarm: { high: 0.8, low: 0.3 } }
      ],
      controls: [
        { type: 'toggle', label: '打开/关闭', currentValue: true },
        { type: 'slider', label: '阀门位置', currentValue: 100, range: [0, 100] }
      ]
    },
    {
      id: 'outlet_valve_1',
      name: '出口阀',
      type: 'valve',
      status: 'normal',
      parameters: [
        { name: '阀门位置', value: 85, unit: '%', min: 0, max: 100, alarm: { high: 100, low: 0 } },
        { name: '下游压力', value: 8.2, unit: 'MPa', min: 0, max: 10, alarm: { high: 9.0, low: 7.0 } }
      ],
      controls: [
        { type: 'toggle', label: '打开/关闭', currentValue: true },
        { type: 'slider', label: '阀门位置', currentValue: 85, range: [0, 100] }
      ]
    }
  ],
  alarms: [],
  trends: [
    {
      parameterId: 'flow_rate',
      data: [],
      timeRange: 3600 // 1小时
    }
  ]
};
```

**2. 系统集成概览视图**
```typescript
// 系统集成概览视图配置
interface IntegratedOverviewView {
  layout: 'grid' | 'schematic' | 'hierarchical';
  systems: {
    id: string;
    name: string;
    status: 'normal' | 'warning' | 'alarm' | 'offline';
    position: { x: number; y: number };
    connections: {
      to: string;
      type: 'flow' | 'signal' | 'control';
      direction: 'bidirectional' | 'unidirectional';
      status: 'normal' | 'warning' | 'alarm';
    }[];
    keyParameters: {
      name: string;
      value: number;
      unit: string;
      status: 'normal' | 'warning' | 'alarm';
    }[];
  }[];
  globalStatus: {
    overall: 'normal' | 'warning' | 'alarm';
    powerOutput: number;
    efficiency: number;
    safetyMargin: number;
  };
}

// 示例：切尔诺贝利电站概览视图
const chernobylPlantOverview: IntegratedOverviewView = {
  layout: 'schematic',
  systems: [
    {
      id: 'reactor_core',
      name: '反应堆堆芯',
      status: 'normal',
      position: { x: 400, y: 200 },
      connections: [
        { to: 'steam_drum', type: 'flow', direction: 'unidirectional', status: 'normal' },
        { to: 'recirculation_pumps', type: 'flow', direction: 'bidirectional', status: 'normal' }
      ],
      keyParameters: [
        { name: '热功率', value: 2800, unit: 'MW', status: 'normal' },
        { name: '堆芯温度', value: 295, unit: '°C', status: 'normal' },
        { name: '水位', value: 70, unit: '%', status: 'normal' }
      ]
    },
    {
      id: 'steam_drum',
      name: '蒸汽鼓',
      status: 'normal',
      position: { x: 400, y: 100 },
      connections: [
        { to: 'reactor_core', type: 'flow', direction: 'unidirectional', status: 'normal' },
        { to: 'turbine', type: 'flow', direction: 'unidirectional', status: 'normal' }
      ],
      keyParameters: [
        { name: '压力', value: 6.8, unit: 'MPa', status: 'normal' },
        { name: '水位', value: 0, unit: 'inches', status: 'normal' }
      ]
    },
    {
      id: 'turbine',
      name: '汽轮机',
      status: 'normal',
      position: { x: 600, y: 100 },
      connections: [
        { to: 'steam_drum', type: 'flow', direction: 'unidirectional', status: 'normal' },
        { to: 'generator', type: 'mechanical', direction: 'unidirectional', status: 'normal' },
        { to: 'condenser', type: 'flow', direction: 'unidirectional', status: 'normal' }
      ],
      keyParameters: [
        { name: '转速', value: 3600, unit: 'RPM', status: 'normal' },
        { name: '负荷', value: 950, unit: 'MW', status: 'normal' },
        { name: '振动', value: 0.03, unit: 'mm/s', status: 'normal' }
      ]
    },
    {
      id: 'generator',
      name: '发电机',
      status: 'normal',
      position: { x: 800, y: 100 },
      connections: [
        { to: 'turbine', type: 'mechanical', direction: 'unidirectional', status: 'normal' },
        { to: 'grid', type: 'electrical', direction: 'bidirectional', status: 'normal' }
      ],
      keyParameters: [
        { name: '输出功率', value: 950, unit: 'MW', status: 'normal' },
        { name: '电压', value: 22000, unit: 'V', status: 'normal' },
        { name: '频率', value: 60, unit: 'Hz', status: 'normal' }
      ]
    },
    {
      id: 'condenser',
      name: '凝汽器',
      status: 'normal',
      position: { x: 600, y: 300 },
      connections: [
        { to: 'turbine', type: 'flow', direction: 'unidirectional', status: 'normal' },
        { to: 'hotwell', type: 'flow', direction: 'unidirectional', status: 'normal' },
        { to: 'cooling_tower', type: 'flow', direction: 'bidirectional', status: 'normal' }
      ],
      keyParameters: [
        { name: '真空度', value: 97, unit: '%', status: 'normal' },
        { name: '热井水位', value: 0, unit: 'inches', status: 'normal' },
        { name: '冷却水温度', value: 35, unit: '°C', status: 'normal' }
      ]
    },
    {
      id: 'hotwell',
      name: '热井',
      status: 'normal',
      position: { x: 600, y: 400 },
      connections: [
        { to: 'condenser', type: 'flow', direction: 'unidirectional', status: 'normal' },
        { to: 'condensate_pumps', type: 'flow', direction: 'unidirectional', status: 'normal' }
      ],
      keyParameters: [
        { name: '水位', value: 0, unit: 'inches', status: 'normal' },
        { name: '温度', value: 35, unit: '°C', status: 'normal' }
      ]
    },
    {
      id: 'deaerator',
      name: '除氧器',
      status: 'normal',
      position: { x: 200, y: 300 },
      connections: [
        { to: 'condensate_pumps', type: 'flow', direction: 'unidirectional', status: 'normal' },
        { to: 'feedwater_pumps', type: 'flow', direction: 'unidirectional', status: 'normal' }
      ],
      keyParameters: [
        { name: '压力', value: 0.14, unit: 'MPa', status: 'normal' },
        { name: '水位', value: 0, unit: 'inches', status: 'normal' },
        { name: '温度', value: 110, unit: '°C', status: 'normal' }
      ]
    }
  ],
  globalStatus: {
    overall: 'normal',
    powerOutput: 950,
    efficiency: 32.5,
    safetyMargin: 85
  }
};
```

**3. 关键参数监控仪表板**
```typescript
// 关键参数监控仪表板
interface KeyParametersDashboard {
  layout: 'compact' | 'detailed' | 'hierarchical';
  parameters: {
    category: 'reactor' | 'turbine' | 'auxiliary' | 'electrical';
    items: {
      id: string;
      name: string;
      value: number;
      unit: string;
      setpoint: number;
      tolerance: number;
      status: 'normal' | 'warning' | 'alarm';
      trend: 'increasing' | 'decreasing' | 'stable';
      history: { time: number; value: number }[];
    }[];
  }[];
  alerts: {
    id: string;
    message: string;
    severity: 'info' | 'warning' | 'critical';
    timestamp: number;
    acknowledged: boolean;
  }[];
}

// 示例：关键参数仪表板
const keyParametersDashboard: KeyParametersDashboard = {
  layout: 'detailed',
  parameters: [
    {
      category: 'reactor',
      items: [
        {
          id: 'reactor_power',
          name: '反应堆功率',
          value: 2800,
          unit: 'MW',
          setpoint: 2800,
          tolerance: 50,
          status: 'normal',
          trend: 'stable',
          history: []
        },
        {
          id: 'core_temperature',
          name: '堆芯温度',
          value: 295,
          unit: '°C',
          setpoint: 300,
          tolerance: 10,
          status: 'normal',
          trend: 'stable',
          history: []
        },
        {
          id: 'reactor_pressure',
          name: '反应堆压力',
          value: 6.8,
          unit: 'MPa',
          setpoint: 7.0,
          tolerance: 0.2,
          status: 'normal',
          trend: 'stable',
          history: []
        },
        {
          id: 'reactor_water_level',
          name: '反应堆水位',
          value: 70,
          unit: '%',
          setpoint: 70,
          tolerance: 5,
          status: 'normal',
          trend: 'stable',
          history: []
        }
      ]
    },
    {
      category: 'turbine',
      items: [
        {
          id: 'turbine_speed',
          name: '汽轮机转速',
          value: 3600,
          unit: 'RPM',
          setpoint: 3600,
          tolerance: 20,
          status: 'normal',
          trend: 'stable',
          history: []
        },
        {
          id: 'turbine_load',
          name: '汽轮机负荷',
          value: 950,
          unit: 'MW',
          setpoint: 950,
          tolerance: 20,
          status: 'normal',
          trend: 'stable',
          history: []
        },
        {
          id: 'turbine_vibration',
          name: '汽轮机振动',
          value: 0.03,
          unit: 'mm/s',
          setpoint: 0.02,
          tolerance: 0.02,
          status: 'normal',
          trend: 'stable',
          history: []
        }
      ]
    }
  ],
  alerts: []
};
```

#### 3.1.2 增强视觉反馈

**1. 参数变化趋势指示器**
```typescript
// 参数变化趋势指示器
interface TrendIndicator {
  parameterId: string;
  currentValue: number;
  previousValue: number;
  trend: 'increasing' | 'decreasing' | 'stable';
  rateOfChange: number;
  prediction: {
    shortTerm: number;      // 短期预测（5分钟）
    mediumTerm: number;     // 中期预测（30分钟）
    longTerm: number;       // 长期预测（2小时）
  };
  confidence: number;      // 预测置信度 (0-1)
}

function calculateTrendIndicator(
  history: { time: number; value: number }[],
  currentValue: number
): TrendIndicator {
  if (history.length < 2) {
    return {
      parameterId: '',
      currentValue,
      previousValue: currentValue,
      trend: 'stable',
      rateOfChange: 0,
      prediction: { shortTerm: currentValue, mediumTerm: currentValue, longTerm: currentValue },
      confidence: 0
    };
  }
  
  const previousValue = history[history.length - 1].value;
  const rateOfChange = currentValue - previousValue;
  
  // 计算趋势
  let trend: 'increasing' | 'decreasing' | 'stable';
  if (Math.abs(rateOfChange) < 0.01) {
    trend = 'stable';
  } else if (rateOfChange > 0) {
    trend = 'increasing';
  } else {
    trend = 'decreasing';
  }
  
  // 简单线性预测
  const shortTermPrediction = currentValue + rateOfChange * 5;
  const mediumTermPrediction = currentValue + rateOfChange * 30;
  const longTermPrediction = currentValue + rateOfChange * 120;
  
  // 计算置信度（基于历史数据的一致性）
  const variance = calculateVariance(history);
  const confidence = Math.max(0, 1 - variance / Math.abs(currentValue));
  
  return {
    parameterId: '',
    currentValue,
    previousValue,
    trend,
    rateOfChange,
    prediction: {
      shortTerm: shortTermPrediction,
      mediumTerm: mediumTermPrediction,
      longTerm: longTermPrediction
    },
    confidence
  };
}
```

**2. 声光警报系统**
```typescript
// 声光警报系统
interface AlarmSystem {
  visual: {
    color: 'green' | 'yellow' | 'orange' | 'red';
    flashing: boolean;
    flashRate: number;         // 闪烁频率 (Hz)
    pattern: 'steady' | 'slow' | 'fast' | 'emergency';
  };
  audio: {
    enabled: boolean;
    soundType: 'beep' | 'alarm' | 'siren' | 'voice';
    volume: number;            // 音量 (0-100%)
    frequency: number;         // 频率 (Hz)
    pattern: 'continuous' | 'intermittent' | 'pulsed';
  };
  haptic: {
    enabled: boolean;
    intensity: number;         // 强度 (0-100%)
    pattern: 'continuous' | 'intermittent';
  };
}

function configureAlarm(alarmLevel: 'info' | 'warning' | 'critical'): AlarmSystem {
  switch (alarmLevel) {
    case 'info':
      return {
        visual: {
          color: 'green',
          flashing: false,
          flashRate: 0,
          pattern: 'steady'
        },
        audio: {
          enabled: true,
          soundType: 'beep',
          volume: 30,
          frequency: 440,
          pattern: 'intermittent'
        },
        haptic: {
          enabled: false,
          intensity: 0,
          pattern: 'continuous'
        }
      };
    case 'warning':
      return {
        visual: {
          color: 'yellow',
          flashing: true,
          flashRate: 1,
          pattern: 'slow'
        },
        audio: {
          enabled: true,
          soundType: 'alarm',
          volume: 60,
          frequency: 880,
          pattern: 'intermittent'
        },
        haptic: {
          enabled: true,
          intensity: 50,
          pattern: 'intermittent'
        }
      };
    case 'critical':
      return {
        visual: {
          color: 'red',
          flashing: true,
          flashRate: 3,
          pattern: 'emergency'
        },
        audio: {
          enabled: true,
          soundType: 'siren',
          volume: 100,
          frequency: 1200,
          pattern: 'pulsed'
        },
        haptic: {
          enabled: true,
          intensity: 100,
          pattern: 'pulsed'
        }
      };
    default:
      return {
        visual: {
          color: 'green',
          flashing: false,
          flashRate: 0,
          pattern: 'steady'
        },
        audio: {
          enabled: false,
          soundType: 'beep',
          volume: 0,
          frequency: 0,
          pattern: 'continuous'
        },
        haptic: {
          enabled: false,
          intensity: 0,
          pattern: 'continuous'
        }
      };
  }
}
```

**3. 颜色编码状态系统**
```typescript
// 颜色编码状态系统
interface ColorCodingSystem {
  statusColors: {
    normal: {
      primary: '#00bcd4';      // 青色
      secondary: '#4caf50';    // 绿色
      background: '#1e1e1e';    // 深灰
      text: '#e0e0e0';         // 浅灰
    };
    warning: {
      primary: '#ff9800';      // 橙色
      secondary: '#ffc107';     // 黄色
      background: '#2d2d00';    // 深黄
      text: '#fff9c4';         // 浅黄
    };
    alarm: {
      primary: '#f44336';      // 红色
      secondary: '#e53935';     // 深红
      background: '#2d0000';    // 深红
      text: '#ffcdd2';         // 浅红
    };
    critical: {
      primary: '#d32f2f';      // 暗红
      secondary: '#b71c1c';    // 深红
      background: '#1a0000';    // 深红
      text: '#ef9a9a';         // 浅红
    };
    offline: {
      primary: '#9e9e9e';      // 灰色
      secondary: '#757575';    // 深灰
      background: '#212121';    // 深灰
      text: '#bdbdbd';         // 浅灰
    };
  };
  parameterColors: {
    temperature: '#ff5722';    // 温度-橙色
    pressure: '#2196f3';       // 压力-蓝色
    flow: '#4caf50';           // 流量-绿色
    level: '#9c27b0';          // 水位-紫色
    power: '#ff9800';          // 功率-橙色
    vibration: '#f44336';      // 振动-红色
    efficiency: '#00bcd4';     // 效率-青色
  };
}

const COLOR_CODING_SYSTEM: ColorCodingSystem = {
  statusColors: {
    normal: {
      primary: '#00bcd4',
      secondary: '#4caf50',
      background: '#1e1e1e',
      text: '#e0e0e0'
    },
    warning: {
      primary: '#ff9800',
      secondary: '#ffc107',
      background: '#2d2d00',
      text: '#fff9c4'
    },
    alarm: {
      primary: '#f44336',
      secondary: '#e53935',
      background: '#2d0000',
      text: '#ffcdd2'
    },
    critical: {
      primary: '#d32f2f',
      secondary: '#b71c1c',
      background: '#1a0000',
      text: '#ef9a9a'
    },
    offline: {
      primary: '#9e9e9e',
      secondary: '#757575',
      background: '#212121',
      text: '#bdbdbd'
    }
  },
  parameterColors: {
    temperature: '#ff5722',
    pressure: '#2196f3',
    flow: '#4caf50',
    level: '#9c27b0',
    power: '#ff9800',
    vibration: '#f44336',
    efficiency: '#00bcd4'
  }
};
```

#### 3.1.3 改进操作界面

**1. 操作确认机制**
```typescript
// 操作确认机制
interface OperationConfirmation {
  operationId: string;
  operationType: 'startup' | 'shutdown' | 'scram' | 'parameter_change' | 'valve_operation';
  description: string;
  riskLevel: 'low' | 'medium' | 'high' | 'critical';
  consequences: string[];
  prerequisites: string[];
  confirmationRequired: boolean;
  authorizationLevel: 'operator' | 'supervisor' | 'engineer' | 'manager';
  timeout: number;             // 超时时间 (秒)
  doubleConfirmation: boolean;  // 需要双重确认
  logEntry: {
    timestamp: number;
    operator: string;
    operation: string;
    result: 'approved' | 'rejected' | 'cancelled';
  };
}

function requestOperationConfirmation(
  operation: string,
  riskLevel: string,
  consequences: string[]
): OperationConfirmation {
  const confirmationRequired = riskLevel !== 'low';
  const doubleConfirmation = riskLevel === 'critical';
  
  return {
    operationId: generateOperationId(),
    operationType: 'parameter_change',
    description: operation,
    riskLevel: riskLevel as any,
    consequences,
    prerequisites: [],
    confirmationRequired,
    authorizationLevel: riskLevel === 'critical' ? 'supervisor' : 'operator',
    timeout: riskLevel === 'critical' ? 30 : 60,
    doubleConfirmation,
    logEntry: {
      timestamp: Date.now(),
      operator: '',
      operation,
      result: 'approved'
    }
  };
}
```

**2. 操作日志和历史记录**
```typescript
// 操作日志系统
interface OperationLogSystem {
  logs: {
    id: string;
    timestamp: number;
    operator: string;
    operation: string;
    parameters: {
      name: string;
      oldValue: any;
      newValue: any;
    }[];
    result: 'success' | 'failure' | 'cancelled';
    duration: number;          // 操作持续时间 (毫秒)
    affectedSystems: string[];
    alarmsTriggered: string[];
  }[];
  filters: {
    timeRange: { start: number; end: number };
    operators: string[];
    operationTypes: string[];
    systems: string[];
    results: string[];
  };
  export: {
    format: 'json' | 'csv' | 'xml' | 'pdf';
    includeDetails: boolean;
    includeTrends: boolean;
  };
}

function addOperationLog(
  operator: string,
  operation: string,
  parameters: { name: string; oldValue: any; newValue: any }[],
  result: string,
  duration: number
): void {
  const logEntry = {
    id: generateLogId(),
    timestamp: Date.now(),
    operator,
    operation,
    parameters,
    result: result as any,
    duration,
    affectedSystems: [],
    alarmsTriggered: []
  };
  
  // 添加到日志系统
  operationLogSystem.logs.push(logEntry);
  
  // 限制日志数量
  if (operationLogSystem.logs.length > 10000) {
    operationLogSystem.logs.shift();
  }
}
```

**3. 快捷操作面板**
```typescript
// 快捷操作面板
interface QuickActionPanel {
  actions: {
    id: string;
    name: string;
    icon: string;
    category: 'startup' | 'shutdown' | 'emergency' | 'routine';
    shortcut: string;
    riskLevel: 'low' | 'medium' | 'high' | 'critical';
    frequency: number;          // 使用频率
    lastUsed: number;           // 最后使用时间
    enabled: boolean;
  }[];
  layout: 'grid' | 'list' | 'custom';
  customization: {
    userDefinedActions: string[];
    hiddenActions: string[];
    pinnedActions: string[];
  };
}

const QUICK_ACTION_PANEL: QuickActionPanel = {
  actions: [
    {
      id: 'scram',
      name: '紧急停堆',
      icon: '⚠️',
      category: 'emergency',
      shortcut: 'Ctrl+Shift+S',
      riskLevel: 'critical',
      frequency: 0,
      lastUsed: 0,
      enabled: true
    },
    {
      id: 'start_turbine',
      name: '启动汽轮机',
      icon: '🔄',
      category: 'startup',
      shortcut: 'Ctrl+T',
      riskLevel: 'medium',
      frequency: 5,
      lastUsed: Date.now() - 3600000,
      enabled: true
    },
    {
      id: 'emergency_cooling',
      name: '应急冷却',
      icon: '❄️',
      category: 'emergency',
      shortcut: 'Ctrl+E',
      riskLevel: 'high',
      frequency: 1,
      lastUsed: Date.now() - 86400000,
      enabled: true
    },
    {
      id: 'normal_shutdown',
      name: '正常停机',
      icon: '🛑',
      category: 'shutdown',
      shortcut: 'Ctrl+D',
      riskLevel: 'medium',
      frequency: 2,
      lastUsed: Date.now() - 172800000,
      enabled: true
    }
  ],
  layout: 'grid',
  customization: {
    userDefinedActions: [],
    hiddenActions: [],
    pinnedActions: ['scram', 'emergency_cooling']
  }
};
```

## 四、技术实现详细方案

### 4.1 核心架构优化

**建议采用模块化架构**：
```
src/
├── models/                      # 物理模型
│   ├── thermal-hydraulic/       # 热工水力模型
│   │   ├── MassBalance.ts
│   │   ├── EnergyBalance.ts
│   │   ├── FlowResistance.ts
│   │   └── WaterSteamProperties.ts
│   ├── neutron/                 # 中子物理模型
│   │   ├── VoidCoefficient.ts
│   │   ├── XenonPoisoning.ts
│   │   └── ControlRodPhysics.ts
│   └── systems/                # 各系统模型
│       ├── ReactorCore.ts
│       ├── Turbine.ts
│       ├── Condenser.ts
│       └── Deaerator.ts
├── stores/                     # 状态管理
│   ├── reactorStore.ts          # 主状态
│   ├── subsystems/             # 子系统状态
│   │   ├── thermalStore.ts
│   │   ├── hydraulicStore.ts
│   │   └── electricalStore.ts
│   └── alarmStore.ts
├── controllers/                # 控制逻辑
│   ├── manual/                 # 手动控制
│   │   ├── ManualControl.ts
│   │   └── OperatorInterface.ts
│   ├── automatic/              # 自动控制
│   │   ├── PIDController.ts
│   │   ├── AutoPowerControl.ts
│   │   └── AutoLevelControl.ts
│   └── safety/                 # 安全系统
│       ├── ScramSystem.ts
│       ├── AlarmSystem.ts
│       └── ProtectionLogic.ts
├── workers/                    # Web Workers
│   ├── PhysicsWorker.ts
│   ├── CalculationWorker.ts
│   └── DataProcessingWorker.ts
├── views/                      # 界面
│   ├── panels/                 # 单个面板
│   ├── overview/               # 概览视图
│   │   ├── IntegratedOverview.svelte
│   │   └── KeyParametersDashboard.svelte
│   ├── schematics/             # 系统流程图
│   │   ├── ReactorSchematic.svelte
│   │   └── TurbineSchematic.svelte
│   └── components/             # 可重用组件
│       ├── ParameterDisplay.svelte
│       ├── ControlButton.svelte
│       └── TrendChart.svelte
└── utils/                      # 工具函数
    ├── calculations.ts
    ├── conversions.ts
    └── validators.ts
```

### 4.2 Web Workers实现

**物理计算Worker**：
```typescript
// workers/PhysicsWorker.ts
self.onmessage = (event: MessageEvent) => {
  const { type, data } = event.data;
  
  switch (type) {
    case 'calculate_thermal_hydraulics':
      const thermalResult = calculateThermalHydraulics(data);
      self.postMessage({ type: 'thermal_result', data: thermalResult });
      break;
      
    case 'calculate_neutron_physics':
      const neutronResult = calculateNeutronPhysics(data);
      self.postMessage({ type: 'neutron_result', data: neutronResult });
      break;
      
    case 'update_system_state':
      const stateResult = updateSystemState(data);
      self.postMessage({ type: 'state_result', data: stateResult });
      break;
      
    default:
      console.error('Unknown message type:', type);
  }
};

function calculateThermalHydraulics(params: any): any {
  // 实现热工水力计算
  const { power, coolantFlow, feedwaterTemp, pressure } = params;
  
  // 计算质量平衡
  const massBalance = calculateMassBalance(params);
  
  // 计算能量平衡
  const energyBalance = calculateEnergyBalance(params);
  
  // 计算流动阻力
  const flowResistance = calculateFlowResistance(params);
  
  // 计算水/蒸汽特性
  const waterSteamProps = calculateWaterSteamProperties(pressure, params.temperature);
  
  return {
    massBalance,
    energyBalance,
    flowResistance,
    waterSteamProps,
    timestamp: Date.now()
  };
}

function calculateNeutronPhysics(params: any): any {
  // 实现中子物理计算
  const { neutronFlux, xenonConcentration, iodineConcentration } = params;
  
  // 计算空泡系数效应
  const voidCoefficientEffect = calculateVoidCoefficientEffect(params);
  
  // 计算氙中毒
  const xenonPoisoning = calculateXenonPoisoning(neutronFlux, 1.0, xenonConcentration, iodineConcentration);
  
  // 计算控制棒效应
  const controlRodEffect = calculateControlRodEffect(params);
  
  return {
    voidCoefficientEffect,
    xenonPoisoning,
    controlRodEffect,
    timestamp: Date.now()
  };
}

function updateSystemState(params: any): any {
  // 更新系统状态
  const { currentState, deltaTime } = params;
  
  // 更新反应堆状态
  const reactorState = updateReactorState(currentState.reactor, deltaTime);
  
  // 更新汽轮机状态
  const turbineState = updateTurbineState(currentState.turbine, deltaTime);
  
  // 更新辅助系统状态
  const auxiliaryState = updateAuxiliaryState(currentState.auxiliary, deltaTime);
  
  return {
    reactor: reactorState,
    turbine: turbineState,
    auxiliary: auxiliaryState,
    timestamp: Date.now()
  };
}
```

**主线程Worker管理器**：
```typescript
// utils/WorkerManager.ts
class WorkerManager {
  private physicsWorker: Worker | null = null;
  private calculationWorker: Worker | null = null;
  private dataProcessingWorker: Worker | null = null;
  
  constructor() {
    this.initializeWorkers();
  }
  
  private initializeWorkers(): void {
    // 初始化物理计算Worker
    this.physicsWorker = new Worker(new URL('../workers/PhysicsWorker.ts', import.meta.url), {
      type: 'module'
    });
    
    // 设置消息处理器
    this.physicsWorker.onmessage = this.handlePhysicsWorkerMessage.bind(this);
    
    // 初始化计算Worker
    this.calculationWorker = new Worker(new URL('../workers/CalculationWorker.ts', import.meta.url), {
      type: 'module'
    });
    
    // 初始化数据处理Worker
    this.dataProcessingWorker = new Worker(new URL('../workers/DataProcessingWorker.ts', import.meta.url), {
      type: 'module'
    });
  }
  
  private handlePhysicsWorkerMessage(event: MessageEvent): void {
    const { type, data } = event.data;
    
    switch (type) {
      case 'thermal_result':
        this.handleThermalResult(data);
        break;
      case 'neutron_result':
        this.handleNeutronResult(data);
        break;
      case 'state_result':
        this.handleStateResult(data);
        break;
    }
  }
  
  public calculateThermalHydraulics(params: any): Promise<any> {
    return new Promise((resolve, reject) => {
      if (!this.physicsWorker) {
        reject(new Error('Physics worker not initialized'));
        return;
      }
      
      const messageId = generateMessageId();
      const messageHandler = (event: MessageEvent) => {
        if (event.data.messageId === messageId) {
          this.physicsWorker!.removeEventListener('message', messageHandler);
          resolve(event.data.data);
        }
      };
      
      this.physicsWorker.addEventListener('message', messageHandler);
      this.physicsWorker.postMessage({
        messageId,
        type: 'calculate_thermal_hydraulics',
        data: params
      });
    });
  }
  
  public calculateNeutronPhysics(params: any): Promise<any> {
    return new Promise((resolve, reject) => {
      if (!this.physicsWorker) {
        reject(new Error('Physics worker not initialized'));
        return;
      }
      
      const messageId = generateMessageId();
      const messageHandler = (event: MessageEvent) => {
        if (event.data.messageId === messageId) {
          this.physicsWorker!.removeEventListener('message', messageHandler);
          resolve(event.data.data);
        }
      };
      
      this.physicsWorker.addEventListener('message', messageHandler);
      this.physicsWorker.postMessage({
        messageId,
        type: 'calculate_neutron_physics',
        data: params
      });
    });
  }
  
  private handleThermalResult(data: any): void {
    // 处理热工水力计算结果
    console.log('Thermal result received:', data);
  }
  
  private handleNeutronResult(data: any): void {
    // 处理中子物理计算结果
    console.log('Neutron result received:', data);
  }
  
  private handleStateResult(data: any): void {
    // 处理状态更新结果
    console.log('State result received:', data);
  }
}

export const workerManager = new WorkerManager();
```

## 五、实施路线图详细规划

### 5.1 第一阶段：基础优化（1-2个月）

**第1-2周：物理模型基础改进**
- 实现质量守恒方程
- 实现能量守恒方程
- 添加基本的流动阻力计算
- 实现简化的水/蒸汽特性计算

**第3-4周：中子物理模型**
- 实现正空泡系数效应
- 实现氙-135中毒效应
- 改进控制棒物理特性
- 添加控制棒石墨尖端效应

**第5-6周：系统间耦合**
- 实现给水系统-堆芯水位耦合
- 实现蒸汽压力-汽轮机效率耦合
- 实现凝结水温度-除氧器性能耦合
- 添加系统间延迟和响应时间

**第7-8周：参数校准**
- 校准反应堆核心参数
- 校准汽轮机参数
- 校准辅助系统参数
- 调整系统响应时间

### 5.2 第二阶段：功能扩展（2-3个月）

**第9-12周：自动控制系统**
- 实现PID控制器
- 实现功率自动调节系统
- 实现水位自动控制系统
- 实现压力自动调节系统

**第13-16周：界面优化**
- 实现多视图模式
- 添加系统集成概览视图
- 实现关键参数监控仪表板
- 增强视觉反馈系统

**第17-20周：数据可视化**
- 增强数据趋势功能
- 添加系统流程图
- 实现动态流体流动显示
- 添加交互式元素

### 5.3 第三阶段：高级特性（3-4个月）

**第21-24周：故障模拟**
- 实现管道破裂故障
- 实现泵故障模拟
- 实现阀门故障模拟
- 添加故障级联影响

**第25-28周：真实RBMK特性**
- 完善正空泡系数实现
- 添加控制棒拔出效应
- 实现完整的氙中毒模型
- 添加反应堆中毒恢复过程

**第29-32周：启动/停机流程**
- 实现完整的启动流程
- 实现正常停机流程
- 实现紧急停机流程
- 添加启动/停机检查清单

**第33-36周：性能优化**
- 实现Web Workers后台计算
- 优化数据存储和检索
- 实现计算精度自适应
- 添加预计算和缓存策略

## 六、结论与建议

通过实施上述详细优化建议，Barotrauma反应堆模拟器可以达到专业级模拟器的水平。关键成功因素包括：

1. **物理模型准确性**：基于真实RBMK-1000技术参数和物理原理
2. **系统完整性**：实现所有主要系统和它们之间的相互影响
3. **用户界面质量**：提供直观、信息丰富、响应迅速的控制界面
4. **教育价值**：不仅作为游戏元素，还可作为教育和培训工具

### 优先级建议

1. **最高优先级**：物理模型优化和参数校准（第1-8周）
2. **高优先级**：自动控制系统实现和UI/UX改进（第9-20周）
3. **中优先级**：系统流程图和数据可视化增强（第13-20周）
4. **低优先级**：高级故障模拟和预测性维护功能（第21-36周）

### 预期成果

实施这些优化后，模拟器将具备：
- 更真实的物理行为
- 更完整的系统模拟
- 更好的用户体验
- 更高的教育价值
- 更强的可扩展性

这些改进将使模拟器成为理解核反应堆工作原理和安全操作流程的强大工具，同时保持作为游戏元素的娱乐价值。