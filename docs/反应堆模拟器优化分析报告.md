# Barotrauma反应堆模拟器详细优化分析报告

---

## 目录
1. [项目现状分析](#项目现状分析)
2. [RBMK-1000反应堆技术特性深度分析](#一rbmk-1000反应堆技术特性深度分析)
3. [物理模型深度优化](#二物理模型深度优化)
4. [系统完整性详细优化](#三系统完整性详细优化)
5. [参数真实性详细校准](#四参数真实性详细校准)
6. [用户界面优化](#五用户界面优化)
7. [技术实现详细方案](#六技术实现详细方案)
8. [实施路线图详细规划](#七实施路线图详细规划)
9. [核心物理公式与计算方法](#八核心物理公式与计算方法)
10. [CHRNOBYL RBMK-1000模拟器详细分析](#九chrnobyl-rbmk-1000模拟器详细分析)
11. [切尔诺贝利遗产延续手册详细内容](#十切尔诺贝利遗产延续手册详细内容)
12. [辅助面板显示机制详细分析](#十一辅助面板显示机制详细分析)
13. [结论与建议](#十二结论与建议)

---

## 项目现状分析

基于对项目代码、CHRNOBYL RBMK-1000模拟器详细分析报告、物理公式文档和切尔诺贝利遗产延续手册的深度分析，当前项目已经实现了一个功能相对完整的RBMK-1000反应堆模拟器，包括22个控制面板和基本的物理模拟系统。然而，通过与真实RBMK-1000系统、物理公式和参考资料的对比，仍有较大的优化空间。

---

## 一、RBMK-1000反应堆技术特性深度分析

### 1.1 RBMK-1000核心设计特性

**真实RBMK-1000的关键特性**：
- **石墨慢化**：使用石墨作为慢化剂而非水，这是RBMK设计的核心特征
- **正空泡系数**：当反应堆形成空泡（水变成蒸汽）时，堆芯功率增加而非减少
- **在线换料**：世界上唯一具有此特点的商业动力堆之一（除加拿大CANDU外）
- **未浓缩铀燃料**：出于经济原因使用未浓缩铀，导致反应堆中毒问题
- **控制棒设计缺陷**：控制棒尖端使用石墨"水置换器"，导致紧急停堆时功率瞬间增加
- **缺乏安全壳结构**：没有压力密封的安全壳来容纳放射性物质

**当前模拟器状态**：
- 基本控制棒功能已实现，但缺乏真实的物理响应特性
- 缺乏正空泡系数效应的准确模拟
- 氙中毒效应有基础实现，但不够详细
- 控制棒响应时间与真实值不符（真实值需要30秒以上完全插入）

### 1.2 真实RBMK-1000技术参数

**反应堆核心参数**：
- 额定热输出：3000 MW
- 额定电输出：1000 MW
- 工作压力：约6.5-7.0 MPa
- 堆芯温度：正常运行时280-320°C
- 冷却剂流量：每回路约40,000 m³/h
- 控制棒数量：211根控制棒
- 控制棒插入速度：约0.5-1 cm/s
- 控制棒完全插入时间：30秒以上

**汽轮机参数**：
- 额定转速：3600 RPM（美国标准）/ 3000 RPM（欧洲标准）
- 涡轮机重量：数百吨
- 滑行停机时间：最长3小时
- 润滑油系统：必须持续运行，包括备用直流油泵
- 液压油系统：独立于润滑油系统

**辅助系统参数**：
- 凝汽器真空：应维持在95%以上（约0.05 MPa绝对压力）
- 除氧器压力：16-25 psig（约0.11-0.17 MPa）
- 除氧器水位：正常0英寸
- 热井水位：正常0英寸
- 凝结水储罐容量：每个960,000加仑（约3,634,000升）

---

## 二、物理模型深度优化

### 2.1 热工水力模型增强

**当前状态**：
- 简单的线性模型（如温度 = 250 + 功率 × 0.8）
- 有限的系统间相互影响
- 缺乏真实的热工水力计算

**详细优化建议**：

#### 2.1.1 实现质量守恒方程

质量守恒模型需要建立反应堆、凝汽器和除氧器三个关键系统的质量平衡计算。

**反应堆系统质量平衡**：
```
dM_reactor/dt = m_feedwater - m_steam
```

其中：
- `M_reactor`：反应堆内水的质量
- `m_feedwater`：给水流量
- `m_steam`：蒸汽流量

**凝汽器系统质量平衡**：
```
dM_condenser/dt = m_steam - m_condensate + m_cooling
```

其中：
- `M_condenser`：凝汽器内水的质量
- `m_condensate`：凝结水流量
- `m_cooling`：冷却水带来的质量变化

**除氧器系统质量平衡**：
```
dM_deaerator/dt = m_condensate + m_steam_heating - m_feedwater_out
```

其中：
- `M_deaerator`：除氧器内水的质量
- `m_steam_heating`：加热蒸汽流量
- `m_feedwater_out`：出口给水流量

#### 2.1.2 实现能量守恒方程

**反应堆系统能量平衡**：
```
Q_thermal = P_nuclear × η_thermal
m_steam = Q_thermal / (h_steam - h_feedwater)
ΔT_coolant = Q_thermal / (m_coolant × c_p)
```

其中：
- `Q_thermal`：热功率
- `P_nuclear`：核功率
- `η_thermal`：热效率（约0.33）
- `h_steam`：蒸汽焓
- `h_feedwater`：给水焓
- `c_p`：冷却剂比热容

**汽轮机系统能量平衡**：
```
P_mechanical = m_steam × (h_inlet - h_outlet) × η_turbine
```

其中：
- `P_mechanical`：机械功率
- `η_turbine`：汽轮机效率（约0.85）

**发电机系统能量平衡**：
```
P_electrical = P_mechanical × η_generator
```

其中：
- `P_electrical`：电功率
- `η_generator`：发电机效率（约0.95）

#### 2.1.3 考虑冷却剂流动的阻力损失

**管道流动阻力**：
```
ΔP = f × (L/D) × (ρ × v²/2)
```

其中：
- `ΔP`：压降
- `f`：摩擦系数
- `L`：管道长度
- `D`：管道直径
- `ρ`：流体密度
- `v`：流速

**雷诺数计算**：
```
Re = ρ × v × D / μ
```

其中：
- `Re`：雷诺数
- `μ`：动力粘度

**泵性能特性**：
```
H = H_max - k × Q²
P_pump = ρ × g × H × Q / η_pump
```

其中：
- `H`：扬程
- `H_max`：最大扬程
- `k`：阻力系数
- `Q`：流量
- `η_pump`：泵效率

#### 2.1.4 模拟不同压力下的水/蒸汽特性

使用IAPWS-97标准公式计算水和蒸汽的热力学性质：

**饱和温度计算**：
```
T_sat = f(P)
```

**液体焓计算**：
```
h_f = f(P, T)
```

**蒸汽焓计算**：
```
h_g = f(P, T)
```

**液体密度计算**：
```
ρ_f = f(P, T)
```

**蒸汽密度计算**：
```
ρ_g = f(P, T)
```

**空泡分数计算**：
```
α = (ρ_mix - ρ_f) / (ρ_g - ρ_f)
```

其中：
- `ρ_mix`：混合密度

### 2.2 中子物理模型增强

#### 2.2.1 正空泡系数效应

**正空泡系数模型**：
```
ρ_void = α_void × Δα
P_new = P_current × (1 + ρ_void)
```

其中：
- `ρ_void`：空泡反应性
- `α_void`：空泡系数（正值，约+4.7×10⁻⁵）
- `Δα`：空泡份额变化
- `P_new`：新功率
- `P_current`：当前功率

**反馈延迟**：
```
P_delayed(t) = P_new(t - τ_delay)
```

其中：
- `τ_delay`：反馈延迟时间（约5-20秒）

#### 2.2.2 氙-135中毒效应

**氙-135动力学方程**：
```
dXe/dt = λ_I × I - λ_Xe × Xe - σ_Xe × φ × Xe + γ_Xe × Σ_f × φ
dI/dt = γ_I × Σ_f × φ - λ_I × I
```

其中：
- `Xe`：氙-135浓度
- `I`：碘-135浓度
- `λ_Xe`：氙-135衰变常数（2.95×10⁻⁵ s⁻¹）
- `λ_I`：碘-135衰变常数（2.87×10⁻⁵ s⁻¹）
- `σ_Xe`：氙-135中子俘获截面（2.65×10⁻¹⁸ cm²）
- `φ`：中子通量
- `γ_Xe`：氙-135产额（0.0639）
- `γ_I`：碘-135产额（0.0639）
- `Σ_f`：裂变截面

**氙中毒对反应性的影响**：
```
ρ_Xe = -σ_Xe × Xe / Σ_f
```

#### 2.2.3 控制棒物理特性

**控制棒反应性价值**：
```
ρ_rod(t) = ρ_max × (1 - z(t)/L)
```

其中：
- `ρ_max`：控制棒完全插入时的最大反应性
- `z(t)`：控制棒插入深度
- `L`：控制棒总长度

**石墨尖端效应**（前20%插入深度）：
```
ρ_tip = +ρ_graphite_effect (当 z(t) < 0.2L)
```

**延迟的吸收效应**：
```
ρ_absorption = -ρ_absorption_max × (z(t) - 0.2L) / (0.8L) (当 z(t) ≥ 0.2L)
```

**控制棒插入速度**：
```
dz/dt = v_rod (0.5-1.0 cm/s)
```

**完全插入时间**：
```
t_insert = L / v_rod (30-45秒)
```

### 2.3 系统间耦合增强

#### 2.3.1 给水系统-堆芯水位耦合

**堆芯水位计算**：
```
dH_core/dt = (m_feedwater - m_steam) / (A_core × ρ_water)
```

其中：
- `H_core`：堆芯水位
- `A_core`：堆芯横截面积
- `ρ_water`：水密度

**水位响应时间**：
```
τ_water = V_core / (m_feedwater + m_steam)
```

其中：
- `V_core`：堆芯体积

#### 2.3.2 蒸汽压力-汽轮机效率耦合

**汽轮机效率计算**：
```
η_turbine = η_base × f_pressure × f_temperature × f_load
```

其中：
- `η_base`：基础效率（0.85）
- `f_pressure = P_steam / P_rated`：压力因子
- `f_temperature = T_steam / T_rated`：温度因子
- `f_load`：负荷因子（0.8-1.0）

#### 2.3.3 凝结水温度-除氧器性能耦合

**除氧器效率计算**：
```
η_deaerator = 1 - (T_sat - T_condensate) / T_sat
```

其中：
- `T_sat`：饱和温度
- `T_condensate`：凝结水温度

**含氧量计算**：
```
O2 = O2_max × (1 - η_deaerator)
```

其中：
- `O2`：含氧量（ppb）
- `O2_max`：最大含氧量（约7000 ppb）

---

## 三、系统完整性详细优化

### 3.1 完善系统细节

#### 3.1.1 蒸汽发生器水位控制系统

**三冲量水位控制**：
```
m_feedwater_adjusted = K_p × (H_setpoint - H_actual) + K_d × (m_steam - m_feedwater)
```

其中：
- `K_p`：比例增益
- `K_d`：微分增益
- `H_setpoint`：水位设定值
- `H_actual`：实际水位

**水位警报阈值**：
- 高水位警报：H > 85%
- 低水位警报：H < 55%
- 高高水位停堆：H > 90%
- 低低水位停堆：H < 45%

#### 3.1.2 汽轮机旁路系统

**旁路阀控制逻辑**：
```
如果 汽轮机状态 = 离线:
    阀门位置 = PID控制器(P_steam - P_setpoint)
否则 如果 P_steam > 1.05 × P_setpoint:
    阀门位置 = (P_steam - P_setpoint) / (P_max - P_setpoint)
```

**旁路阀容量**：
```
Q_bypass_max = 1.2 × Q_steam_max
```

#### 3.1.3 堆芯冷却剂净化系统

**净化效率计算**：
```
η_purification = η_filter × (Q_actual / Q_max) × (1 - C_impurity / C_max)
```

其中：
- `η_filter`：过滤器效率（0.95-0.99）
- `Q_actual`：实际流量
- `Q_max`：最大流量
- `C_impurity`：杂质浓度
- `C_max`：最大杂质浓度

### 3.2 实现真实的启动流程

#### 3.2.1 启动前准备阶段

**屏幕视图优化**：
- 示意图显示：启用所有系统流程图
- 趋势显示：配置关键参数趋势
- 警报显示：启用所有警报窗口

**趋势设置**：
- 反应堆水位：颜色=绿色，启用=true
- 除氧器水位：颜色=蓝色，启用=true
- 热井水位：颜色=青色，启用=true
- 给水流量：颜色=橙色，启用=true
- 蒸汽流量：颜色=红色，启用=true
- 中子率：颜色=紫色，启用=true
- 中子通量：颜色=粉色，启用=true
- 热功率：颜色=黄色，启用=true
- 凝汽器真空：颜色=灰色，启用=true
- 发电机负荷：颜色=棕色，启用=true

**凝结水储罐检查**：
- 罐1水位：≥ 50%
- 罐2水位：≥ 50%

**热井水位检查**：
- 水位：0英寸
- 设定值：0英寸
- 控制模式：自动或手动

#### 3.2.2 系统启动阶段

**凝结水泵启动**：
- 泵号选择：1、2或3
- 状态监控：启动中、运行中、停止
- 流量跟踪：≥ 50,000 kg/h
- 排放压力：7.5-9.0 MPa

**除氧器注水**：
- 注水流量：50,000-80,000 kg/h
- 压力：0.11-0.17 MPa
- 温度：100-120°C

**凝结水精处理系统**：
- 流量：≥ 50,000 kg/h
- 效率：≥ 95%
- 杂质水平：≤ 10 ppb

**凝汽器循环水泵**：
- 泵号选择：1、2、3或4
- 流量：400,000-600,000 gpm
- 冷却水温度：25-35°C

**HEPA过滤器检查**：
- 过滤器1状态：在线
- 过滤器2状态：在线
- 过滤效率：≥ 99.97%

#### 3.2.3 反应堆启动阶段

**反应堆临界**：
- 控制棒位置：逐步抽出
- 中子通量监控：1×10¹³ - 3×10¹⁴ n/cm²/s
- 功率提升速率：≤ 10%/分钟

**功率提升**：
- 目标功率：1000 MW
- 提升速率：5-10 MW/分钟
- 温度监控：280-320°C
- 压力监控：6.5-7.0 MPa

**并网准备**：
- 蒸汽参数：P=6.8 MPa, T=280°C
- 汽轮机转速：3000 RPM
- 发电机电压：22 kV
- 频率：60 Hz

#### 3.2.4 汽轮机启动阶段

**汽轮机预热**：
- 预热时间：2-4小时
- 预热温度：150-200°C
- 转子膨胀监控：≤ 2 mm

**汽轮机启动**：
- 启动转速：500-1000 RPM
- 升速速率：≤ 100 RPM/分钟
- 振动监控：≤ 0.05 mm/s

**并网**：
- 同步检查：电压、频率、相位
- 并网时间：≤ 5分钟
- 负荷提升：≤ 10 MW/分钟

### 3.3 故障模拟详细实现

#### 3.3.1 泵故障模型

**故障类型**：
- 机械故障：轴承损坏、密封失效
- 电气故障：电机故障、控制系统故障
- 气蚀：流量不足、压力过高
- 密封失效：泄漏、密封磨损

**故障严重程度**：
- 轻微：性能下降10-20%
- 重大：性能下降50-80%
- 灾难性：完全停止

**故障状态**：
- 运行：正常工作
- 降级：性能下降但仍能工作
- 故障：完全停止
- 跳闸：因保护动作而停止

**恢复时间**：
- 机械故障：数小时到数天
- 电气故障：数小时
- 气蚀：数小时
- 密封失效：数小时到数天

#### 3.3.2 紧急停堆（SCRAM）过程

**触发原因**：
- 中子通量过高：> 5×10¹⁴ n/cm²/s
- 温度过高：> 360°C
- 压力过低：< 6.0 MPa

**停堆类型**：
- 自动：系统自动触发
- 手动：操作员手动触发
- 紧急：紧急停堆按钮

**控制棒插入**：
- 总控制棒数：211根
- 已插入控制棒数：0-211根
- 插入进度：0-100%
- 预计时间：30-45秒
- 功率降低：100% → 0%

**石墨尖端效应**（前20%插入深度）：
```
P_transient = P_initial × (1 + 0.05 × (z(t) / (0.2L)))
```

**主要吸收效应**（后80%插入深度）：
```
P_absorption = P_initial × (1 - 0.95 × ((z(t) - 0.2L) / (0.8L)))
```

**安全系统响应**：
- 紧急堆芯冷却系统：自动激活
- 安全壳隔离：自动启动
- 通风系统：切换到过滤模式
- 电气备用系统：自动启动

---

## 四、参数真实性详细校准

### 4.1 反应堆核心参数

**温度参数**：
- 正常运行范围：280-320°C
- 高温警报：330°C
- 临界温度：350°C
- 停堆温度：360°C

**压力参数**：
- 正常运行范围：6.0-7.5 MPa
- 高压警报：7.8 MPa
- 临界压力：8.0 MPa
- 停堆压力：8.5 MPa

**水位参数**：
- 正常运行范围：65%-75%
- 高水位警报：85%
- 低水位警报：55%
- 高水位停堆：90%
- 低水位停堆：45%

**功率参数**：
- 正常运行范围：0%-100%
- 高功率警报：105%
- 停堆功率：120%

**中子通量**：
- 正常运行范围：1×10¹³ - 3×10¹⁴ n/cm²/s
- 停堆通量：5×10¹⁴ n/cm²/s

**中子速率**：
- 正常运行范围：-10% 到 10%/秒
- 停堆速率：20%/秒

### 4.2 汽轮机参数

**转速参数**：
- 正常运行范围：3580-3620 RPM
- 高转速警报：3650 RPM
- 低转速警报：3550 RPM
- 超速跳闸：3960 RPM

**振动参数**：
- 正常运行最大值：0.05 mm/s
- 高振动警报：0.08 mm/s
- 振动跳闸：0.12 mm/s

**差胀参数**：
- 正常运行范围：-2 到 2 mm
- 高差胀警报：3 mm
- 低差胀警报：-3 mm
- 高差胀跳闸：4 mm
- 低差胀跳闸：-4 mm

**负荷参数**：
- 正常运行范围：0-1000 MW
- 最大负荷变化率：10 MW/分钟

**蒸汽参数**：
- 入口压力：6.0-7.5 MPa（高警报：7.8 MPa）
- 入口温度：270-290°C（高警报：300°C）
- 排气压力：≤ 0.01 MPa（高警报：0.02 MPa）

### 4.3 辅助系统参数

**凝汽器参数**：
- 真空度：95%-99%（低警报：90%，跳闸：85%）
- 热井水位：-1 到 1 英寸（高警报：3 英寸，低警报：-3 英寸）
- 冷却水入口温度：25°C（最大：35°C）
- 冷却水出口温度：35°C（最大：45°C）
- 冷却水流量：400,000-600,000 gpm（低警报：350,000 gpm）

**除氧器参数**：
- 压力：0.11-0.17 MPa（高警报：0.18 MPa，低警报：0.10 MPa）
- 水位：-1 到 1 英寸（高警报：3 英寸，低警报：-3 英寸）
- 温度：100-120°C（高警报：125°C）

**给水泵参数**：
- 排放压力：7.5-9.0 MPa（低警报：7.0 MPa）
- 流量：50,000-80,000 kg/h（低警报：45,000 kg/h）
- 振动：≤ 0.05 mm/s（高警报：0.08 mm/s）

**应急冷却系统参数**：
- 泵流量最小值：8,500,000 lb/h
- 自动激活最大时间：5秒
- 手动激活最大时间：10秒

### 4.4 响应时间校准

**控制棒响应**：
- 插入速度：0.5-1.0 cm/s
- 完全插入时间：30-45秒
- 提升速度：0.5-1.0 cm/s

**泵响应**：
- 启动时间：7秒（最大：15秒）
- 跳闸时间：≤ 2秒
- 流量变化时间：≤ 10秒

**阀门响应**：
- 小型阀门：1-3秒
- 中型阀门：3-10秒
- 大型阀门：10-30秒
- 紧急阀门：≤ 1秒

**温度响应**：
- 堆芯响应时间常数：300秒
- 冷却剂响应时间常数：60秒
- 蒸汽反应时间常数：30秒

**压力响应**：
- 一回路系统时间常数：120秒
- 二回路系统时间常数：60秒
- 凝汽器真空时间常数：180秒

**水位响应**：
- 反应堆堆芯时间常数：90秒
- 除氧器时间常数：60秒
- 热井时间常数：30秒

**汽轮机响应**：
- 转速变化最大率：100 RPM/分钟
- 负荷变化最大率：10 MW/分钟
- 滑行停机最大时间：7200秒（2小时）

---

## 五、用户界面优化

### 5.1 单个系统详细视图

**系统配置结构**：
```typescript
interface SystemDetail {
  id: string;
  name: string;
  components: Component[];
  alarms: Alarm[];
  trends: Trend[];
}

interface Component {
  id: string;
  name: string;
  type: 'pump' | 'valve' | 'heat_exchanger' | 'tank' | 'sensor';
  status: 'normal' | 'warning' | 'alarm' | 'offline';
  parameters: Parameter[];
  controls: Control[];
}

interface Parameter {
  id: string;
  name: string;
  value: number;
  unit: string;
  min?: number;
  max?: number;
  alarmThreshold?: number;
}

interface Control {
  type: 'button' | 'slider' | 'toggle' | 'input';
  id: string;
  label: string;
  value?: number;
  min?: number;
  max?: number;
  step?: number;
  options?: string[];
}
```

**反应堆给水泵详细视图示例**：
- 系统标识："反应堆给水泵_1"
- 系统名称："反应堆给水泵#1"
- 组件：
  - 主给水泵：
    - 流量：65,000 kg/h
    - 排放压力：8.2 MPa
    - 振动：0.03 mm/s
    - 轴承温度：65°C
    - 控制：启动按钮、停止按钮、流量设定滑块
  - 入口阀：
    - 阀门位置：100%
    - 压力：8.0 MPa
    - 控制：打开/关闭开关、阀门位置滑块
  - 出口阀：
    - 阀门位置：100%
    - 压力：8.2 MPa
    - 控制：打开/关闭开关、阀门位置滑块
- 警报：无
- 趋势：流量参数历史数据（1小时）

### 5.2 系统集成概览视图

**布局模式**：
- 网格：显示所有系统的网格布局
- 示意图：显示系统流程图
- 分层：分层显示不同系统

**系统配置**：
```typescript
interface SystemOverview {
  layout: 'grid' | 'schematic' | 'hierarchical';
  systems: System[];
  globalStatus: GlobalStatus;
  alarmSummary: AlarmSummary;
}

interface System {
  id: string;
  name: string;
  status: 'normal' | 'warning' | 'alarm' | 'offline';
  position: { x: number; y: number };
  connections: Connection[];
  keyParameters: KeyParameter[];
}

interface Connection {
  targetSystem: string;
  type: 'flow' | 'signal' | 'control';
  direction: 'bidirectional' | 'unidirectional';
  status: 'normal' | 'warning' | 'alarm' | 'offline';
}

interface KeyParameter {
  id: string;
  name: string;
  value: number;
  unit: string;
  status: 'normal' | 'warning' | 'alarm' | 'offline';
}

interface GlobalStatus {
  overallStatus: 'normal' | 'warning' | 'alarm' | 'offline';
  powerOutput: number;
  efficiency: number;
  safetyMargin: number;
}

interface AlarmSummary {
  alarms: Alarm[];
  unacknowledgedCount: number;
}
```

**切尔诺贝利电站概览视图示例**：
- 布局：示意图模式
- 系统：
  - 反应堆堆芯：
    - 位置：(400, 200)
    - 连接：蒸汽鼓、再循环泵
    - 关键参数：热功率2800 MW、堆芯温度295°C、水位70%
  - 蒸汽鼓：
    - 位置：(400, 100)
    - 连接：反应堆堆芯、汽轮机
    - 关键参数：压力6.8 MPa、水位0英寸
  - 汽轮机：
    - 位置：(600, 100)
    - 连接：蒸汽鼓、发电机、凝汽器
    - 关键参数：转速3600 RPM、负荷950 MW、振动0.03 mm/s
  - 发电机：
    - 位置：(800, 100)
    - 连接：汽轮机、电网
    - 关键参数：输出功率950 MW、电压22 kV、频率60 Hz
  - 凝汽器：
    - 位置：(600, 300)
    - 连接：汽轮机、热井、冷却塔
    - 关键参数：真空度97%、热井水位0英寸、冷却水温度35°C
  - 热井：
    - 位置：(600, 400)
    - 连接：凝汽器、凝结水泵
    - 关键参数：水位0英寸、温度35°C
  - 除氧器：
    - 位置：(200, 300)
    - 连接：凝结水泵、给水泵
    - 关键参数：压力0.14 MPa、水位0英寸、温度110°C
- 全局状态：
  - 整体状态：正常
  - 功率输出：950 MW
  - 效率：32.5%
  - 安全裕度：85%
- 警报汇总：
  - 警报：无
  - 未确认警报数量：0

### 5.3 关键参数监控仪表板

**仪表板配置**：
```typescript
interface Dashboard {
  layout: 'compact' | 'detailed' | 'hierarchical';
  parameters: Parameter[];
  alarms: Alarm[];
}

interface Parameter {
  id: string;
  name: string;
  value: number;
  unit: string;
  setpoint: number;
  tolerance: number;
  status: 'normal' | 'warning' | 'alarm';
  trend: 'rising' | 'falling' | 'stable';
  history: HistoryData[];
}

interface HistoryData {
  timestamp: number;
  value: number;
}

interface Alarm {
  id: string;
  message: string;
  severity: 'info' | 'warning' | 'alarm' | 'critical';
  timestamp: number;
  acknowledged: boolean;
}
```

**汽轮机类别参数示例**：
- 汽轮机转速：
  - 值：3600 RPM
  - 设定值：3600 RPM
  - 容差：20 RPM
  - 状态：正常
  - 趋势：稳定
- 汽轮机负荷：
  - 值：950 MW
  - 设定值：950 MW
  - 容差：20 MW
  - 状态：正常
  - 趋势：稳定
- 汽轮机振动：
  - 值：0.03 mm/s
  - 设定值：0.02 mm/s
  - 容差：0.02 mm/s
  - 状态：正常
  - 趋势：稳定
- 警报：无

### 5.4 增强视觉反馈

#### 5.4.1 参数变化趋势指示器

**趋势指示器配置**：
```typescript
interface TrendIndicator {
  parameterId: string;
  currentValue: number;
  previousValue: number;
  trend: 'rising' | 'falling' | 'stable';
  rateOfChange: number;
  prediction: {
    shortTerm: number;  // 5分钟
    mediumTerm: number; // 30分钟
    longTerm: number;   // 2小时
  };
  confidence: number; // 0-1
}
```

**计算函数**：
```typescript
function calculateTrendIndicator(
  history: number[],
  currentValue: number
): TrendIndicator {
  const previousValue = history[history.length - 1] || currentValue;
  const rateOfChange = currentValue - previousValue;
  
  let trend: 'rising' | 'falling' | 'stable';
  if (Math.abs(rateOfChange) < 0.01) {
    trend = 'stable';
  } else if (rateOfChange > 0) {
    trend = 'rising';
  } else {
    trend = 'falling';
  }
  
  const prediction = {
    shortTerm: currentValue + rateOfChange * 5,
    mediumTerm: currentValue + rateOfChange * 30,
    longTerm: currentValue + rateOfChange * 120
  };
  
  const variance = calculateVariance(history);
  const confidence = Math.max(0, 1 - variance / Math.abs(currentValue));
  
  return {
    parameterId: '',
    currentValue,
    previousValue,
    trend,
    rateOfChange,
    prediction,
    confidence
  };
}
```

#### 5.4.2 声光警报系统

**视觉配置**：
- 颜色：绿色（正常）、黄色（警告）、橙色（警报）、红色（危急）
- 闪烁：是/否
- 闪烁频率：1-10 Hz
- 模式：稳定、慢速、快速、紧急

**听觉配置**：
- 启用：是/否
- 声音类型：蜂鸣、警报、警报器、语音
- 音量：0-100%
- 频率：20-20000 Hz
- 模式：连续、间歇、脉冲

**触觉配置**：
- 启用：是/否
- 强度：0-100%
- 模式：连续、间歇

**默认配置**：
- 颜色：绿色
- 闪烁：否
- 声音：禁用
- 触觉：禁用

#### 5.4.3 颜色编码状态系统

**状态颜色配置**：
- 正常状态：
  - 主色：青色 (#00FFFF)
  - 辅助色：绿色 (#00FF00)
  - 背景色：深灰 (#333333)
  - 文字色：浅灰 (#CCCCCC)
- 警告状态：
  - 主色：橙色 (#FFA500)
  - 辅助色：黄色 (#FFFF00)
  - 背景色：深黄 (#CCCC00)
  - 文字色：浅黄 (#FFFFCC)
- 警报状态：
  - 主色：红色 (#FF0000)
  - 辅助色：深红 (#8B0000)
  - 背景色：深红 (#660000)
  - 文字色：浅红 (#FFCCCC)
- 危急状态：
  - 主色：暗红 (#800000)
  - 辅助色：深红 (#8B0000)
  - 背景色：深红 (#660000)
  - 文字色：浅红 (#FFCCCC)
- 离线状态：
  - 主色：灰色 (#808080)
  - 辅助色：深灰 (#696969)
  - 背景色：深灰 (#333333)
  - 文字色：浅灰 (#CCCCCC)

### 5.5 改进操作界面

#### 5.5.1 操作确认机制

**操作日志记录**：
```typescript
interface OperationLog {
  id: string;
  timestamp: number;
  operator: string;
  operation: string;
  parameters: Record<string, number>;
  result: 'success' | 'failure' | 'partial';
  duration: number;
  affectedSystems: string[];
  triggeredAlarms: string[];
}

function addOperationLog(
  operator: string,
  operation: string,
  parameters: Record<string, number>,
  result: 'success' | 'failure' | 'partial',
  duration: number,
  affectedSystems: string[],
  triggeredAlarms: string[]
): void {
  const log: OperationLog = {
    id: generateId(),
    timestamp: Date.now(),
    operator,
    operation,
    parameters,
    result,
    duration,
    affectedSystems,
    triggeredAlarms
  };
  
  logSystem.add(log);
  
  if (logSystem.count() > 10000) {
    logSystem.removeOldest();
  }
}
```

#### 5.5.2 快捷操作面板

**快捷操作配置**：
```typescript
interface QuickOperation {
  id: string;
  name: string;
  icon: string;
  category: 'startup' | 'shutdown' | 'emergency' | 'routine';
  shortcut: string;
  riskLevel: 'low' | 'medium' | 'high' | 'critical';
  usageFrequency: number;
  lastUsedTime: number;
  enabled: boolean;
}

interface QuickOperationPanel {
  operations: QuickOperation[];
  layout: 'grid' | 'list' | 'custom';
  customization: {
    userDefined: QuickOperation[];
    hidden: string[];
    pinned: string[];
  };
}
```

**快捷操作示例**：
- 紧急停堆：
  - 图标：警告图标
  - 类别：紧急
  - 快捷键：Ctrl+Shift+S
  - 风险级别：危急
  - 使用频率：0
  - 最后使用时间：0
  - 启用状态：true
- 启动汽轮机：
  - 图标：旋转图标
  - 类别：启动
  - 快捷键：Ctrl+T
  - 风险级别：中
  - 使用频率：5
  - 最后使用时间：1小时前
  - 启用状态：true
- 应急冷却：
  - 图标：雪花图标
  - 类别：紧急
  - 快捷键：Ctrl+E
  - 风险级别：高
  - 使用频率：1
  - 最后使用时间：1天前
  - 启用状态：true
- 正常停机：
  - 图标：停止图标
  - 类别：停机
  - 快捷键：Ctrl+D
  - 风险级别：中
  - 使用频率：2
  - 最后使用时间：2天前
  - 启用状态：true

**布局**：网格模式
**自定义配置**：
- 用户定义的操作：无
- 隐藏的操作：无
- 固定的操作：紧急停堆、应急冷却

---

## 六、技术实现详细方案

### 6.1 核心架构优化

**建议采用模块化架构**：

**目录结构**：
```
src/
├── models/           # 物理模型
│   ├── thermal/      # 热工水力模型
│   │   ├── massBalance.ts
│   │   ├── energyBalance.ts
│   │   ├── flowResistance.ts
│   │   └── waterSteamProperties.ts
│   ├── neutron/     # 中子物理模型
│   │   ├── voidCoefficient.ts
│   │   ├── xenonPoisoning.ts
│   │   └── controlRodPhysics.ts
│   └── systems/      # 各系统模型
│       ├── reactorCore.ts
│       ├── turbine.ts
│       ├── condenser.ts
│       └── deaerator.ts
├── stores/           # 状态管理
│   ├── mainStore.ts
│   ├── subsystemStore.ts
│   └── alarmStore.ts
├── controllers/      # 控制逻辑
│   ├── manualControl.ts
│   ├── automaticControl.ts
│   └── safetySystem.ts
├── workers/          # Web Workers
│   ├── physicsCalculation.worker.ts
│   ├── calculation.worker.ts
│   └── dataProcessing.worker.ts
├── views/           # 界面
│   ├── panels/       # 单个面板
│   ├── overview/     # 概览视图
│   ├── schematics/    # 系统流程图
│   └── components/    # 可重用组件
└── utils/           # 工具函数
    ├── calculations.ts
    ├── conversions.ts
    └── validation.ts
```

### 6.2 Web Workers实现

**物理计算Worker**：
```typescript
// physicsCalculation.worker.ts
self.onmessage = (e) => {
  const { type, data } = e.data;
  
  switch (type) {
    case 'calculateMassBalance':
      const result = calculateMassBalance(data);
      self.postMessage({ type: 'massBalanceResult', data: result });
      break;
      
    case 'calculateEnergyBalance':
      const result = calculateEnergyBalance(data);
      self.postMessage({ type: 'energyBalanceResult', data: result });
      break;
      
    case 'calculateVoidCoefficient':
      const result = calculateVoidCoefficient(data);
      self.postMessage({ type: 'voidCoefficientResult', data: result });
      break;
      
    case 'calculateXenonPoisoning':
      const result = calculateXenonPoisoning(data);
      self.postMessage({ type: 'xenonPoisoningResult', data: result });
      break;
  }
};

function calculateMassBalance(data: MassBalanceInput): MassBalanceOutput {
  const { m_feedwater, m_steam, m_condensate, m_cooling } = data;
  
  const dM_reactor = m_feedwater - m_steam;
  const dM_condenser = m_steam - m_condensate + m_cooling;
  const dM_deaerator = m_condensate + m_steam_heating - m_feedwater_out;
  
  return {
    dM_reactor,
    dM_condenser,
    dM_deaerator,
    newMasses: {
      M_reactor: data.M_reactor + dM_reactor,
      M_condenser: data.M_condenser + dM_condenser,
      M_deaerator: data.M_deaerator + dM_deaerator
    }
  };
}

function calculateEnergyBalance(data: EnergyBalanceInput): EnergyBalanceOutput {
  const { P_nuclear, η_thermal, h_steam, h_feedwater, η_turbine, η_generator } = data;
  
  const Q_thermal = P_nuclear * η_thermal;
  const m_steam = Q_thermal / (h_steam - h_feedwater);
  const ΔT_coolant = Q_thermal / (data.m_coolant * data.c_p);
  const P_mechanical = m_steam * (data.h_inlet - data.h_outlet) * η_turbine;
  const P_electrical = P_mechanical * η_generator;
  
  return {
    Q_thermal,
    m_steam,
    ΔT_coolant,
    P_mechanical,
    P_electrical
  };
}

function calculateVoidCoefficient(data: VoidCoefficientInput): VoidCoefficientOutput {
  const { α_void, Δα, P_current, τ_delay } = data;
  
  const ρ_void = α_void * Δα;
  const P_new = P_current * (1 + ρ_void);
  const P_delayed = P_new; // 简化模型，实际需要延迟处理
  
  return {
    ρ_void,
    P_new,
    P_delayed
  };
}

function calculateXenonPoisoning(data: XenonPoisoningInput): XenonPoisoningOutput {
  const { Xe, I, λ_Xe, λ_I, σ_Xe, φ, γ_Xe, γ_I, Σ_f } = data;
  
  const dXe_dt = λ_I * I - λ_Xe * Xe - σ_Xe * φ * Xe + γ_Xe * Σ_f * φ;
  const dI_dt = γ_I * Σ_f * φ - λ_I * I;
  
  const Xe_new = Xe + dXe_dt * data.dt;
  const I_new = I + dI_dt * data.dt;
  
  const ρ_Xe = -σ_Xe * Xe_new / Σ_f;
  
  return {
    Xe_new,
    I_new,
    ρ_Xe
  };
}
```

**计算Worker**：
```typescript
// calculation.worker.ts
self.onmessage = (e) => {
  const { type, data } = e.data;
  
  switch (type) {
    case 'calculateTrend':
      const result = calculateTrend(data);
      self.postMessage({ type: 'trendResult', data: result });
      break;
      
    case 'calculatePrediction':
      const result = calculatePrediction(data);
      self.postMessage({ type: 'predictionResult', data: result });
      break;
      
    case 'validateParameters':
      const result = validateParameters(data);
      self.postMessage({ type: 'validationResult', data: result });
      break;
  }
};

function calculateTrend(data: TrendInput): TrendOutput {
  const { history, currentValue } = data;
  const previousValue = history[history.length - 1] || currentValue;
  const rateOfChange = currentValue - previousValue;
  
  let trend: 'rising' | 'falling' | 'stable';
  if (Math.abs(rateOfChange) < 0.01) {
    trend = 'stable';
  } else if (rateOfChange > 0) {
    trend = 'rising';
  } else {
    trend = 'falling';
  }
  
  const prediction = {
    shortTerm: currentValue + rateOfChange * 5,
    mediumTerm: currentValue + rateOfChange * 30,
    longTerm: currentValue + rateOfChange * 120
  };
  
  const variance = calculateVariance(history);
  const confidence = Math.max(0, 1 - variance / Math.abs(currentValue));
  
  return {
    trend,
    rateOfChange,
    prediction,
    confidence
  };
}

function calculatePrediction(data: PredictionInput): PredictionOutput {
  const { currentValue, rateOfChange, timeHorizon } = data;
  
  const prediction = currentValue + rateOfChange * timeHorizon;
  const uncertainty = Math.abs(rateOfChange) * timeHorizon * 0.5;
  
  return {
    prediction,
    uncertainty
  };
}

function validateParameters(data: ValidationInput): ValidationResult {
  const { parameters, thresholds } = data;
  const violations: Violation[] = [];
  
  for (const param of parameters) {
    const threshold = thresholds[param.id];
    if (threshold) {
      if (param.value > threshold.max) {
        violations.push({
          parameterId: param.id,
          type: 'exceeds_maximum',
          value: param.value,
          threshold: threshold.max
        });
      } else if (param.value < threshold.min) {
        violations.push({
          parameterId: param.id,
          type: 'below_minimum',
          value: param.value,
          threshold: threshold.min
        });
      }
    }
  }
  
  return {
    valid: violations.length === 0,
    violations
  };
}
```

**数据处理Worker**：
```typescript
// dataProcessing.worker.ts
self.onmessage = (e) => {
  const { type, data } = e.data;
  
  switch (type) {
    case 'processAlarmData':
      const result = processAlarmData(data);
      self.postMessage({ type: 'alarmDataResult', data: result });
      break;
      
    case 'processTrendData':
      const result = processTrendData(data);
      self.postMessage({ type: 'trendDataResult', data: result });
      break;
      
    case 'generateReport':
      const result = generateReport(data);
      self.postMessage({ type: 'reportResult', data: result });
      break;
  }
};

function processAlarmData(data: AlarmDataInput): AlarmDataOutput {
  const { alarms, acknowledgedAlarms } = data;
  
  const unacknowledgedAlarms = alarms.filter(
    alarm => !acknowledgedAlarms.includes(alarm.id)
  );
  
  const criticalAlarms = unacknowledgedAlarms.filter(
    alarm => alarm.severity === 'critical'
  );
  
  const alarmSummary = {
    total: alarms.length,
    unacknowledged: unacknowledgedAlarms.length,
    critical: criticalAlarms.length,
    bySeverity: {
      info: alarms.filter(a => a.severity === 'info').length,
      warning: alarms.filter(a => a.severity === 'warning').length,
      alarm: alarms.filter(a => a.severity === 'alarm').length,
      critical: criticalAlarms.length
    }
  };
  
  return {
    unacknowledgedAlarms,
    criticalAlarms,
    alarmSummary
  };
}

function processTrendData(data: TrendDataInput): TrendDataOutput {
  const { history, timeWindow } = data;
  
  const recentHistory = history.filter(
    entry => entry.timestamp >= Date.now() - timeWindow
  );
  
  const trends = recentHistory.map(entry => ({
    parameterId: entry.parameterId,
    value: entry.value,
    timestamp: entry.timestamp,
    trend: calculateTrend(recentHistory, entry.parameterId)
  }));
  
  return {
    recentHistory,
    trends
  };
}

function generateReport(data: ReportInput): ReportOutput {
  const { startTime, endTime, events } = data;
  
  const report = {
    summary: {
      startTime,
      endTime,
      duration: endTime - startTime,
      totalEvents: events.length,
      eventsByType: groupEventsByType(events)
    },
    details: events,
    statistics: calculateStatistics(events)
  };
  
  return report;
}
```

---

## 七、实施路线图详细规划

### 7.1 第一阶段：基础优化（1-2个月）

**目标**：建立基础物理模型和改进用户界面

**任务清单**：

1. **物理模型基础**
   - [ ] 实现质量守恒方程
   - [ ] 实现能量守恒方程
   - [ ] 实现基本的热工水力计算
   - [ ] 实现简化的中子物理模型
   - [ ] 实现基本的系统间耦合

2. **用户界面改进**
   - [ ] 重新设计单个系统详细视图
   - [ ] 实现系统集成概览视图
   - [ ] 实现关键参数监控仪表板
   - [ ] 添加参数变化趋势指示器
   - [ ] 实现声光警报系统
   - [ ] 实现颜色编码状态系统

3. **代码架构优化**
   - [ ] 建立模块化架构
   - [ ] 实现Web Workers
   - [ ] 优化状态管理
   - [ ] 改进错误处理

**预期成果**：
- 基础物理模型运行正常
- 用户界面更加直观和易用
- 代码架构更加清晰和可维护
- 性能提升30-50%

### 7.2 第二阶段：功能扩展（2-3个月）

**目标**：扩展物理模型和添加高级功能

**任务清单**：

1. **物理模型扩展**
   - [ ] 实现详细的热工水力计算
   - [ ] 实现完整的中子物理模型
   - [ ] 实现正空泡系数效应
   - [ ] 实现氙-135中毒效应
   - [ ] 实现控制棒物理特性
   - [ ] 实现系统间详细耦合

2. **系统功能扩展**
   - [ ] 实现三冲量水位控制
   - [ ] 实现汽轮机旁路系统
   - [ ] 实现堆芯冷却剂净化系统
   - [ ] 实现故障模拟系统
   - [ ] 实现紧急停堆过程

3. **用户界面扩展**
   - [ ] 实现操作确认机制
   - [ ] 实现快捷操作面板
   - [ ] 添加系统流程图
   - [ ] 实现历史数据查看
   - [ ] 实现报告生成功能

**预期成果**：
- 物理模型更加准确和真实
- 系统功能更加完整
- 用户界面更加功能丰富
- 模拟器真实性提升50-70%

### 7.3 第三阶段：高级特性（3-4个月）

**目标**：实现高级特性和优化性能

**任务清单**：

1. **高级物理模型**
   - [ ] 实现IAPWS-97标准公式
   - [ ] 实现详细的两相流模型
   - [ ] 实现动态响应时间
   - [ ] 实现参数校准系统
   - [ ] 实现预测算法

2. **高级系统功能**
   - [ ] 实现真实的启动流程
   - [ ] 实现停机流程
   - [ ] 实现故障诊断系统
   - [ ] 实现自动恢复系统
   - [ ] 实现优化建议系统

3. **高级用户界面**
   - [ ] 实现虚拟现实界面
   - [ ] 实现增强现实显示
   - [ ] 实现语音控制
   - [ ] 实现手势控制
   - [ ] 实现AI辅助决策

4. **性能优化**
   - [ ] 优化Web Workers性能
   - [ ] 优化渲染性能
   - [ ] 优化数据传输
   - [ ] 实现缓存机制
   - [ ] 实现懒加载

**预期成果**：
- 物理模型达到专业级精度
- 系统功能完全实现
- 用户界面达到现代化水平
- 模拟器真实性提升80-100%
- 性能提升50-70%

---

## 八、核心物理公式与计算方法

### 8.1 中子动力学与核反应

#### 8.1.1 中子输运方程

中子输运方程（Boltzmann 方程）是反应堆物理的基石，详细描述了中子密度、能量和方向的变化：

```
(1/v(E)) × (∂φ(r, E, Ω, t)/∂t) = -Ω·∇φ(r, E, Ω, t) - Σ_t(r, E)φ(r, E, Ω, t)
+ ∫₀^∞ ∫₄π Σ_s(r, E'→E, Ω'→Ω)φ(r, E', Ω', t)dE'dΩ'
+ (χ(E)/4π) × ∫₀^∞ ν(E')Σ_f(r, E')φ(r, E', t)dE'
```

**参数说明**：
- `φ(r, E, Ω, t)`：中子通量（位置r，能量E，方向Ω，时间t）
- `v(E)`：中子速度（与能量E相关）
- `Σ_t`：总截面（吸收 + 散射）
- `Σ_s`：散射截面（能量和方向变化）
- `Σ_f`：裂变截面
- `χ(E)`：裂变中子能量谱
- `ν(E')`：每次裂变产生的中子数（与能量E'相关）

#### 8.1.2 多群扩散理论

为了简化中子输运方程，使用多群扩散理论，将中子能量划分为G个能群：

```
(1/v_g) × (∂φ_g(r, t)/∂t) = ∇·(D_g∇φ_g(r, t)) - Σ_{a,g}φ_g(r, t)
+ Σ_{g'=1}^G Σ_{s,g'→g}φ_{g'}(r, t)
+ χ_g × Σ_{g'=1}^G νΣ_{f,g'}φ_{g'}(r, t)
```

**参数说明**：
- `g`：能群索引（g = 1, 2, ..., G）
- `D_g`：扩散系数（D_g = 1/(3Σ_{tr,g})，Σ_{tr,g}是输运截面）
- `Σ_{a,g}`：吸收截面
- `Σ_{s,g'→g}`：散射截面（从能群g'到g）
- `χ_g`：裂变中子在第g能群的份额

### 8.2 热力学与传热模型

#### 8.2.1 燃料棒热传导

燃料棒中的温度分布由热传导方程描述：

```
ρc_p(∂T/∂t) = ∇·(k∇T) + q'''
```

**参数说明**：
- `T`：温度
- `ρ`：密度
- `c_p`：比热容
- `k`：热导率
- `q'''`：体积热源（q''' = Σ_fφ）

#### 8.2.2 两相流与沸腾传热

RBMK-1000使用轻水冷却剂，需要详细建模两相流：

**质量守恒方程**：
```
∂ρ_mix/∂t + ∇·(ρ_mixu) = 0
```

**动量守恒方程**：
```
∂(ρ_mixu)/∂t + ∇·(ρ_mixuu) = -∇p + ∇·τ + ρ_mixg
```

**能量守恒方程**：
```
∂(ρ_mixh)/∂t + ∇·(ρ_mixuh) = ∇·(k_eff∇T) + q'''
```

**参数说明**：
- `ρ_mix`：混合密度（ρ_mix = αρ_g + (1-α)ρ_l）
- `u`：流速
- `p`：压力
- `τ`：剪切应力张量
- `g`：重力加速度
- `h`：比焓
- `k_eff`：有效热导率

### 8.3 控制棒与反应性管理

#### 8.3.1 控制棒插入效应

控制棒插入深度与反应性的关系：

```
ρ_control(t) = ρ_max × (1 - z(t)/L)
```

**参数说明**：
- `ρ_max`：控制棒完全插入时的最大反应性
- `z(t)`：控制棒插入深度
- `L`：控制棒总长度

#### 8.3.2 温度与空泡反应性系数

**温度反应性系数**：
```
ρ_temperature(t) = α_T × ΔT(t)
```

**空泡反应性系数**：
```
ρ_void(t) = α_v × Δα(t)
```

**参数说明**：
- `α_T`：温度反应性系数
- `α_v`：空泡反应性系数
- `ΔT(t)`：温度变化
- `Δα(t)`：空泡份额变化

### 8.4 功率计算

#### 8.4.1 功率的基本公式

核反应堆的功率P直接与裂变反应释放的能量和中子通量相关：

```
P = ∫_V Σ_f(r, E)φ(r, E) × E_f × dV × dE
```

**参数说明**：
- `Σ_f(r, E)`：裂变截面（与位置r和能量E相关）
- `φ(r, E)`：中子通量（与位置r和能量E相关）
- `E_f`：每次裂变释放的能量（约200 MeV = 3.2×10⁻¹¹ J）
- `V`：反应堆体积

#### 8.4.2 简化公式（适用于均匀反应堆）

如果假设反应堆是均匀的，且中子通量和裂变截面不随位置变化，公式可简化为：

```
P = Σ_f × φ × E_f × V
```

#### 8.4.3 功率的时间依赖性

功率随时间的变化可以通过反应堆动力学方程描述：

```
dP(t)/dt = (ρ(t) - β)/Λ × P(t) + Σ_{i=1}^6 λ_iC_i(t)
```

**参数说明**：
- `ρ(t)`：反应性
- `β`：总延迟中子份额
- `Λ`：中子代时间
- `C_i(t)`：第i组延迟中子先驱核的浓度
- `λ_i`：第i组延迟中子先驱核的衰变常数

### 8.5 堆芯温度和压力计算

#### 8.5.1 堆芯温度的计算

**燃料温度**：
```
ρ_fc_pf(∂T_f/∂t) = ∇·(k_f∇T_f) + q'''
```

**冷却剂温度**：
```
ρ_cc_pc(∂T_c/∂t + u·∇T_c) = ∇·(k_c∇T_c) + q''
```

**包壳温度**：
```
ρ_sc_ps(∂T_s/∂t) = ∇·(k_s∇T_s) + q''
```

**参数说明**：
- `T_f`：燃料温度
- `ρ_f`：燃料密度
- `c_pf`：燃料比热容
- `k_f`：燃料热导率
- `T_c`：冷却剂温度
- `ρ_c`：冷却剂密度
- `c_pc`：冷却剂比热容
- `k_c`：冷却剂热导率
- `u`：冷却剂流速
- `T_s`：包壳温度
- `ρ_s`：包壳密度
- `c_ps`：包壳比热容
- `k_s`：包壳热导率

#### 8.5.2 堆芯压力的计算

**冷却剂压力**：
```
∂(ρ_cu)/∂t + ∇·(ρ_cuu) = -∇p + ∇·τ + ρ_cg
```

**饱和压力**：
```
log₁₀p_sat = A - B/(T_sat + C)
```

**参数说明**：
- `p`：冷却剂压力
- `τ`：剪切应力张量
- `g`：重力加速度
- `p_sat`：饱和压力
- `T_sat`：饱和温度
- `A, B, C`：经验常数（对水，A=8.07131, B=1730.63, C=233.426）

### 8.6 RBMK-1000关键参数

**反应堆核心参数**：
- 热功率：3200 MW
- 燃料：2%浓缩铀-235
- 慢化剂：石墨
- 冷却剂：轻水
- 控制棒数：211根
- 正空泡系数：+4.7×10⁻⁵

**汽轮机参数**：
- 额定转速：3000 RPM（欧洲标准）
- 额定功率：1000 MW
- 效率：85%

**辅助系统参数**：
- 凝汽器真空：95%以上
- 除氧器压力：0.11-0.17 MPa
- 热井水位：0英寸

---

## 九、CHRNOBYL RBMK-1000模拟器详细分析

---

## 9.1 反应堆核心控制逻辑

### 9.1.1 核心模型接口（PROCMDI.cs）

该模块是整个模拟器的核心，通过DLL接口与物理模型交互。

#### 关键DLL函数

| 函数名 | 功能说明 |
|--------|----------|
| `GETMK()` | 获取反应堆功率水平 |
| `GETFLX()` | 获取中子通量 |
| `GETXE(ref short I)` | 获取氙和碘浓度（I=1为氙，I=2为碘） |
| `GETTHR(ref float lPARAM)` | 获取热功率分布（25个区域） |
| `GETROD(ref short I, ref short j)` | 获取控制棒位置 |
| `SETROD(ref float X, ref short I, ref short j, ref short k)` | 设置控制棒位置 |
| `GETERR()` | 获取控制误差 |
| `GETSPT()` | 获取功率设定点 |
| `SETSPT(ref float X, ref short I)` | 设置功率设定点 |
| `SETAUT(ref short I)` | 设置自动控制模式 |
| `TRIPIT(ref short IVAL, ref short I)` | 触发停堆 |

#### 核心变量

| 变量名 | 类型 | 说明 |
|--------|------|------|
| `MKVALUE` | float | 反应堆功率值 |
| `FLX` | float | 中子通量 |
| `XEN` | float | 氙浓度 |
| `IOD` | float | 碘浓度 |
| `RXRATE` | float | 反应堆功率变化率 |
| `RXERR` | float | 反应堆控制误差 |
| `AVGRAT` | float | 平均功率变化率 |
| `AVGERR` | float | 平均控制误差 |

#### 1.2 反应堆控制显示（disp_rx_control）

实时显示关键参数：

- 功率变化率百分比
- 平均热功率
- 中子通量（线性和对数）
- 控制棒束位置百分比
- 功率设定点
- 控制误差百分比
- 自动控制状态指示
- 轴向偏移控制状态

**实现代码示例：**

```csharp
public static void disp_rx_control()
{
    MyProject.Forms.MainForm.CBStatic.RX_CONTROL.Label5.Text = Support.Format(AVGRAT / (float)GLOBALRX.maxiterates, "##0.0%");
    MyProject.Forms.MainForm.CBStatic.RX_CONTROL.Label7.Text = Support.Format(avgchp, "##0.0%");
    MyProject.Forms.MainForm.CBStatic.RX_CONTROL.Label9.Text = Support.Format(FLX, "##0.0%");
    MyProject.Forms.MainForm.CBStatic.RX_CONTROL.Label16.Text = Support.Format(Math.Log((double)FLX + 1E-10) / Math.Log(10.0), "0.00");
    MyProject.Forms.MainForm.CBStatic.RX_CONTROL.Label4.Text = Support.Format(GETSPT(), "##0.0%");
    MyProject.Forms.MainForm.CBStatic.RX_CONTROL.Label3.Text = Support.Format(AVGERR / (float)GLOBALRX.maxiterates, "##0.0%");
}
```

---

## 9.2 控制棒系统详细实现

### 2.1 控制棒控制面板（REACT_ROD.cs）

#### 控制功能

**Command1_Click - 全部控制棒紧急插入**

```csharp
private void Command1_Click(object eventSender, EventArgs eventArgs)
{
    short I = 2;
    float X = (float)(1.0 - (double)GETMOV(ref I));
    I = 0;
    short j = 0;
    short k = 4;
    SETROD(ref X, ref I, ref j, ref k);
    X = 0f;
    k = 0;
    j = 0;
    I = 1;
    SETROD(ref X, ref k, ref j, ref I);
}
```

**Command2_Click - 手动/自动模式切换**

```csharp
private void Command2_Click(object eventSender, EventArgs eventArgs)
{
    string name = ((Button)eventSender).Name;
    short num = (short)int.Parse(Strings.Right(name, 1));
    float X = 1 - num;
    short I = 0;
    short j = 0;
    short k = 1;
    SETROD(ref X, ref I, ref j, ref k);
}
```

**Spin1_SpinDown/Up - 精细调整控制棒位置**

```csharp
private void Spin1_SpinDown(object sender, EventArgs e)
{
    int num = int.Parse(Strings.Right(Conversions.ToString(NewLateBinding.LateGet(sender, null, "Name", new object[0], null, null, null)), Conversions.ToInteger(Operators.SubtractObject(NewLateBinding.LateGet(NewLateBinding.LateGet(sender, null, "name", new object[0], null, null, null), null, "length", new object[0], null, null, null), 6)))) - 1;
    Application.DoEvents();
    short I = (short)unchecked(num % 5);
    short j = (short)Math.Round(Conversion.Int((double)num / 5.0));
    float X = 0.01f;
    short k = 2;
    SETROD(ref X, ref I, ref j, ref k);
}

private void Spin1_SpinUp(object sender, EventArgs e)
{
    int num = int.Parse(Strings.Right(Conversions.ToString(NewLateBinding.LateGet(sender, null, "Name", new object[0], null, null, null)), Conversions.ToInteger(Operators.SubtractObject(NewLateBinding.LateGet(NewLateBinding.LateGet(sender, null, "name", new object[0], null, null, null), null, "length", new object[0], null, null, null), 6)))) - 1;
    Application.DoEvents();
    short I = (short)unchecked(num % 5);
    short j = (short)Math.Round(Conversion.Int((double)num / 5.0));
    float X = -0.01f;
    short k = 2;
    SETROD(ref X, ref I, ref j, ref k);
}
```

#### 控制棒参数

| 参数 | 值/范围 | 说明 |
|------|----------|------|
| 网格布局 | 5×5 | 25个控制棒组 |
| 位置范围 | 0-1 | 0=完全插入，1=完全抽出 |
| 移动速度 | 0.01步长/点击 | 精细调整步长 |
| 支持操作 | 拖拽 | 燃料更换模拟 |

#### 安全互锁

- 控制棒移动前检查设备故障状态
- 自动模式下的位置限制
- 紧急插入时的快速响应机制

---

## 9.3 给水系统完整控制流程

### 3.1 给水泵控制（feed_pmp.cs）

#### 泵控制逻辑

```csharp
private void Command1_Click(object eventSender, EventArgs eventArgs)
{
    short index = Command1.GetIndex((Button)eventSender);
    checked
    {
        short I = (short)Math.Round(Conversion.Int((double)index / 2.0));
        short I2 = (short)(I + 6);
        if (unchecked(index % 2) == 1)
        {
            short j = 0;
            bool num = (double)GETISO(ref I, ref j) > 0.99;
            short j2 = 1;
            if (num & ((double)GETISO(ref I, ref j2) < 0.01))
            {
                GLOBALRX.PLAY_TXT_AFTER_AVI = 0;
                short j3 = (short)(I + 4);
                Form frm = this;
                short num2 = PROCMDI.check_4_malf(ref j3, ref frm);
                j2 = (short)(I + 3);
                if (unchecked(GETFED(ref j2) != 1f && num2 == 0))
                {
                    Command1[(short)(index - 1)].Tag = Support.Format(GLOBALRX.next_snd_index, "0");
                    j2 = 1;
                    MyProject.MyForms forms = MyProject.Forms;
                    frm = forms.model_timer;
                    SOUNDS.START_SOUND(ref j2, ref frm);
                    forms.model_timer = (model_timer)frm;
                }
                else
                {
                    Command1[(short)(index - 1)].Tag = "";
                }
                j2 = 1;
                SETPMP(ref I2, ref j2);
            }
        }
        else
        {
            short j2 = 0;
            SETPMP(ref I2, ref j2);
            string text = Conversions.ToString(Command1[index].Tag);
            Command1[index].Tag = "";
        }
    }
}
```

#### 给水系统组件

| 组件 | 数量 | 编号范围 | 说明 |
|------|------|----------|------|
| 主给水泵 | 6台 | 0-5 | 对应泵索引6-11 |
| 隔离阀 | 每台泵2个 | 进出口 | 流量控制 |
| 流量控制 | Spin1 | ±0.005步长 | 微调流量 |
| 水位控制 | Text1 | 手动输入 | 直接设定 |

#### 安全检查

- 启动前检查隔离阀状态
- 检查设备故障（通过check_4_malf函数）
- 低流量保护
- 水位过高/过低保护

### 3.2 给水加热器（feedHTR_0.cs）

#### 监控参数

- 加热器进出口温度
- 加热器流量
- 蒸汽压力
- 给水总流量计算

### 9.3.3 给水系统总览（feedsys_0.cs）

#### 系统级监控

- 给水总管压力、温度、水位、流量
- 各泵运行状态
- 系统流量平衡

---

## 9.4 汽轮机控制系统详细机制

### 9.4.1 汽轮机主控（turbine_s_ctrl.cs）

#### 控制功能

```csharp
private void Command1_Click(object eventSender, EventArgs eventArgs)
{
    short index = Command1.GetIndex((Button)eventSender);
    float X = index;
    short I = 10;
    SETTRB(ref X, ref I);
}

private void Command2_Click(object eventSender, EventArgs eventArgs)
{
    short index = Command2.GetIndex((Button)eventSender);
    float X = checked(900 * index);
    short I = 4;
    SETTRB(ref X, ref I);
}

private void Command3_Click(object eventSender, EventArgs eventArgs)
{
    short index = Command3.GetIndex((Button)eventSender);
    float X = index;
    short I = 1;
    SETTRB(ref X, ref I);
    if (index != 1)
    {
        return;
    }
    GLOBALRX.PLAY_TXT_AFTER_AVI = 0;
    short j = 65;
    checked
    {
        short num2;
        short num3;
        do
        {
            Form frm = this;
            short num = PROCMDI.check_4_malf(ref j, ref frm);
            if (num > 0)
            {
                break;
            }
            j = (short)unchecked(j + 1);
            num2 = j;
            num3 = 67;
        }
        while (num2 <= num3);
    }
}
```

#### 关键控制参数

| 参数 | 索引 | 范围 | 说明 |
|------|------|------|------|
| 转速控制 | I=10 | 0-1 | 对应0-100%负荷 |
| 负荷控制 | I=4 | 0-9000步长 | 每步900kW |
| 自动控制 | I=1 | 0/1 | 启用/禁用自动调速器 |
| 超速保护 | - | 3000RPM | 额定转速的超速保护 |

#### 实时显示

- 汽轮机转速（3000RPM额定）
- 蒸汽压力
- 蒸汽温度（主蒸汽、再热蒸汽）
- 排汽温度
- 负荷百分比
- 阀门位置指示

### 9.4.2 汽轮机辅助系统（turb_aux.cs）

#### 辅助控制

```csharp
private void Image2_Click(object eventSender, EventArgs eventArgs)
{
    short index = Image2.GetIndex((PictureBox)eventSender);
    float X = index;
    short I = 12;
    SETTRB(ref X, ref I);
    Image2[index].Image = Image1[3].Image;
    Image2[checked((short)(1 - index))].Image = Image1[0].Image;
}

private void Image3_Click(object eventSender, EventArgs eventArgs)
{
    short index = Image3.GetIndex((PictureBox)eventSender);
    float X = index;
    short I = 13;
    SETTRB(ref X, ref I);
    Image3[index].Image = Image1[3].Image;
    Image3[checked((short)(1 - index))].Image = Image1[0].Image;
}

private void Image4_Click(object eventSender, EventArgs eventArgs)
{
    short index = Image4.GetIndex((PictureBox)eventSender);
    float X = index;
    short I = 14;
    SETTRB(ref X, ref I);
    Image4[index].Image = Image1[3].Image;
    Image4[checked((short)(1 - index))].Image = Image1[0].Image;
}

private void Image5_Click(object eventSender, EventArgs eventArgs)
{
    short index = Image5.GetIndex((PictureBox)eventSender);
    float X = index;
    short I = 15;
    SETTRB(ref X, ref I);
    Image5[index].Image = Image1[3].Image;
    Image5[checked((short)(1 - index))].Image = Image1[0].Image;
}
```

| 设备 | 索引 | 功能 |
|------|------|------|
| 润滑油泵 | I=12 | 主/备用切换 |
| 冷却水泵 | I=13 | 主/备用切换 |
| 真空泵 | I=14 | 主/备用切换 |
| 密封水泵 | I=15 | 主/备用切换 |

### 9.4.3 汽轮机参数监控（turbine_0.cs）

#### 监控参数

- 主蒸汽压力、温度
- 高压缸排汽温度
- 中压缸排汽温度
- 低压缸排汽温度
- 给水流量
- 负荷百分比

---

## 9.5 安全系统和互锁机制

### 5.1 紧急堆芯冷却系统（SD_COOLING.cs）

#### ECCS控制

```csharp
private void Image1_MouseDown(object eventSender, MouseEventArgs eventArgs)
{
    checked
    {
        short num = (short)unchecked((int)eventArgs.Button / 1048576);
        short num2 = (short)unchecked((int)Control.ModifierKeys / 65536);
        float num3 = (float)Support.PixelsToTwipsX(eventArgs.X);
        float num4 = (float)Support.PixelsToTwipsY(eventArgs.Y);
        short j = Image1.GetIndex((PictureBox)eventSender);
        short I = 14;
        SETPMP(ref I, ref j);
        Image1[j].Image = Image7[3].Image;
        Image1[(short)(1 - j)].Image = Image7[0].Image;
    }
}
```

| 系统 | 索引 | 功能 |
|------|------|------|
| 高压注水泵 | I=14 | 主/备用切换 |
| 低压注水泵 | I=15 | 主/备用切换 |
| 应急冷却泵 | I=16 | 主/备用切换 |
| 安全注水阀 | I=17-19 | 独立控制 |

#### 安全功能

- 自动触发（当检测到LOCA）
- 手动触发（操作员干预）
- 流量监控和显示
- 系统状态指示

### 9.5.2 报警系统（ALARMS.cs）

#### 报警功能

```csharp
private void Command1_Click(object eventSender, EventArgs eventArgs)
{
    PROCMDI.ack_alarms();
}

private void Command2_Click(object eventSender, EventArgs eventArgs)
{
    GLOBALRX.ALARM_SILENCE = (short)(~GLOBALRX.ALARM_SILENCE);
    if (GLOBALRX.ALARM_SILENCE != 0)
    {
        short index = 0;
        string command_Renamed = "STOP";
        SOUNDS.ControlSoundPlayback(ref index, ref command_Renamed, ref GLOBALRX.alarm_filename);
    }
}

private void Command3_Click(object eventSender, EventArgs eventArgs)
{
    WindowState = FormWindowState.Minimized;
}
```

| 功能 | 按钮 | 说明 |
|------|------|------|
| 报警确认 | Command1 | 确认所有报警 |
| 报警静音 | Command2 | 静音报警声音 |
| 报警最小化 | Command3 | 最小化报警窗口 |

#### 报警显示

- 最多显示20个报警
- 颜色编码（红色=紧急，黄色=警告）
- 报警优先级排序
- 声音报警（可静音）

#### 报警处理

```csharp
public static void DISP_ALARMS()
{
    DOALAR();  // 调用DLL获取报警
    short num = ALARMS_COLR(ref n);  // 获取报警颜色
    ALARMS_GET(ref command_Renamed, ref n);  // 获取报警文本
    // 更新显示
}
```

### 9.5.3 故障报告系统（FO_Report.cs）

#### 故障处理流程

1. 检测到设备故障时显示故障报告
2. 提供两个选项：
   - "现在修复"：调用SETMAL函数修复
   - "暂时忽略"：允许继续操作但设备不可用
3. 检查预算限制
4. 更新设备状态

#### 故障检测

```csharp
public static short check_4_malf(ref short j, ref Form frm)
{
    short mAL;
    if (GLOBALRX.PLAY_TXT_AFTER_AVI == 0)
    {
        GLOBALRX.THIS_MAL = j;
        short id = 0;
        mAL = GETMAL(ref j, ref id);
        if ((unchecked((short)(0 - ((mAL == 1) ? 1 : 0))) & ~GLOBALRX.fo_report_loaded) != 0)
        {
            GLOBALRX.malfnum = j;
            id = 1;
            short mAL2 = GETMAL(ref GLOBALRX.malfnum, ref id);
            GLOBALRX.yy_report = (short)Math.Round(Support.PixelsToTwipsY(MyProject.Forms.MainForm.Top) + Support.PixelsToTwipsY(frm.Top) + Support.PixelsToTwipsY(frm.Height) / 2.0);
            GLOBALRX.xx_report = (short)Math.Round(Support.PixelsToTwipsX(MyProject.Forms.MainForm.Left) + Support.PixelsToTwipsX(frm.Left) + Support.PixelsToTwipsX(frm.Width) / 2.0 - 2200.0);
            FO_Report fO_Report = new FO_Report();
            Support.ShowForm(fO_Report);
            fO_Report.Label1[1].Text = "$ " + Support.Format(mAL2, "####");
            fO_Report.Label1[0].Text = "This piece of equipment cannot be operated until it has been repaired";
            fO_Report.Label2.Text = "Repair it now";
            fO_Report.Label3.Text = "Ignore it for now";
        }
    }
    return mAL;
}
```

---

## 9.6 故障模拟和应急程序

### 9.6.1 故障模拟机制

#### 故障类型

- 设备故障（泵、阀、仪表）
- 管道破裂（LOCA模拟）
- 控制系统故障
- 仪表失灵

#### 故障设置

```csharp
[DllImport("chrnob_32.dll", CharSet = CharSet.Ansi, ExactSpelling = true, SetLastError = true)]
public static extern short SETMAL(ref short n, ref short id);
```

| 参数 | 说明 |
|------|------|
| n | 故障编号 |
| id | 故障类型（0=设置故障，1=获取修复费用，2=修复） |

### 6.2 应急程序

#### 紧急停堆（AZ-5）

- 快速插入所有控制棒
- 自动触发安全系统
- 记录事件和参数

#### 应急冷却

- 自动启动ECCS
- 手动干预选项
- 流量和压力监控

#### 应急操作员行动

- 故障诊断
- 系统隔离
- 替代系统启动
- 参数监控和调整

---

## 9.7 主控制面板详细分析

### 9.7.1 主控制面板结构（controlboard.cs）

主控制面板是整个模拟器的核心界面，提供对所有子系统的访问。

#### 面板映射表

| 面板编号 | 面板名称 | 对应文件 | 窗口类 | 尺寸 | 功能说明 |
|----------|----------|----------|--------|------|----------|
| 1 | 反应堆控制棒 | REACT_ROD.cs | REACT_ROD | 434×426 | 控制棒位置和燃料管理 |
| 2 | 反应堆功率调节 | RX_CONTROL.cs | RX_CONTROL | 276×314 | 功率设定和自动控制 |
| 3 | 再循环泵A | maincp1.cs | maincp1 | 220×270 | 回路1再循环泵控制 |
| 4 | 再循环泵B | maincp2.cs | maincp2 | 220×269 | 回路2再循环泵控制 |
| 5 | 应急冷却泵A | ECC_CONTROL.cs | ECC_CONTROL | 265×380 | ECCS泵控制 |
| 6 | 应急冷却泵B | SD_COOLING.cs | SD_COOLING | 386×246 | 堆芯离线冷却 |
| 7 | 反应堆排水控制 | Drain_ctrl.cs | Drain_ctrl | 225×109 | 排水阀控制 |
| 8 | 堆芯离线冷却泵 | SD_COOLING.cs | SD_COOLING | 386×246 | 离线冷却泵控制 |
| 9 | 汽轮机控制 | turbine_s_ctrl.cs | turbine_s_ctrl | 454×347 | 汽轮机转速和负荷 |
| 10 | 除氧器蒸汽控制 | deaer_P_CTRL.cs | deaer_P_CTRL | 266×145 | 除氧器压力控制 |
| 11 | 凝汽器真空系统 | cndsr_v.cs | cndsr_v | 215×139 | 真空泵和蒸汽喷射 |
| 12 | 蒸汽排汽控制 | bypass_0.cs | bypass_0 | 197×123 | 蒸汽旁路控制 |
| 13 | 汽轮机辅助系统 | turb_aux.cs | turb_aux | 193×246 | 润滑油、冷却水等 |
| 14 | 凝汽器热井液位 | HOTW_LEVEL_CTRL.cs | HOTW_LEVEL_CTRL | 368×115 | 热井水位控制 |
| 15 | 凝汽器循环水泵 | CNDSR_0.cs | CNDSR_0 | - | 循环水泵控制 |
| 16 | 补水系统 | COND_MAKEUP.cs | COND_MAKEUP | 233×195 | 凝结水补水 |
| 17 | 反应堆给水泵 | feed_pmp.cs | feed_pmp | 247×506 | 给水泵和流量控制 |
| 18 | 数据趋势图 | TRENDSv.cs | TRENDSv | - | 实时趋势显示 |
| 19 | HEPA过滤器控制 | HEPA_FLTR.cs | HEPA_FLTR | 244×177 | 通风过滤系统 |
| 20 | 警报CRT | ALARMS.cs | ALARMS | 328×244 | 报警显示和处理 |
| 21 | CRT示意图 | SCEMAT_0.cs | SCEMAT_0 | - | 系统流程图 |
| 22 | 凝结水系统 | DEaer_L_CTRL.cs | deaer_L_CTRL | 431×265 | 凝结水流量控制 |

#### 面板启动机制

```csharp
private void click1_MouseDown(object eventSender, MouseEventArgs eventArgs)
{
    checked
    {
        short num = (short)unchecked((int)eventArgs.Button / 1048576);
        string name = ((PictureBox)eventSender).Name;
        int num5 = int.Parse(Strings.Right(name, name.Length - 8));
        switch (num)
        {
        case 1:  // 左键点击
            Cursor = Cursors.WaitCursor;
            switch (num5)
            {
            case 0:  // 反应堆控制棒
                if (~GLOBALRX.react_rod_loaded != 0)
                {
                    REACT_ROD = new REACT_ROD();
                    Support.ShowForm(REACT_ROD);
                    REACT_ROD.WindowState = FormWindowState.Normal;
                    REACT_ROD rEACT_ROD = REACT_ROD;
                    Size size = new Size(434, 426);
                    rEACT_ROD.Size = size;
                }
                break;
            case 1:  // 反应堆功率调节
                if (~GLOBALRX.rx_control_loaded != 0)
                {
                    RX_CONTROL = new RX_CONTROL();
                    Support.ShowForm(RX_CONTROL);
                    RX_CONTROL.WindowState = FormWindowState.Normal;
                    RX_CONTROL rX_CONTROL = RX_CONTROL;
                    Size size = new Size(276, 314);
                    rX_CONTROL.Size = size;
                }
                break;
            // ... 其他面板
            }
            Cursor = Cursors.Default;
            break;
        case 2:  // 右键点击
            Form formused = this;
            ONTOPRX.move_to_bottom(ref formused);
            break;
        }
    }
}
```

### 7.2 反应堆控制棒系统（REACT_ROD.cs）

#### 核心功能

**1. 控制棒位置控制**

```csharp
[DllImport("chrnob_32.dll", CharSet = CharSet.Ansi, ExactSpelling = true, SetLastError = true)]
private static extern float GETROD(ref short I, ref short j);

[DllImport("chrnob_32.dll", CharSet = CharSet.Ansi, ExactSpelling = true, SetLastError = true)]
private static extern void SETROD(ref float X, ref short I, ref short j, ref short k);
```

| 参数 | 说明 |
|------|------|
| I | 控制棒列索引（0-4） |
| j | 控制棒行索引（0-4） |
| X | 控制棒位置（0=完全插入，1=完全抽出） |
| k | 操作类型（0=手动，1=自动，2=微调，3=选择，4=紧急） |

**2. 紧急插入（AZ-5）**

```csharp
private void Command1_Click(object eventSender, EventArgs eventArgs)
{
    short I = 2;
    float X = (float)(1.0 - (double)GETMOV(ref I));
    I = 0;
    short j = 0;
    short k = 4;
    SETROD(ref X, ref I, ref j, ref k);
    X = 0f;
    k = 0;
    j = 0;
    I = 1;
    SETROD(ref X, ref k, ref j, ref I);
}
```

**3. 精细调整控制棒**

```csharp
private void Spin1_SpinDown(object sender, EventArgs e)
{
    int num = int.Parse(Strings.Right(Conversions.ToString(NewLateBinding.LateGet(sender, null, "Name", new object[0], null, null, null)), Conversions.ToInteger(Operators.SubtractObject(NewLateBinding.LateGet(NewLateBinding.LateGet(sender, null, "name", new object[0], null, null, null), null, "length", new object[0], null, null, null), 6)))) - 1;
    Application.DoEvents();
    short I = (short)unchecked(num % 5);
    short j = (short)Math.Round(Conversion.Int((double)num / 5.0));
    float X = 0.01f;
    short k = 2;
    SETROD(ref X, ref I, ref j, ref k);
}

private void Spin1_SpinUp(object sender, EventArgs e)
{
    int num = int.Parse(Strings.Right(Conversions.ToString(NewLateBinding.LateGet(sender, null, "Name", new object[0], null, null, null)), Conversions.ToInteger(Operators.SubtractObject(NewLateBinding.LateGet(NewLateBinding.LateGet(sender, null, "name", new object[0], null, null, null), null, "length", new object[0], null, null, null), 6)))) - 1;
    Application.DoEvents();
    short I = (short)unchecked(num % 5);
    short j = (short)Math.Round(Conversion.Int((double)num / 5.0));
    float X = -0.01f;
    short k = 2;
    SETROD(ref X, ref I, ref j, ref k);
}
```

**4. 燃料更换模拟**

```csharp
private void Image2_DragDrop(object eventSender, DragEventArgs eventArgs)
{
    checked
    {
        if (GLOBALRX.fuel_new_flag != 0)
        {
            short I = (short)unchecked(GLOBALRX.fuel_target % 5);
            short j = (short)Math.Round(Conversion.Int((double)GLOBALRX.fuel_target / 5.0));
            short B = 5;
            SETBUN(ref B, ref I, ref j);
        }
        if (GLOBALRX.fuel_old_flag != 0)
        {
            float X = 1f;
            short B = 6;
            short num = GLOBALRX.HEPAST(ref X, ref B);
            short I = (short)unchecked(GLOBALRX.fuel_source % 5);
            short j = (short)Math.Round(Conversion.Int((double)GLOBALRX.fuel_source / 5.0));
            B = -5;
            SETBUN(ref B, ref I, ref j);
        }
    }
}
```

#### 控制棒系统参数

| 参数 | 值 | 说明 |
|------|-----|------|
| 控制棒数量 | 25组 | 5×5网格布局 |
| 位置范围 | 0-1 | 0=完全插入，1=完全抽出 |
| 微调步长 | 0.01 | 每次点击移动量 |
| 支持操作 | 拖拽 | 燃料更换模拟 |

### 9.7.3 反应堆功率调节面板（RX_CONTROL.cs）

#### 核心功能

**1. 自动/手动模式切换**

```csharp
private void Image2_MouseDown(object eventSender, MouseEventArgs eventArgs)
{
    string name = ((PictureBox)eventSender).Name;
    short num = checked((short)int.Parse(Strings.Right(name, 1)));
    short I = num;
    SETAUT(ref I);
    if (num == 0)
    {
        _Image2_0.Image = _Image1_3.Image;
        _Image2_1.Image = _Image1_0.Image;
    }
    else
    {
        _Image2_0.Image = _Image1_0.Image;
        _Image2_1.Image = _Image1_3.Image;
    }
}
```

**2. 功率设定点调整**

```csharp
private void Spin2_SpinDown(object sender, EventArgs e)
{
    int num = int.Parse(Strings.Right(Conversions.ToString(NewLateBinding.LateGet(sender, null, "name", new object[0], null, null, null)), 1));
    Application.DoEvents();
    float X = (float)(0.0 - (0.005 + (double)num * 0.045));
    short I = 1;
    PROCMDI.SETSPT(ref X, ref I);
}

private void Spin2_SpinUp(object sender, EventArgs e)
{
    int num = int.Parse(Strings.Right(Conversions.ToString(NewLateBinding.LateGet(sender, null, "name", new object[0], null, null, null)), 1));
    Application.DoEvents();
    float X = (float)(0.005 + (double)num * 0.045);
    short I = 1;
    PROCMDI.SETSPT(ref X, ref I);
}
```

**3. 停堆触发**

```csharp
private void Command1_Click(object eventSender, EventArgs eventArgs)
{
    string name = ((Button)eventSender).Name;
    short IVAL = checked((short)int.Parse(Strings.Right(name, 1)));
    short I = 2;
    PROCMDI.TRIPIT(ref IVAL, ref I);
}
```

#### 功率调节参数

| 参数 | 值 | 说明 |
|------|-----|------|
| 设定点范围 | 0-100% | 反应堆功率百分比 |
| 微调步长 | 0.005-0.05 | 根据选择器变化 |
| 自动控制 | 开/关 | 自动调节功率 |

### 7.4 反应堆再循环泵（maincp1.cs & maincp2.cs）

#### 核心功能

**1. 泵启动/停止控制**

```csharp
[DllImport("chrnob_32.dll", CharSet = CharSet.Ansi, ExactSpelling = true, SetLastError = true)]
private static extern void SETPMP(ref short I, ref short j);

private void Command1_Click(object eventSender, EventArgs eventArgs)
{
    short index = Command1.GetIndex((Button)eventSender);
    checked
    {
        short I = (short)(1 - unchecked(index % 2));
        if (index < 6)
        {
            short I2 = (short)Math.Round(Conversion.Int((double)index / 2.0));
            if (I == 1)
            {
                if (((double)_0024STATIC_0024Command1_Click_002420211C124D_0024PMPVLV[I2] > 0.99) & ((double)_0024STATIC_0024Command1_Click_002420211C124D_0024PMPVLV[I2 + 6] < 0.01))
                {
                    GLOBALRX.PLAY_TXT_AFTER_AVI = 0;
                    short j = (short)(I2 + 7);
                    Form frm = this;
                    short num = PROCMDI.check_4_malf(ref j, ref frm);
                    short index2;
                    if (unchecked(PROCMDI.CIRPMP[I2] != 1 && num == 0))
                    {
                        Command1[(short)(index + 1)].Tag = Support.Format(GLOBALRX.next_snd_index, "0");
                        index2 = 1;
                        MyProject.MyForms forms = MyProject.Forms;
                        frm = forms.model_timer;
                        SOUNDS.START_SOUND(ref index2, ref frm);
                        forms.model_timer = (model_timer)frm;
                    }
                    else
                    {
                        Command1[(short)(index + 1)].Tag = "";
                    }
                    index2 = 1;
                    SETPMP(ref I2, ref index2);
                }
            }
            else
            {
                short index2 = 0;
                SETPMP(ref I2, ref index2);
                string text = Conversions.ToString(Command1[index].Tag);
                Command1[index].Tag = "";
            }
        }
    }
}
```

**2. 阀门控制**

```csharp
[DllImport("chrnob_32.dll", CharSet = CharSet.Ansi, ExactSpelling = true, SetLastError = true)]
private static extern void SETINL(ref short I, ref short j);

[DllImport("chrnob_32.dll", CharSet = CharSet.Ansi, ExactSpelling = true, SetLastError = true)]
private static extern void SETDIS(ref short I, ref short j);
```

| 参数 | 说明 |
|------|------|
| I | 阀门索引 |
| j | 阀门状态（0=关闭，1=打开） |

**3. 流量调节**

```csharp
private void Spin1_SpinDown()
{
    Application.DoEvents();
    float X = -0.02f;
    short I = 0;
    SETTRM(ref X, ref I);
}

private void Spin1_SpinUp()
{
    Application.DoEvents();
    float X = 0.02f;
    short I = 0;
    SETTRM(ref X, ref I);
}
```

#### 再循环泵参数

| 参数 | 值 | 说明 |
|------|-----|------|
| 泵数量 | 每回路3台 | maincp1和maincp2各3台 |
| 流量调节 | ±0.02步长 | 通过Spin控制 |
| 阀门控制 | 进口/出口 | SETINL/SETDIS |

### 7.5 应急冷却泵系统（ECC_CONTROL.cs & SD_COOLING.cs）

#### ECCS控制（ECC_CONTROL.cs）

**1. ECCS泵控制**

```csharp
[DllImport("chrnob_32.dll", CharSet = CharSet.Ansi, ExactSpelling = true, SetLastError = true)]
private static extern short SETECC(ref float valu, ref short id, ref short I, ref short j);

private void Image2_Click(object eventSender, EventArgs eventArgs)
{
    short j = Image2.GetIndex((PictureBox)eventSender);
    short I = 20;
    PROCMDI.SETPMP(ref I, ref j);
    Image2[j].Image = Image1[3].Image;
    Image2[checked((short)(1 - j))].Image = Image1[0].Image;
}

private void Image3_Click(object eventSender, EventArgs eventArgs)
{
    short j = Image3.GetIndex((PictureBox)eventSender);
    short I = 21;
    PROCMDI.SETPMP(ref I, ref j);
    Image3[j].Image = Image1[3].Image;
    Image3[checked((short)(1 - j))].Image = Image1[0].Image;
}

private void Image4_Click(object eventSender, EventArgs eventArgs)
{
    short j = Image4.GetIndex((PictureBox)eventSender);
    short I = 23;
    PROCMDI.SETPMP(ref I, ref j);
    Image4[j].Image = Image1[3].Image;
    Image4[checked((short)(1 - j))].Image = Image1[0].Image;
    Image5.Image = Image1[0].Image;
}

private void Image5_Click(object eventSender, EventArgs eventArgs)
{
    short I = 23;
    short j = -1;
    PROCMDI.SETPMP(ref I, ref j);
    Image5.Image = Image1[3].Image;
    Image4[0].Image = Image1[0].Image;
    Image4[1].Image = Image1[0].Image;
}

private void Image6_Click(object eventSender, EventArgs eventArgs)
{
    short j = Image6.GetIndex((PictureBox)eventSender);
    short I = 22;
    PROCMDI.SETPMP(ref I, ref j);
    Image6[j].Image = Image1[3].Image;
    Image6[checked((short)(1 - j))].Image = Image1[0].Image;
}
```

**2. ECCS设定点调整**

```csharp
private void Spin1_SpinDown(object sender, EventArgs e)
{
    Application.DoEvents();
    float valu = -50f;
    short id = 2;
    short I = 0;
    short j = 0;
    short num = SETECC(ref valu, ref id, ref I, ref j);
}

private void Spin1_SpinUp(object sender, EventArgs e)
{
    Application.DoEvents();
    float valu = 50f;
    short id = 2;
    short I = 0;
    short j = 0;
    short num = SETECC(ref valu, ref id, ref I, ref j);
}
```

#### 堆芯离线冷却（SD_COOLING.cs）

**1. 离线冷却泵控制**

```csharp
private void Image1_MouseDown(object eventSender, MouseEventArgs eventArgs)
{
    checked
    {
        short num = (short)unchecked((int)eventArgs.Button / 1048576);
        short num2 = (short)unchecked((int)Control.ModifierKeys / 65536);
        float num3 = (float)Support.PixelsToTwipsX(eventArgs.X);
        float num4 = (float)Support.PixelsToTwipsY(eventArgs.Y);
        short j = Image1.GetIndex((PictureBox)eventSender);
        short I = 14;
        SETPMP(ref I, ref j);
        Image1[j].Image = Image7[3].Image;
        Image1[(short)(1 - j)].Image = Image7[0].Image;
    }
}
```

#### ECCS参数

| 参数 | 值 | 说明 |
|------|-----|------|
| 高压注水泵 | I=20 | 主/备用切换 |
| 低压注水泵 | I=21 | 主/备用切换 |
| 安全注水阀 | I=22 | 主/备用切换 |
| 应急冷却泵 | I=23 | 主/备用切换 |
| 设定点调整 | ±50 | 通过Spin控制 |

### 7.6 汽轮机控制系统（turbine_s_ctrl.cs）

#### 核心功能

**1. 转速控制**

```csharp
private void Command1_Click(object eventSender, EventArgs eventArgs)
{
    short index = Command1.GetIndex((Button)eventSender);
    float X = index;
    short I = 10;
    SETTRB(ref X, ref I);
}
```

**2. 负荷控制**

```csharp
private void Command2_Click(object eventSender, EventArgs eventArgs)
{
    short index = Command2.GetIndex((Button)eventSender);
    float X = checked(900 * index);
    short I = 4;
    SETTRB(ref X, ref I);
}
```

**3. 自动控制**

```csharp
private void Command3_Click(object eventSender, EventArgs eventArgs)
{
    short index = Command3.GetIndex((Button)eventSender);
    float X = index;
    short I = 1;
    SETTRB(ref X, ref I);
    if (index != 1)
    {
        return;
    }
    GLOBALRX.PLAY_TXT_AFTER_AVI = 0;
    short j = 65;
    checked
    {
        short num2;
        short num3;
        do
        {
            Form frm = this;
            short num = PROCMDI.check_4_malf(ref j, ref frm);
            if (num > 0)
            {
                break;
            }
            j = (short)unchecked(j + 1);
            num2 = j;
            num3 = 67;
        }
        while (num2 <= num3);
    }
}
```

#### 汽轮机参数

| 参数 | 索引 | 范围 | 说明 |
|------|------|------|------|
| 转速控制 | I=10 | 0-1 | 对应0-100%负荷 |
| 负荷控制 | I=4 | 0-9000步长 | 每步900kW |
| 自动控制 | I=1 | 0/1 | 启用/禁用自动调速器 |

### 9.7.7 凝汽器系统（cndsr_v.cs）

#### 核心功能

**1. 真空泵控制**

```csharp
[DllImport("chrnob_32.dll", CharSet = CharSet.Ansi, ExactSpelling = true, SetLastError = true)]
private static extern short SETCND(ref float X, ref short I);

private void Command4_Click(object eventSender, EventArgs eventArgs)
{
    short index = Command4.GetIndex((Button)eventSender);
    checked
    {
        float X = 1 - unchecked(index % 2);
        short I = 0;
        short num = SETCND(ref X, ref I);
    }
}

private void Command5_Click(object eventSender, EventArgs eventArgs)
{
    short index = Command5.GetIndex((Button)eventSender);
    float X = index % 2;
    short I = 1;
    short num = SETCND(ref X, ref I);
}
```

#### 凝汽器参数

| 参数 | 索引 | 说明 |
|------|------|------|
| 真空泵A | I=0 | 主/备用切换 |
| 真空泵B | I=1 | 主/备用切换 |

### 9.7.8 给水系统（feed_pmp.cs）

#### 核心功能

**1. 给水泵控制**

```csharp
[DllImport("chrnob_32.dll", CharSet = CharSet.Ansi, ExactSpelling = true, SetLastError = true)]
private static extern float GETFED(ref short I);

[DllImport("chrnob_32.dll", CharSet = CharSet.Ansi, ExactSpelling = true, SetLastError = true)]
private static extern float GETISO(ref short I, ref short j);

[DllImport("chrnob_32.dll", CharSet = CharSet.Ansi, ExactSpelling = true, SetLastError = true)]
private static extern void SETFED(ref float X, ref short I);

[DllImport("chrnob_32.dll", CharSet = CharSet.Ansi, ExactSpelling = true, SetLastError = true)]
private static extern void SETPMP(ref short I, ref short j);

[DllImport("chrnob_32.dll", CharSet = CharSet.Ansi, ExactSpelling = true, SetLastError = true)]
private static extern void SETISO(ref short I, ref short j, ref short k);

private void Command1_Click(object eventSender, EventArgs eventArgs)
{
    short index = Command1.GetIndex((Button)eventSender);
    checked
    {
        short I = (short)Math.Round(Conversion.Int((double)index / 2.0));
        short I2 = (short)(I + 6);
        if (unchecked(index % 2) == 1)
        {
            short j = 0;
            bool num = (double)GETISO(ref I, ref j) > 0.99;
            short j2 = 1;
            if (num & ((double)GETISO(ref I, ref j2) < 0.01))
            {
                GLOBALRX.PLAY_TXT_AFTER_AVI = 0;
                short j3 = (short)(I + 4);
                Form frm = this;
                short num2 = PROCMDI.check_4_malf(ref j3, ref frm);
                j2 = (short)(I + 3);
                if (unchecked(GETFED(ref j2) != 1f && num2 == 0))
                {
                    Command1[(short)(index - 1)].Tag = Support.Format(GLOBALRX.next_snd_index, "0");
                    j2 = 1;
                    MyProject.MyForms forms = MyProject.Forms;
                    frm = forms.model_timer;
                    SOUNDS.START_SOUND(ref j2, ref frm);
                    forms.model_timer = (model_timer)frm;
                }
                else
                {
                    Command1[(short)(index - 1)].Tag = "";
                }
                j2 = 1;
                SETPMP(ref I2, ref j2);
            }
        }
        else
        {
            short j2 = 0;
            SETPMP(ref I2, ref j2);
            string text = Conversions.ToString(Command1[index].Tag);
            Command1[index].Tag = "";
        }
    }
}
```

**2. 隔离阀控制**

```csharp
private void Command2_Click(object eventSender, EventArgs eventArgs)
{
    short index = Command2.GetIndex((Button)eventSender);
    checked
    {
        short I = (short)unchecked(index % 2);
        short j = (short)Math.Round(Conversion.Int((double)index / 2.0));
        short k = 0;
        SETISO(ref I, ref j, ref k);
    }
}

private void Command3_Click(object eventSender, EventArgs eventArgs)
{
    short index = Command3.GetIndex((Button)eventSender);
    checked
    {
        short I = (short)unchecked(index % 2);
        short j = (short)Math.Round(Conversion.Int((double)index / 2.0));
        short k = 1;
        SETISO(ref I, ref j, ref k);
    }
}
```

**3. 流量控制**

```csharp
private void Spin1_SpinDown(object sender, EventArgs e)
{
    Application.DoEvents();
    float X = -0.005f;
    short I = 2;
    SETFED(ref X, ref I);
}

private void Spin1_SpinUp(object sender, EventArgs e)
{
    Application.DoEvents();
    float X = 0.005f;
    short I = 2;
    SETFED(ref X, ref I);
}
```

#### 给水系统参数

| 参数 | 值 | 说明 |
|------|-----|------|
| 主给水泵 | 6台 | 对应泵索引6-11 |
| 隔离阀 | 每台泵2个 | 进出口 |
| 流量控制 | ±0.005步长 | 微调流量 |
| 水位控制 | Text1 | 手动输入 |

### 9.7.9 HEPA过滤器控制（HEPA_FLTR.cs）

#### 核心功能

**1. HEPA过滤器控制**

```csharp
[DllImport("chrnob_32.dll", CharSet = CharSet.Ansi, ExactSpelling = true, SetLastError = true)]
private static extern short HEPAST(ref float X, ref short I);

[DllImport("chrnob_32.dll", CharSet = CharSet.Ansi, ExactSpelling = true, SetLastError = true)]
private static extern float HEPAGT(ref short I);

private void Image2_MouseDown(object eventSender, MouseEventArgs eventArgs)
{
    checked
    {
        short num = (short)unchecked((int)eventArgs.Button / 1048576);
        short num2 = (short)unchecked((int)Control.ModifierKeys / 65536);
        float num3 = (float)Support.PixelsToTwipsX(eventArgs.X);
        float num4 = (float)Support.PixelsToTwipsY(eventArgs.Y);
        short index = Image2.GetIndex((PictureBox)eventSender);
        float X = (float)((double)(float)index * 15.0);
        short I = 1;
        short num5 = GLOBALRX.HEPAST(ref X, ref I);
        Image2[index].Image = Image1[3].Image;
        Image2[(short)(1 - index)].Image = Image1[0].Image;
    }
}

private void Image3_MouseDown(object eventSender, MouseEventArgs eventArgs)
{
    checked
    {
        short num = (short)unchecked((int)eventArgs.Button / 1048576);
        short num2 = (short)unchecked((int)Control.ModifierKeys / 65536);
        float num3 = (float)Support.PixelsToTwipsX(eventArgs.X);
        float num4 = (float)Support.PixelsToTwipsY(eventArgs.Y);
        short index = Image3.GetIndex((PictureBox)eventSender);
        float X = (float)((double)(float)index * 17.0);
        short I = 4;
        short num5 = GLOBALRX.HEPAST(ref X, ref I);
        Image3[index].Image = Image1[3].Image;
        Image3[(short)(1 - index)].Image = Image1[0].Image;
    }
}
```

#### HEPA过滤器参数

| 参数 | 值 | 说明 |
|------|-----|------|
| 过滤器A | I=1 | 主/备用切换 |
| 过滤器B | I=4 | 主/备用切换 |

### 9.7.10 数据趋势图（TRENDSv.cs）

#### 核心功能

**1. 趋势显示控制**

```csharp
[DllImport("chrnob_32.dll", CharSet = CharSet.Ansi, ExactSpelling = true, SetLastError = true)]
private static extern void SETPLT(ref short I);

[DllImport("chrnob_32.dll", CharSet = CharSet.Ansi, ExactSpelling = true, SetLastError = true)]
private static extern void GRINIT();

private void TRENDSv_Load(object eventSender, EventArgs eventArgs)
{
    GLOBALRX.trendsv_loaded = -1;
    short I = -1;
    SETPLT(ref I);
    MyProject.Forms.MainForm.trend_it.Enabled = false;
    Top = MyProject.Forms.MainForm.controlboard.Height;
    Left = 0;
}

private void TRENDSv_FormClosed(object eventSender, FormClosedEventArgs eventArgs)
{
    checked
    {
        if (DISPLAY.TNUM != 0)
        {
            short tNUM = DISPLAY.TNUM;
            short num = tNUM;
            while (true)
            {
                short num2 = num;
                short num3 = 9;
                if (num2 > num3)
                {
                    break;
                }
                DISPLAY.DO_TRENDSV1();
                num = (short)unchecked(num + 1);
            }
        }
        GLOBALRX.trendsv_loaded = 0;
        short I = 0;
        SETPLT(ref I);
        MyProject.Forms.MainForm.trend_it.Enabled = true;
    }
}

private void Picture1_DoubleClick(object eventSender, EventArgs eventArgs)
{
    if (~GLOBALRX.TREND_SELECT_LOADED != 0)
    {
        MyProject.Forms.MainForm.CBStatic.trend_select = new trend_select();
        Support.ShowForm(MyProject.Forms.MainForm.CBStatic.trend_select);
        MyProject.Forms.MainForm.CBStatic.trend_select.WindowState = FormWindowState.Normal;
        trend_select obj = MyProject.Forms.MainForm.CBStatic.trend_select;
        Size size = new Size(235, 463);
        obj.Size = size;
        trend_select obj2 = MyProject.Forms.MainForm.CBStatic.trend_select;
        Point location = new Point(300, 300);
        obj2.Location = location;
    }
}
```

#### 趋势图参数

| 参数 | 值 | 说明 |
|------|-----|------|
| 趋势笔数 | 10 | 最多10条趋势线 |
| 更新频率 | 实时 | 由模型定时器控制 |
| 选择器 | trend_select | 双击打开选择器 |

---

## 9.8 系统架构总结

### 核心设计特点

1. **模块化设计**：每个系统独立控制，通过全局变量协调
2. **实时仿真**：基于物理模型的实时计算
3. **安全第一**：多层保护系统和互锁机制
4. **人机工程**：直观的界面和清晰的报警系统
5. **故障模拟**：全面的故障模拟和培训功能

### 技术实现

- **DLL接口**：与物理模型交互
- **Windows Forms**：界面实现
- **实时参数更新**：动态显示
- **事件驱动**：控制系统
- **全局状态管理**：GLOBALRX

### 系统组件关系图

```
┌─────────────────────────────────────────────────────────────┐
│                    GLOBALRX (全局状态)                      │
└─────────────────────────────────────────────────────────────┘
                            │
        ┌───────────────────┼───────────────────┐
        │                   │                   │
┌───────▼────────┐  ┌─────▼──────┐  ┌──────▼───────┐
│  反应堆控制     │  │  给水系统   │  │  汽轮机系统   │
│  (reactr_0)    │  │ (feed_pmp) │  │(turbine_s)   │
└────────────────┘  └────────────┘  └──────────────┘
        │                   │                   │
┌───────▼────────┐  ┌─────▼──────┐  ┌──────▼───────┐
│  控制棒系统     │  │  加热器     │  │  辅助系统     │
│ (REACT_ROD)    │  │(feedHTR_0) │  │  (turb_aux)  │
└────────────────┘  └────────────┘  └──────────────┘
        │                   │                   │
        └───────────────────┼───────────────────┘
                            │
                    ┌───────▼────────┐
                    │  安全系统      │
                    │  (ALARMS)     │
                    │  (SD_COOLING) │
                    └────────────────┘
                            │
                    ┌───────▼────────┐
                    │  故障系统      │
                    │  (FO_Report)  │
                    └────────────────┘
```

### DLL函数调用关系

```
应用程序界面层
       │
       ▼
PROCMDI.cs (接口层)
       │
       ▼
chrnob_32.dll (物理模型)
       │
       ▼
反应堆物理计算
```

---

## 9.9 各面板详细参数控制和数据显示

### 9.1 反应堆控制棒面板（REACT_ROD.cs）

#### 可控制参数

| 控制项 | 控制方式 | 参数范围 | 功能说明 |
|--------|----------|----------|----------|
| 控制棒位置 | Spin1上/下 | 0-100%，步长0.01 | 单根控制棒精细调整 |
| 紧急插入AZ-5 | Command1按钮 | - | 所有控制棒快速插入 |
| 燃料更换 | Command2按钮 | - | 模拟燃料更换操作 |
| 控制棒组移动 | Spin2上/下 | 0-100%，步长0.01 | 整组控制棒调整 |

#### 显示数据

| 显示项 | 数据来源 | 显示格式 | 说明 |
|--------|----------|----------|------|
| 控制棒位置 | GETROD(I,j) | ##0.0% | 25组控制棒位置 |
| 燃料温度 | chltmp[I,j] | 温度单位 | 燃料通道温度 |
| 热功率 | THRZONE[n] | ##0.0% | 各区域热功率分布 |
| 燃料燃耗 | GETBUN(I,j) | ###0.0% | 燃料燃耗百分比 |
| 燃料束号 | GETBUN(I,j) | #0 | 燃料束编号 |
| 总功率 | GETMK() | ##0.00 | 反应堆总功率 |

#### 状态指示

- **燃料状态图标**：
  - 绿色：新燃料
  - 蓝色：正常燃料
  - 红色：高燃耗燃料
  - 灰色：无燃料

- **控制棒状态**：
  - Label7显示"X"表示控制棒选中

#### 关键代码

```csharp
// 显示控制棒位置
MyProject.Forms.MainForm.CBStatic.REACT_ROD.Label1[num5].Text = Support.Format(chlrod[I2, j], "##0.0%");

// 显示燃料温度
MyProject.Forms.MainForm.CBStatic.REACT_ROD.Label2[num5].Text = UNITSMDI.TEMPOUT(ref chltmp[I2, j]);

// 显示热功率
MyProject.Forms.MainForm.CBStatic.REACT_ROD.Label3[num5].Text = Support.Format(THRZONE[num5], "##0.0%");

// 显示燃料燃耗
MyProject.Forms.MainForm.CBStatic.REACT_ROD.Label12.Text = Support.Format(fUL, "###0.0%");

// 显示燃料束号
MyProject.Forms.MainForm.CBStatic.REACT_ROD.Label14.Text = "# " + Support.Format(GETBUN(ref I2, ref j), "#0");
```

---

### 9.2 反应堆功率调节面板（RX_CONTROL.cs）

#### 可控制参数

| 控制项 | 控制方式 | 参数范围 | 功能说明 |
|--------|----------|----------|----------|
| 功率设定点 | Spin1上/下 | 0-100%，步长0.005 | 设定反应堆功率 |
| 自动控制 | Image2按钮 | ON/OFF | 启用/禁用自动控制 |
| 停堆 | Image3按钮 | - | 触发反应堆停堆 |
| 轴向偏移控制 | Image4按钮 | ON/OFF | 控制轴向功率分布 |

#### 显示数据

| 显示项 | 数据来源 | 显示格式 | 说明 |
|--------|----------|----------|------|
| 功率变化率 | AVGRAT/maxiterates | ##0.0% | 反应堆功率变化率 |
| 热功率 | avgchp | ##0.0% | 平均热功率 |
| 中子通量 | FLX | ##0.0% | 中子通量百分比 |
| 中子通量对数 | log10(FLX) | 0.00 | 中子通量对数值 |
| 燃料燃耗 | GETBUN(-1,-1) | ##0.0% | 平均燃料燃耗 |
| 功率设定点 | GETSPT() | ##0.0% | 当前功率设定点 |
| 控制误差 | AVGERR/maxiterates | ##0.0% | 自动控制误差 |
| 自动控制状态 | GETAUT(1) | ON/OFF | 自动控制开关状态 |
| 轴向偏移状态 | GETAUT(2) | ON/OFF | 轴向偏移控制状态 |
| 停堆状态 | GETAUT(3) | ON/OFF | 停堆状态 |

#### 关键代码

```csharp
public static void disp_rx_control()
{
    // 显示功率变化率
    MyProject.Forms.MainForm.CBStatic.RX_CONTROL.Label5.Text = Support.Format(AVGRAT / (float)GLOBALRX.maxiterates, "##0.0%");
    
    // 显示热功率
    MyProject.Forms.MainForm.CBStatic.RX_CONTROL.Label7.Text = Support.Format(avgchp, "##0.0%");
    
    // 显示中子通量
    MyProject.Forms.MainForm.CBStatic.RX_CONTROL.Label9.Text = Support.Format(FLX, "##0.0%");
    
    // 显示中子通量对数
    MyProject.Forms.MainForm.CBStatic.RX_CONTROL.Label16.Text = Support.Format(Math.Log((double)FLX + 1E-10) / Math.Log(10.0), "0.00");
    
    // 显示燃料燃耗
    short I = -1;
    short j = -1;
    MyProject.Forms.MainForm.CBStatic.RX_CONTROL.Label19.Text = Support.Format(GETBUN(ref I, ref j), "##0.0%");
    
    // 显示功率设定点
    MyProject.Forms.MainForm.CBStatic.RX_CONTROL.Label4.Text = Support.Format(GETSPT(), "##0.0%");
    
    // 显示控制误差
    MyProject.Forms.MainForm.CBStatic.RX_CONTROL.Label3.Text = Support.Format(AVGERR / (float)GLOBALRX.maxiterates, "##0.0%");
}
```

---

### 9.3 再循环泵面板（maincp1.cs & maincp2.cs）

#### 可控制参数

| 控制项 | 控制方式 | 参数范围 | 功能说明 |
|--------|----------|----------|----------|
| 泵启动/停止 | Command1按钮 | ON/OFF | 每台泵独立控制 |
| 入口阀 | Command1按钮 | OPEN/CLOSE | 入口阀门控制 |
| 出口阀 | Command1按钮 | OPEN/CLOSE | 出口阀门控制 |
| 流量微调 | Spin1上/下 | ±0.02步长 | 流量精细调整 |

#### 显示数据

| 显示项 | 数据来源 | 显示格式 | 说明 |
|--------|----------|----------|------|
| 入口阀开度 | PMPVLV[0-5] | ##0.0% | 入口阀门开度 |
| 出口阀开度 | PMPVLV[6-11] | ##0.0% | 出口阀门开度 |
| 总流量 | CIRFLO[0/1] | 流量单位 | 回路总流量 |
| 泵状态 | GETPMP(I,j) | ON/OFF | 泵运行状态 |

#### 关键代码

```csharp
// 显示入口阀开度
MyProject.Forms.MainForm.CBStatic.maincp1.Label11[num].Text = Support.Format(PMPVLV[num], "##0.0%");

// 显示出口阀开度
MyProject.Forms.MainForm.CBStatic.maincp1.Label17[num].Text = Support.Format(PMPVLV[num + 6], "##0.0%");

// 显示总流量
MyProject.Forms.MainForm.CBStatic.maincp1.Label10.Text = UNITSMDI.FLOWOUT1(ref CIRFLO[0]);
```

---

### 9.4 应急冷却泵面板（ECC_CONTROL.cs）

#### 可控制参数

| 控制项 | 控制方式 | 参数范围 | 功能说明 |
|--------|----------|----------|----------|
| 高压注水泵 | Image2按钮 | START/STOP | 高压注水系统 |
| 低压注水泵 | Image3按钮 | START/STOP | 低压注水系统 |
| 安全注水阀 | Image4按钮 | OPEN/CLOSE | 安全注水控制 |
| 应急冷却泵 | Image6按钮 | START/STOP | 应急冷却系统 |
| 设定点调整 | Spin1上/下 | ±50 | 注水流量设定 |

#### 显示数据

| 显示项 | 数据来源 | 显示格式 | 说明 |
|--------|----------|----------|------|
| ECC冷却流量 | GETECC(4,0,0) | 流量单位 | 应急冷却流量 |
| 高压注水流量 | GETECC(4,0,1) | 流量单位 | 高压注水流量 |
| 低压注水流量 | GETECC(4,0,2) | 流量单位 | 低压注水流量 |
| 安全注水阀开度 | GETECC(4,0,4) | ##0.0% | 安全注水阀开度 |
| 应急冷却泵流量 | GETECC(4,0,3) | 流量单位 | 应急冷却泵流量 |
| 泵转速 | GETECC(6,0,0) | ####0. | 泵转速 |
| 泵流量 | GETECC(6,0,1) | ####0. | 泵流量 |

#### 关键代码

```csharp
// 获取ECC参数
short id = 4;
short I = 0;
short j = 0;
GETECC(ref id, ref I, ref j, ref valu[0]);

// 显示ECC冷却流量
MyProject.Forms.MainForm.CBStatic.ECC_CONTROL.Label2.Text = UNITSMDI.FLOWOUT1(ref valu[0]);

// 显示高压注水流量
MyProject.Forms.MainForm.CBStatic.ECC_CONTROL.Label1[0].Text = UNITSMDI.FLOWOUT1(ref valu[1]);

// 显示低压注水流量
MyProject.Forms.MainForm.CBStatic.ECC_CONTROL.Label1[1].Text = UNITSMDI.FLOWOUT1(ref valu[2]);

// 显示安全注水阀开度
MyProject.Forms.MainForm.CBStatic.ECC_CONTROL.Label1[2].Text = Support.Format(valu[4], "##0.0%");

// 显示应急冷却泵流量
MyProject.Forms.MainForm.CBStatic.ECC_CONTROL.Label1[5].Text = UNITSMDI.FLOWOUT1(ref valu[3]);
```

---

### 9.5 汽轮机控制面板（turbine_s_ctrl.cs）

#### 可控制参数

| 控制项 | 控制方式 | 参数范围 | 功能说明 |
|--------|----------|----------|----------|
| 汽轮机转速 | Spin1上/下 | 0-9000步长 | 转速设定（每步900kW） |
| 负荷控制 | Spin2上/下 | 0-100% | 发电机负荷 |
| 压力设定点 | Text1输入 | 压力单位 | 蒸汽压力设定 |
| 自动调速器 | Image2按钮 | ON/OFF | 自动调速控制 |
| 阀门选择 | Image3按钮 | MAIN/STARTUP | 主阀/启动阀 |
| 发电机断路器 | Image4按钮 | OPEN/CLOSE | 发电机并网 |
| 盘车装置 | Image5按钮 | ON/OFF | 汽轮机盘车 |

#### 显示数据

| 显示项 | 数据来源 | 显示格式 | 说明 |
|--------|----------|----------|------|
| 汽轮机转速 | GETTRB(4,X) | ###0.0 RPM | 汽轮机实际转速 |
| 负荷百分比 | GETTRB(1,X) | ##0.0% | 发电机负荷 |
| 蒸汽压力 | GETTRB(3,X) | 压力单位 | 蒸汽压力 |
| 蒸汽温度 | GETTRB(2,X) | ##0.0% | 蒸汽温度 |
| 鼓筒压力 | GETDRM(0,X) | 压力单位 | 蒸汽鼓筒压力 |
| 差胀 | GETTRB(16,X) | 差胀单位 | 汽轮机差胀 |
| 振动 | GETTRB(41,X) | ##0.0% | 振动水平 |
| 阀门控制信号 | GETTRB(15,X) | ##0.0 | 阀门开度信号 |
| 发电机负荷 | GETTRB(9,X) | ##0.0% | 实际发电机负荷 |

#### 仪表显示

- **转速表**：0-4000 RPM
- **负荷表**：0-200 MW
- **差胀表**：正负差胀显示

#### 关键代码

```csharp
// 显示汽轮机转速
short I = 4;
float X = default(float);
short tRB = GETTRB(ref X, ref I);
MyProject.Forms.MainForm.CBStatic.turbine_s_ctrl.Label1[5].Text = Support.Format(X, "###0.0");

// 显示负荷百分比
I = 1;
tRB = GETTRB(ref X, ref I);
MyProject.Forms.MainForm.CBStatic.turbine_s_ctrl.Label1[9].Text = Support.Format(X, "##0.0%");

// 显示蒸汽温度
I = 2;
float X3 = default(float);
tRB = GETTRB(ref X3, ref I);
MyProject.Forms.MainForm.CBStatic.turbine_s_ctrl.Label1[10].Text = Support.Format(X3, "##0.0%");

// 显示鼓筒压力
I = 0;
X = GETDRM(ref I);
MyProject.Forms.MainForm.CBStatic.turbine_s_ctrl.Label1[12].Text = UNITSMDI.PRESSOUT2(ref X);

// 显示振动
I = 41;
tRB = GETTRB(ref X2, ref I);
MyProject.Forms.MainForm.CBStatic.turbine_s_ctrl._Gauge2_0.Max = 200f;
MyProject.Forms.MainForm.CBStatic.turbine_s_ctrl._Gauge2_0.Min = 0f;
X2 = (float)(100.0 * (double)X2 + 0.5);
MyProject.Forms.MainForm.CBStatic.turbine_s_ctrl._Gauge2_0.Value = Conversion.Int(X2);
```

---

### 9.6 凝汽器系统面板（cndsr_v.cs）

#### 可控制参数

| 控制项 | 控制方式 | 参数范围 | 功能说明 |
|--------|----------|----------|----------|
| 真空泵 | Image2按钮 | ON/OFF | 主真空泵控制 |
| 备用真空泵 | Image3按钮 | ON/OFF | 备用真空泵控制 |
| 蒸汽喷射器 | Image4按钮 | ON/OFF | 蒸汽喷射器控制 |

#### 显示数据

| 显示项 | 数据来源 | 显示格式 | 说明 |
|--------|----------|----------|------|
| 凝汽器压力 | GETCND(0,X) | 压力单位 | 凝汽器真空度 |
| 凝汽器温度 | GETCND(1,X) | 温度单位 | 凝汽器温度 |
| 蒸汽喷射流量 | GETCND(29,X) | 流量单位 | 蒸汽喷射流量 |
| 真空泵状态 | GETCND(21,X) | ON/OFF | 真空泵运行状态 |
| 蒸汽喷射器状态 | GETCND(22,X) | ON/OFF | 蒸汽喷射器状态 |

#### 关键代码

```csharp
// 显示凝汽器压力
short I = 0;
float P = GETCND(ref I);
MyProject.Forms.MainForm.CBStatic.cndsr_v.Label10[0].Text = UNITSMDI.PRESSOUT3(ref P);

// 显示凝汽器温度
I = 1;
P = GETCND(ref I);
MyProject.Forms.MainForm.CBStatic.cndsr_v.Label10[1].Text = UNITSMDI.TEMPOUT(ref P);

// 显示蒸汽喷射流量
I = 29;
P = GETCND(ref I);
MyProject.Forms.MainForm.CBStatic.cndsr_v.Label10[2].Text = UNITSMDI.FLOWOUT1(ref P);

// 显示真空泵状态
I = 21;
if ((double)GETCND(ref I) > 0.5)
{
    MyProject.Forms.MainForm.CBStatic.cndsr_v.Label4[18].ForeColor = ColorTranslator.FromOle(Information.QBColor(12));
    MyProject.Forms.MainForm.CBStatic.cndsr_v.Label4[19].ForeColor = ColorTranslator.FromOle(Information.QBColor(4));
}
```

---

### 9.7 给水系统面板（feed_pmp.cs）

#### 可控制参数

| 控制项 | 控制方式 | 参数范围 | 功能说明 |
|--------|----------|----------|----------|
| 给水泵启动/停止 | Command1按钮 | ON/OFF | 每台泵独立控制 |
| 入口阀 | Command1按钮 | OPEN/CLOSE | 入口阀门控制 |
| 出口阀 | Command1按钮 | OPEN/CLOSE | 出口阀门控制 |
| 主给水阀 | Command2按钮 | OPEN/CLOSE | 主给水阀控制 |
| 启动阀 | Command3按钮 | OPEN/CLOSE | 启动阀控制 |
| 三元件控制 | Command4按钮 | OPEN/CLOSE | 三元件控制阀 |
| 水位设定点 | Text1输入 | 水位单位 | 鼓筒水位设定 |
| 自动/手动 | Image5按钮 | AUTO/MAN | 水位控制模式 |

#### 显示数据

| 显示项 | 数据来源 | 显示格式 | 说明 |
|--------|----------|----------|------|
| 给水流量 | GETFED(1) | 流量单位 | 总给水流量 |
| 蒸汽流量 | GETFED(2) | 流量单位 | 蒸汽流量 |
| 鼓筒水位 | GETFED(3) | 水位单位 | 鼓筒水位 |
| 鼓筒温度 | GETFED(4) | 温度单位 | 鼓筒温度 |
| 鼓筒压力 | GETFED(5) | 压力单位 | 鼓筒压力 |
| 水位设定点 | GETFED(13) | 水位单位 | 水位设定点 |
| 主给水阀开度 | GETFED(6) | ##0.0% | 主给水阀开度 |
| 启动阀开度 | GETFED(7) | ##0.0% | 启动阀开度 |
| 三元件阀开度 | GETFED(8) | ##0.0% | 三元件阀开度 |
| 隔离阀开度 | GETISO(I,j) | 00.0% | 各泵隔离阀开度 |
| 泵流量 | GETFED(I) | ##0.0% | 各泵流量 |

#### 关键代码

```csharp
// 显示给水流量
short I = 1;
float F = GETFED(ref I);
MyProject.Forms.MainForm.CBStatic.feed_pmp.Label10[5].Text = UNITSMDI.FLOWOUT1(ref F);

// 显示蒸汽流量
I = 2;
F = GETFED(ref I);
MyProject.Forms.MainForm.CBStatic.feed_pmp.Label10[6].Text = UNITSMDI.FLOWOUT1(ref F);

// 显示鼓筒水位
I = 3;
F = GETFED(ref I);
MyProject.Forms.MainForm.CBStatic.feed_pmp.Label10[0].Text = UNITSMDI.LEVLOUT1(ref F);

// 显示鼓筒温度
I = 4;
F = GETFED(ref I);
MyProject.Forms.MainForm.CBStatic.feed_pmp.Label10[1].Text = UNITSMDI.TEMPOUT(ref F);

// 显示鼓筒压力
I = 5;
F = GETFED(ref I);
MyProject.Forms.MainForm.CBStatic.feed_pmp.Label10[2].Text = UNITSMDI.PRESSOUT2(ref F);

// 显示隔离阀开度
short I2 = 0;
short j = 0;
MyProject.Forms.MainForm.CBStatic.feed_pmp.Label3[num].Text = Support.Format(GETISO(ref I2, ref j), "00.0%");
```

---

### 9.8 数据趋势图面板（TRENDSv.cs）

#### 可控制参数

| 控制项 | 控制方式 | 参数范围 | 功能说明 |
|--------|----------|----------|----------|
| 趋势选择 | 双击打开选择器 | 最多10条 | 选择要显示的趋势 |
| 趋势偏移 | Spin1上/下 | ±1 | 调整趋势线垂直偏移 |
| 趋势显示 | Picture1双击 | ON/OFF | 显示/隐藏趋势图 |

#### 显示数据

| 显示项 | 数据来源 | 显示格式 | 说明 |
|--------|----------|----------|------|
| 趋势线1-10 | GETYS(GR,XD,XM,LY1,LY2) | 实时曲线 | 最多10条趋势线 |
| 趋势名称 | GTPNAM(n,lp) | 文本 | 趋势参数名称 |
| 趋势单位 | GTPUNI(n,lp) | 文本 | 趋势参数单位 |
| 趋势颜色 | GETPCL(GR) | RGB | 趋势线颜色 |
| 趋势参数 | GETPPX(I) | 参数ID | 趋势参数编号 |

#### 可选趋势参数（最多30个）

通过`trend_select`面板选择，包括但不限于：
- 反应堆功率
- 中子通量
- 控制棒位置
- 燃料温度
- 给水流量
- 蒸汽流量
- 汽轮机转速
- 凝汽器压力
- 等等...

#### 关键代码

```csharp
// 获取趋势数据
short GR = (short)(TNUM + 1);
XDOT_value = GETYS(ref GR, ref XD, ref XM, ref _0024STATIC_0024DO_TRENDSV_0024001_0024X1[0], ref _0024STATIC_0024DO_TRENDSV_0024001_0024X2[0]);

// 获取趋势笔颜色
GETPEN(ref _0024STATIC_0024DO_TRENDSV_0024001_0024xPEN[0]);

// 获取趋势参数编号
short n = GETPPX(ref GR);

// 获取趋势名称
FixedLengthString fixedLengthString = new FixedLengthString(25);
string lp = fixedLengthString.Value;
GTPNAM(ref n, ref lp);

// 获取趋势单位
FixedLengthString fixedLengthString2 = new FixedLengthString(20);
lp = fixedLengthString2.Value;
GTPUNI(ref n, ref lp);
```

#### 趋势图特性

- **实时更新**：由模型定时器控制
- **历史数据**：显示最近100个数据点
- **多参数对比**：最多10条趋势线同时显示
- **颜色区分**：每条趋势线独立颜色
- **垂直偏移**：可调整趋势线垂直位置以便对比

---

### 9.9 HEPA过滤器控制面板（HEPA_FLTR.cs）

#### 可控制参数

| 控制项 | 控制方式 | 参数范围 | 功能说明 |
|--------|----------|----------|----------|
| 通风阀 | Image2按钮 | OPEN/CLOSE | 主通风阀控制 |
| 旁路阀 | Image3按钮 | OPEN/CLOSE | 旁路阀控制 |

#### 显示数据

| 显示项 | 数据来源 | 显示格式 | 说明 |
|--------|----------|----------|------|
| 通风流量 | GETHEP(1,X) | 流量单位 | 通风流量 |
| 旁路流量 | GETHEP(2,X) | 流量单位 | 旁路流量 |
| 入口辐射 | GETHEP(0,X) | 辐射单位 | 入口辐射水平 |
| 出口辐射 | GETHEP(3,X) | 辐射单位 | 出口辐射水平 |

#### 关键代码

```csharp
// 显示通风流量
short I = 1;
float X = default(float);
short tRB = GETHEP(ref X, ref I);
MyProject.Forms.MainForm.CBStatic.HEPA_FLTR.Label4[1].Text = UNITSMDI.FLOWOUT1(ref X);

// 显示旁路流量
I = 2;
tRB = GETHEP(ref X, ref I);
MyProject.Forms.MainForm.CBStatic.HEPA_FLTR.Label4[2].Text = UNITSMDI.FLOWOUT1(ref X);
```

---

### 9.10 除氧器控制面板（deaer_P_CTRL.cs & deaer_L_CTRL.cs）

#### 可控制参数

| 控制项 | 控制方式 | 参数范围 | 功能说明 |
|--------|----------|----------|----------|
| 蒸汽压力控制 | Image1按钮 | AUTO/MAN | 压力控制模式 |
| 水位控制 | Image2按钮 | AUTO/MAN | 水位控制模式 |
| 再生流量阀 | Image3按钮 | OPEN/CLOSE | 再生流量控制 |
| 补水流量阀 | Image4按钮 | OPEN/CLOSE | 补水流量控制 |

#### 显示数据

| 显示项 | 数据来源 | 显示格式 | 说明 |
|--------|----------|----------|------|
| 除氧器温度 | GETDAR(4,X) | 温度单位 | 除氧器温度 |
| 除氧器压力 | GETDAR(5,X) | 压力单位 | 除氧器压力 |
| 除氧器水位 | GETDAR(3,X) | 水位单位 | 除氧器水位 |
| 给水流量 | GETFED(1) | 流量单位 | 给水流量 |
| 蒸汽流量 | GETDAR(8,X) | 流量单位 | 蒸汽流量 |
| 补水流量 | GETDAR(18,X) | 流量单位 | 补水流量 |
| 再生流量 | GETDAR(1,X) | 流量单位 | 再生流量 |
| 补水流量 | GETDAR(7,X) | 流量单位 | 补水流量 |
| 水位设定点 | GETDAR(9,X) | 水位单位 | 水位设定点 |

#### 关键代码

```csharp
// 显示除氧器温度
short I = 4;
float X = default(float);
short dAR = GETDAR(ref X, ref I);
MyProject.Forms.MainForm.CBStatic.DEAER_0.Label1[4].Text = UNITSMDI.TEMPOUT(ref X);

// 显示除氧器压力
I = 5;
dAR = GETDAR(ref X, ref I);
MyProject.Forms.MainForm.CBStatic.DEAER_0.Label1[2].Text = UNITSMDI.PRESSOUT2(ref X);

// 显示除氧器水位
I = 3;
dAR = GETDAR(ref X, ref I);
MyProject.Forms.MainForm.CBStatic.DEAER_0.Label1[3].Text = UNITSMDI.LEVLOUT1(ref X);
```

---

### 9.11 其他辅助面板

#### 排水控制面板（Drain_ctrl.cs）

| 显示项 | 数据来源 | 显示格式 | 说明 |
|--------|----------|----------|------|
| 排水流量 | GETFED(6) | 流量单位 | 排水流量 |
| 排水阀开度 | GETFED(14) | ##0.0% | 排水阀开度 |
| 水位设定点 | GETFED(13) | 水位单位 | 水位设定点 |

#### 凝汽器热井液位控制（HOTW_LEVEL_CTRL.cs）

| 显示项 | 数据来源 | 显示格式 | 说明 |
|--------|----------|----------|------|
| 热井水位 | GETCND(2,X) | 水位单位 | 热井水位 |
| 热井温度 | GETCND(3,X) | 温度单位 | 热井温度 |
| 热井压力 | GETCND(4,X) | 压力单位 | 热井压力 |

#### 补水系统（COND_MAKEUP.cs）

| 显示项 | 数据来源 | 显示格式 | 说明 |
|--------|----------|----------|------|
| 补水流量 | GETDAR(24,X) | ##0.0% | 补水流量 |
| 补水阀开度 | GETDAR(25,X) | ##0.0% | 补水阀开度 |
| 凝结水流量 | GETDAR(28,X) | 流量单位 | 凝结水流量 |

#### 汽轮机辅助系统（turb_aux.cs）

| 显示项 | 数据来源 | 显示格式 | 说明 |
|--------|----------|----------|------|
| 润滑油压力 | GETTRB(37,X) | 压力单位 | 润滑油压力 |
| 冷却水压力 | GETTRB(38,X) | 压力单位 | 冷却水压力 |
| 密封水压力 | GETTRB(39,X) | 压力单位 | 密封水压力 |
| 盘车状态 | GETTRB(33,X) | ON/OFF | 盘车装置状态 |
| 顶轴油泵 | GETTRB(34,X) | ON/OFF | 顶轴油泵状态 |
| 排汽阀 | GETTRB(35,X) | ON/OFF | 排汽阀状态 |
| 疏水阀 | GETTRB(36,X) | ON/OFF | 疏水阀状态 |

---

## 9.10 数据获取函数总结

### DLL函数接口

| 函数名 | 功能说明 | 返回值 |
|--------|----------|--------|
| `GETMK()` | 获取反应堆功率 | float |
| `GETFLX()` | 获取中子通量 | float |
| `GETXE(ref short I)` | 获取氙/碘浓度 | float |
| `GETTHR(ref float lPARAM)` | 获取热功率分布 | void |
| `GETROD(ref short I, ref short j)` | 获取控制棒位置 | float |
| `GETERR()` | 获取控制误差 | float |
| `GETSPT()` | 获取功率设定点 | float |
| `GETAUT(ref short I)` | 获取自动控制状态 | short |
| `GETFED(ref short I)` | 获取给水系统参数 | float |
| `GETISO(ref short I, ref short j)` | 获取隔离阀开度 | float |
| `GETCND(ref short I)` | 获取凝汽器参数 | float |
| `GETTRB(ref float X, ref short I)` | 获取汽轮机参数 | short |
| `GETECC(ref short id, ref short I, ref short j, ref float lPARAM)` | 获取ECC参数 | void |
| `GETDAR(ref float X, ref short I)` | 获取除氧器参数 | short |
| `GETDRM(ref short I)` | 获取鼓筒参数 | float |
| `GETPCL(ref short GR)` | 获取趋势颜色 | short |
| `GETPPX(ref short I)` | 获取趋势参数 | short |
| `GETYS(ref short GR, ref short XD, ref short XM, ref short LY1, ref short LY2)` | 获取趋势数据 | short |
| `GTPNAM(ref short n, ref string lp)` | 获取趋势名称 | void |
| `GTPUNI(ref short n, ref string lp)` | 获取趋势单位 | void |

### 单位转换函数

| 函数名 | 功能说明 | 输入/输出 |
|--------|----------|----------|
| `UNITSMDI.FLOWOUT1(ref float F)` | 流量输出格式化 | float → string |
| `UNITSMDI.FLOWOUT2(ref float F)` | 流量输出格式化2 | float → string |
| `UNITSMDI.FLOWOUT3(ref float F)` | 流量输出格式化3 | float → string |
| `UNITSMDI.PRESSOUT2(ref float P)` | 压力输出格式化 | float → string |
| `UNITSMDI.PRESSOUT3(ref float P)` | 压力输出格式化3 | float → string |
| `UNITSMDI.TEMPOUT(ref float T)` | 温度输出格式化 | float → string |
| `UNITSMDI.LEVLOUT1(ref float L)` | 水位输出格式化 | float → string |
| `UNITSMDI.LENTOUT1(ref float L)` | 长度输出格式化 | float → string |
| `UNITSMDI.LENTOUT2(ref float L)` | 长度输出格式化2 | float → string |

---

## 9.11 总结

本报告详细分析了CHRNOBYL RBMK-1000模拟器的22个主要面板，包括：

1. **反应堆控制系统**：控制棒、功率调节、再循环泵
2. **安全系统**：应急冷却泵、堆芯离线冷却
3. **汽轮机系统**：汽轮机控制、辅助系统
4. **给水系统**：给水泵、除氧器、凝结水
5. **凝汽器系统**：真空系统、热井控制
6. **辅助系统**：HEPA过滤器、补水系统
7. **监控系统**：数据趋势图、报警系统

每个面板都提供了详细的参数控制和数据显示，通过DLL接口与物理模型实时交互，实现了完整的核电站操作模拟。

该模拟器准确地反映了RBMK-1000反应堆的复杂操作特性，为操作员培训和系统分析提供了逼真的环境。

---

## 十、切尔诺贝利遗产延续手册详细内容

### 10.1 历史背景与事故分析

堆芯示意图使用 `Picture2` 作为主容器（Panel），在其中放置了25个 `Image2` 控件（PictureBox数组），对应5×5的控制棒网格布局。

```csharp
// Picture2 是主容器
private Panel _Picture2;

// Image2 是包含25个PictureBox的数组，对应5×5网格
private PictureBoxArray _Image2;

// Image4 包含5种不同的燃料状态图标
private PictureBoxArray _Image4;

// Image6 包含2个控制棒移动模式图标
private PictureBoxArray _Image6;
```

#### 燃料状态图标

`Image4` 数组包含5种不同的燃料状态图标，用于显示每个燃料通道的状态：

| 图标索引 | 燃料状态 | 颜色 | 燃耗条件 |
|----------|----------|------|----------|
| Image4[0] | 新燃料 | 绿色 | bUN > 9.0% |
| Image4[1] | 无燃料 | 灰色 | bUN == 0.0% |
| Image4[2] | 正常燃料 | 蓝色 | 2.0% < bUN ≤ 7.0% |
| Image4[3] | 高燃耗燃料 | 红色 | 7.0% ≤ bUN ≤ 9.0% |
| Image4[4] | 燃料更换中 | 特殊图标 | FULRUP[num5] ≥ 0.1 |

#### 燃料状态判断逻辑

通过 `GETBUN(I,j)` 获取燃料燃耗百分比，根据燃耗值选择对应的图标：

```csharp
float bUN = GETBUN(ref I2, ref j);

if ((double)FULRUP[num5] < 0.1)  // 不在燃料更换中
{
    if ((double)bUN > 9.0)  // 新燃料
    {
        MyProject.Forms.MainForm.CBStatic.REACT_ROD.Image2[num5].Image = 
            MyProject.Forms.MainForm.CBStatic.REACT_ROD.Image4[0].Image;
    }
    else if ((double)bUN >= 7.0)  // 高燃耗燃料
    {
        MyProject.Forms.MainForm.CBStatic.REACT_ROD.Image2[num5].Image = 
            MyProject.Forms.MainForm.CBStatic.REACT_ROD.Image4[3].Image;
    }
    else if ((double)bUN > 2.0)  // 正常燃料
    {
        MyProject.Forms.MainForm.CBStatic.REACT_ROD.Image2[num5].Image = 
            MyProject.Forms.MainForm.CBStatic.REACT_ROD.Image4[2].Image;
    }
    else if ((double)bUN == 0.0)  // 无燃料
    {
        MyProject.Forms.MainForm.CBStatic.REACT_ROD.Image2[num5].Image = 
            MyProject.Forms.MainForm.CBStatic.REACT_ROD.Image4[1].Image;
    }
}
else  // 燃料更换中
{
    MyProject.Forms.MainForm.CBStatic.REACT_ROD.Image2[num5].Image = 
        MyProject.Forms.MainForm.CBStatic.REACT_ROD.Image4[4].Image;
}
```

#### 控制棒选中指示

`Label7` 数组（3个元素）用于显示控制棒选中状态，当选中控制棒时显示"X"：

```csharp
for (num5 = 0; num5 <= 2; num5++)
{
    float num8 = num5;
    I = 1;
    if (num8 == Conversion.Int(GETMOV(ref I)) - 1f)
    {
        MyProject.Forms.MainForm.CBStatic.REACT_ROD.Label7[num5].Text = "X";
    }
    else
    {
        MyProject.Forms.MainForm.CBStatic.REACT_ROD.Label7[num5].Text = "";
    }
}
```

#### 控制棒移动模式指示

`Image6` 数组包含2个图标，用于显示控制棒移动模式：

```csharp
I = 2;
if ((double)GETMOV(ref I) != 0.0)
{
    // 模式1：显示Image6[0]，隐藏Image6[1]
    MyProject.Forms.MainForm.CBStatic.REACT_ROD.Image6[0].Visible = true;
    MyProject.Forms.MainForm.CBStatic.REACT_ROD.Image6[1].Visible = false;
}
else
{
    // 模式2：显示Image6[1]，隐藏Image6[0]
    MyProject.Forms.MainForm.CBStatic.REACT_ROD.Image6[1].Visible = true;
    MyProject.Forms.MainForm.CBStatic.REACT_ROD.Image6[0].Visible = false;
}
```

#### 背景颜色高亮

根据燃料状态和位置，对标签进行背景颜色高亮：

```csharp
// 燃料监控或目标燃料高亮
if ((((short)(0 - ((GLOBALRX.fuel_target == num5) ? 1 : 0)) & GLOBALRX.fuel_new_flag) | 
    (GLOBALRX.fuel_monitor_flag & (short)(0 - ((GLOBALRX.fuel_monitor == num5) ? 1 : 0)))) != 0)
{
    MyProject.Forms.MainForm.CBStatic.REACT_ROD.Label1[num5].BackColor = 
        ColorTranslator.FromOle(Information.QBColor(9));  // 浅蓝色高亮
    MyProject.Forms.MainForm.CBStatic.REACT_ROD.Label2[num5].BackColor = 
        ColorTranslator.FromOle(Information.QBColor(9));
    MyProject.Forms.MainForm.CBStatic.REACT_ROD.Label3[num5].BackColor = 
        ColorTranslator.FromOle(Information.QBColor(9));
}
```

#### 显示数据更新

每个燃料通道显示三个数据标签：

- **Label1**：控制棒位置百分比（chlrod[I,j]）
- **Label2**：燃料温度（chltmp[I,j]）
- **Label3**：热功率分布（THRZONE[num5]）

```csharp
MyProject.Forms.MainForm.CBStatic.REACT_ROD.Label1[num5].Text = 
    Support.Format(chlrod[I2, j], "##0.0%");
MyProject.Forms.MainForm.CBStatic.REACT_ROD.Label2[num5].Text = 
    UNITSMDI.TEMPOUT(ref chltmp[I2, j]);
MyProject.Forms.MainForm.CBStatic.REACT_ROD.Label3[num5].Text = 
    Support.Format(THRZONE[num5], "##0.0%");
```

---

### 10.2 CRT示意图显示机制

#### 界面结构

CRT示意图使用多个PictureBox数组来显示系统流程图和设备状态：

```csharp
// Picture1：包含21个PictureBox，显示流程图中的设备状态
private PictureBoxArray _Picture1;

// Image1-Image8：包含不同状态的图标（每个2个：开/关或运行/停止）
private PictureBoxArray _Image1;  // 再循环泵状态
private PictureBoxArray _Image2;  // 给水泵状态
private PictureBoxArray _Image3;  // 凝汽器状态
private PictureBoxArray _Image4;  // 除氧器阀状态
private PictureBoxArray _Image5;  // 除氧器阀状态
private PictureBoxArray _Image6;  // 堆芯离线冷却泵状态
private PictureBoxArray _Image7;  // 堆芯离线冷却泵状态
private PictureBoxArray _Image8;  // ECC状态

// Label1：包含33个标签，显示各种参数
private PictureBoxArray _Label1;
```

#### 设备状态图标映射

| Picture索引 | 设备名称 | 状态判断函数 | 图标数组 | 状态条件 |
|------------|----------|--------------|----------|----------|
| 0-2 | 再循环泵A | CIRPMP[num] | Image1 | >0.5运行，否则停止 |
| 3-5 | 给水泵 | GETFED(I) | Image2 | >0.5运行，否则停止 |
| 6-8 | 凝汽器 | GETCND(I) | Image3 | >0.5运行，否则停止 |
| 9-11 | 凝汽器 | GETCND(I) | Image1 | >0.5运行，否则停止 |
| 12 | ECC安全注水 | GETECC() | Image8 | valu[7]>0.5激活 |
| 13 | ECC高压注水 | GETECC() | Image4 | valu[5]>0.5激活 |
| 14 | ECC低压注水 | GETECC() | Image5 | valu[6]>0.5激活 |
| 15 | 除氧器再生阀 | GETDAR(22) | Image4 | >0.5打开 |
| 16 | 除氧器补水阀 | GETDAR(23) | Image5 | >0.5打开 |
| 19 | 堆芯离线冷却泵1 | GETSDC(1) | Image6 | PMPVLV[0]>0.5运行 |
| 20 | 堆芯离线冷却泵2 | GETSDC(2) | Image7 | PMPVLV[0]>0.5运行 |

#### 图标切换逻辑

每个设备位置根据系统状态在两种图标之间切换：

```csharp
// 再循环泵状态（Picture1[0-2]）
for (num = 0; num <= 2; num++)
{
    if ((double)CIRPMP[num] > 0.5)
    {
        // 运行状态：显示Image1[1]
        MyProject.Forms.MainForm.CBStatic.SCEMAT_0.Picture1[num].Image = 
            MyProject.Forms.MainForm.CBStatic.SCEMAT_0.Image1[1].Image;
    }
    else
    {
        // 停止状态：显示Image1[0]
        MyProject.Forms.MainForm.CBStatic.SCEMAT_0.Picture1[num].Image = 
            MyProject.Forms.MainForm.CBStatic.SCEMAT_0.Image1[0].Image;
    }
}
```

#### 参数数据显示

Label1数组显示33个不同的参数：

| Label索引 | 参数名称 | 数据来源 | 显示格式 |
|-----------|----------|----------|----------|
| 0 | 鼓筒水位1 | GETDRM(2) | 水位单位 |
| 1 | 鼓筒水位2 | GETDRM(2) | 水位单位 |
| 2 | 除氧器水位 | GETDAR(23) | 水位单位 |
| 3 | 凝汽器水位 | GETCND(34) | 水位单位 |
| 4 | 堆芯温度1 | SDTEMP[0] | 温度单位 |
| 5 | 堆芯温度2 | SDTEMP[1] | 温度单位 |
| 6 | 堆芯温度3 | SDTEMP[0] | 温度单位 |
| 7 | 堆芯温度4 | SDTEMP[1] | 温度单位 |
| 8 | 鼓筒压力 | GETDRM(0) | 压力单位 |
| 9 | 鼓筒温度 | GETDRM(1) | 温度单位 |
| 10 | 蒸汽流量 | GETDRM(3) | 流量单位 |
| 11 | 给水流量 | GETDRM(4) | 流量单位 |
| 12 | 蒸汽流量 | GETDRM(4) | 流量单位 |
| 13 | 汽轮机转速 | GETTRB(9) | ###0 RPM |
| 14 | 汽轮机功率 | GETTRB(15) | ###0 MW |
| 15 | ECC流量 | GETECC(4,0,0) | 流量单位 |
| 16 | ECC总流量 | valu[1]+valu[2] | 流量单位 |
| 17 | 除氧器参数1 | GETDAR(24) | ##0.0% |
| 18 | 除氧器参数2 | GETDAR(25) | ##0.0% |
| 19 | 除氧器流量1 | GETDAR(20) | 流量单位 |
| 20 | 除氧器流量2 | GETDAR(21) | 流量单位 |
| 21 | HEPA过滤效率 | HEPAGT(3) | ##0.00% |
| 22 | 给水流量 | GETFED(1) | 流量单位 |
| 23 | 除氧器流量 | GETDAR(17) | 流量单位 |
| 24 | 凝汽器流量 | GETCND(29) | 流量单位 |
| 25 | 蒸汽流量 | GETTRB(10) | 流量单位 |
| 26 | 除氧器流量 | GETDAR(8) | 流量单位 |
| 27 | 给水流量 | GETFED(6) | 流量单位 |
| 28 | 离子交换器1 | IXCLGT(6) | ##0.00% |
| 29 | 离子交换器2 | IXCLGT(15) | ##0.00% |
| 30 | 再生流量1 | IXCLGT(3) | REGEN或流量 |
| 31 | 再生流量2 | IXCLGT(4) | REGEN或流量 |
| 32 | 凝汽器真空 | GETCND(23) | 压力单位 |

#### 特殊显示逻辑

某些标签根据系统状态显示不同的文本：

```csharp
// 再生流量显示
if ((double)num8 < 0.0)  // 再生模式
{
    MyProject.Forms.MainForm.CBStatic.SCEMAT_0.Label1[30].Text = "REGEN";
}
else if ((double)F2 < 0.0)  // 无流量
{
    F = 0f;
    MyProject.Forms.MainForm.CBStatic.SCEMAT_0.Label1[30].Text = UNITSMDI.FLOWOUT1(ref F);
}
else  // 正常流量
{
    MyProject.Forms.MainForm.CBStatic.SCEMAT_0.Label1[30].Text = UNITSMDI.FLOWOUT1(ref F2);
}
```

#### 实时更新机制

CRT示意图通过 `disp_scemat_0()` 函数实时更新：

```csharp
public static void disp_scemat_0()
{
    // 更新设备状态图标
    // 更新参数数据显示
    // 根据系统状态切换图标
}
```

---

### 12.3 所有面板控制元素详细总结

#### 12.3.1 反应堆功率调节面板（RX_CONTROL.cs）

##### 控制元素

**Spin2_0/Spin2_1**：功率设定点调整滑条
- SpinUp：增加功率设定点（+0.005到+0.095）
- SpinDown：减少功率设定点（-0.005到-0.095）
- 调用函数：`PROCMDI.SETSPT(ref X, ref I)`

**Image2_0/Image2_1**：自动控制模式切换
- 点击切换自动/手动模式
- 调用函数：`SETAUT(ref I)`

**Image3_0/Image3_1**：停堆按钮
- 点击执行停堆操作
- 调用函数：`STTCOR(ref I)`

**Image4_0/Image4_1**：紧急停堆按钮
- 点击执行紧急停堆
- 调用函数：`PROCMDI.TRIPIT(ref IVAL, ref I)`

**Command1_0/Command1_1**：停堆按钮
- 点击执行停堆操作
- 调用函数：`PROCMDI.TRIPIT(ref IVAL, ref I)`

##### 显示元素

- **Label数组**：显示功率、中子通量、燃耗、误差等参数
- **Image1/Image3/Image4**：显示设备状态图标（运行/停止、打开/关闭）

---

#### 12.3.2 反应堆再循环泵面板（maincp1.cs & maincp2.cs）

##### 控制元素

**Spin1**：流量微调滑条
- SpinUp：增加流量（+0.02）
- SpinDown：减少流量（-0.02）
- 调用函数：`SETTRM(ref X, ref I)`

**Command1[0-5]**：泵启动/停止按钮
- 控制泵的启动和停止
- 调用函数：`SETPMP(ref I2, ref index2)`

**Command1[6-11]**：入口阀控制按钮
- 控制入口阀的打开/关闭
- 调用函数：`SETINL(ref I, ref I2)`

**Command1[12-17]**：排放阀控制按钮
- 控制排放阀的打开/关闭
- 调用函数：`SETDIS(ref I, ref I2)`

##### 显示元素

- **Label数组**：显示泵状态、阀门位置、流量等参数
- **Image数组**：显示泵运行状态图标

---

#### 12.3.3 应急冷却泵面板（ECC_CONTROL.cs & SD_COOLING.cs）

##### 控制元素

**Spin1**：流量设定点调整滑条
- SpinUp：增加流量设定
- SpinDown：减少流量设定
- 调用函数：`SETECC(ref X, ref I)`

**Image2**：高压注水泵控制
- 点击控制高压注水泵
- 调用函数：`SETECC(ref I, ref I2, ref I3, ref X)`

**Image3**：低压注水泵控制
- 点击控制低压注水泵
- 调用函数：`SETECC(ref I, ref I2, ref I3, ref X)`

**Image4**：安全注水阀控制
- 点击控制安全注水阀
- 调用函数：`SETECC(ref I, ref I2, ref I3, ref X)`

**Image5**：应急冷却泵控制
- 点击控制应急冷却泵
- 调用函数：`GETSDC(ref j, ref PMPVLV[0])`

**Image6**：堆芯离线冷却泵1控制
- 点击控制堆芯离线冷却泵1
- 调用函数：`GETSDC(ref j, ref PMPVLV[0])`

##### 显示元素

- **Label数组**：显示泵状态、阀门位置、流量、温度等参数
- **Image数组**：显示泵运行状态、阀门状态图标

---

#### 12.3.4 汽轮机控制面板（turbine_s_ctrl.cs）

##### 控制元素

**Spin1**：转速/负荷控制滑条
- SpinUp：增加转速/负荷
- SpinDown：减少转速/负荷
- 调用函数：`SETTRB(ref X, ref I)`

**Command1**：汽轮机启动/停止按钮
- 控制汽轮机的启动和停止
- 调用函数：`SETTRB(ref X, ref I)`

**Command2**：负荷控制按钮
- 调整汽轮机负荷
- 调用函数：`SETTRB(ref X, ref I)`

**Command3**：压力设定按钮
- 设定蒸汽压力
- 调用函数：`SETTRB(ref X, ref I)`

**Command4**：自动调速器按钮
- 启用/禁用自动调速器
- 调用函数：`SETTRB(ref X, ref I)`

**Command5**：排汽阀控制按钮
- 控制排汽阀的打开/关闭
- 调用函数：`SETTRB(ref X, ref I)`

**Command6**：疏水阀控制按钮
- 控制疏水阀的打开/关闭
- 调用函数：`SETTRB(ref X, ref I)`

**Command7**：辅助系统控制按钮
- 控制润滑油、冷却水、密封水系统
- 调用函数：`SETTRB(ref X, ref I)`

**Command8**：紧急停机按钮
- 执行紧急停机
- 调用函数：`SETTRB(ref X, ref I)`

##### 显示元素

- **Label数组**：显示转速、负荷、压力、温度等参数
- **Image数组**：显示汽轮机状态、阀门状态图标

---

#### 12.3.5 凝汽器系统面板（cndsr_v.cs）

##### 控制元素

**Command4[0-1]**：真空泵控制按钮
- 控制主真空泵和备用真空泵
- 调用函数：`SETCND(ref I, ref X)`

**Command5[0-1]**：蒸汽喷射器控制按钮
- 控制蒸汽喷射器的启动/停止
- 调用函数：`SETCND(ref I, ref X)`

##### 显示元素

- **Label数组**：显示真空度、温度、水位等参数
- **Image数组**：显示泵运行状态图标

---

#### 12.3.6 给水系统面板（feed_pmp.cs）

##### 控制元素

**Spin1**：给水流量设定滑条
- SpinUp：增加给水流量
- SpinDown：减少给水流量
- 调用函数：`SETFED(ref X, ref I)`

**Command1[0-5]**：主给水泵启动/停止按钮
- 控制6台主给水泵的启动和停止
- 调用函数：`SETFED(ref X, ref I)`

**Command2[0-5]**：给水泵隔离阀控制按钮
- 控制每台泵的2个隔离阀
- 调用函数：`SETISO(ref I, ref j)`

**Command3[0-5]**：主给水阀控制按钮
- 控制主给水阀的打开/关闭
- 调用函数：`SETFED(ref X, ref I)`

**Command4[0-1]**：启动阀控制按钮
- 控制启动阀的打开/关闭
- 调用函数：`SETFED(ref X, ref I)`

**Command5[0-1]**：三元件控制按钮
- 启用/禁用三元件控制
- 调用函数：`SETFED(ref X, ref I)`

**Command6**：紧急停泵按钮
- 执行紧急停泵操作
- 调用函数：`SETFED(ref X, ref I)`

##### 显示元素

- **Label数组**：显示泵状态、阀门位置、流量等参数
- **Image数组**：显示泵运行状态、阀门状态图标

---

#### 12.3.7 除氧器面板（deaer_P_CTRL.cs & deaer_L_CTRL.cs）

##### 控制元素

**Spin1**：蒸汽压力控制滑条
- SpinUp：增加蒸汽压力设定
- SpinDown：减少蒸汽压力设定
- 调用函数：`SETDAR(ref X, ref I)`

**Spin2**：水位控制滑条
- SpinUp：增加水位设定
- SpinDown：减少水位设定
- 调用函数：`SETDAR(ref X, ref I)`

**Spin3**：再生/补水流量控制滑条
- SpinUp：增加流量
- SpinDown：减少流量
- 调用函数：`SETDAR(ref X, ref I)`

**Command1[0-1]**：再生/补水阀控制按钮
- 控制再生阀和补水阀的打开/关闭
- 调用函数：`SETDAR(ref X, ref I)`

##### 显示元素

- **Label数组**：显示压力、水位、流量等参数
- **Image数组**：显示阀门状态图标

---

#### 12.3.8 数据趋势图面板（TRENDSv.cs）

##### 控制元素

**Picture1**：趋势图显示区域
- 双击打开趋势选择器
- 最多显示10条趋势线
- 调用函数：`trend_select.ShowDialog()`

**Command2**：趋势图控制按钮
- 控制趋势图的显示/隐藏
- 调用函数：`GETYS(GR,XD,XM,LY1,LY2)`

##### 显示元素

- **Picture1**：显示趋势曲线
- **Label数组**：显示趋势名称、单位、数值

---

#### 12.3.9 HEPA过滤器面板（HEPA_FLTR.cs）

##### 控制元素

**Image2[0-1]**：通风阀控制按钮
- 点击控制通风阀的打开/关闭
- 调用函数：`SETHPA(ref I, ref X)`

**Image3[0-1]**：旁路阀控制按钮
- 点击控制旁路阀的打开/关闭
- 调用函数：`SETHPA(ref I, ref X)`

##### 显示元素

- **Label数组**：显示入口/出口辐射监测值、过滤效率等参数
- **Image数组**：显示阀门状态图标

---

#### 12.3.10 反应堆控制棒面板（REACT_ROD.cs）

##### 控制元素

**Spin1**：控制棒位置调整滑条
- SpinUp：提升控制棒（+0.01）
- SpinDown：插入控制棒（-0.01）
- 调用函数：`SETROD(ref X, ref I, ref j, ref k)`

**Spin2**：控制棒组调整滑条
- SpinUp：提升整组控制棒（+0.01）
- SpinDown：插入整组控制棒（-0.01）
- 调用函数：`SETROD(ref X, ref I, ref j, ref k)`

**Command1**：紧急插入AZ-5按钮
- 点击执行所有控制棒快速插入
- 调用函数：`SETROD(ref X, ref I, ref j, ref k)`

**Command2**：燃料更换按钮
- 点击模拟燃料更换操作
- 调用函数：`GETBUN(ref I, ref j)`

##### 显示元素

- **Label数组**：显示控制棒位置、燃料温度、热功率、燃耗等参数
- **Image2数组**：显示燃料状态图标（5种状态）
- **Image6数组**：显示控制棒移动模式图标
- **Picture2**：堆芯示意图（5×5网格）

---

#### 12.3.11 CRT示意图面板（SCEMAT_0.cs）

##### 控制元素

- **无直接控制元素**：CRT示意图是纯显示面板，不提供直接控制

##### 显示元素

- **Picture1数组**：显示系统流程图（21个设备位置）
- **Image1-Image8数组**：显示设备状态图标（运行/停止、打开/关闭）
- **Label1数组**：显示33个工艺参数（流量、温度、压力、转速等）

---

### 12.4 控制元素类型总结

#### 12.4.1 滑条（SGSpin）

**功能**：连续调整参数值
**操作方式**：SpinUp增加，SpinDown减少
**常见用途**：
- 功率设定点调整
- 流量微调
- 转速/负荷控制
- 压力设定
- 水位控制
- 控制棒位置调整

#### 12.4.2 按钮（Button/Command）

**功能**：开关控制、模式切换、紧急操作
**操作方式**：单击执行操作
**常见用途**：
- 设备启动/停止
- 阀门打开/关闭
- 自动/手动模式切换
- 紧急停堆/停机
- 燃料更换

#### 12.4.3 图像按钮（PictureBox）

**功能**：可视化控制、状态切换
**操作方式**：单击或MouseDown事件
**常见用途**：
- 设备状态切换（运行/停止）
- 阀门控制（打开/关闭）
- 模式选择
- 图标显示

#### 12.4.4 双击区域（PictureBox）

**功能**：打开选择器或详细信息
**操作方式**：DoubleClick事件
**常见用途**：
- 趋势选择器
- 参数配置

---

### 12.5 显示元素类型总结

#### 12.5.1 标签（Label）

**功能**：显示数值、文本、状态
**显示内容**：
- 工艺参数（流量、温度、压力、转速等）
- 设备状态（运行/停止、打开/关闭）
- 报警信息
- 单位和格式化数据

#### 12.5.2 图像（PictureBox）

**功能**：显示图标、状态指示
**显示内容**：
- 设备运行状态图标
- 阀门状态图标
- 燃料状态图标
- 系统流程图
- 趋势曲线

#### 12.5.3 面板（Panel）

**功能**：容器、分组显示
**显示内容**：
- 堆芯示意图
- 系统流程图
- 控制区域分组

---

### 10.6 数据更新机制

所有面板通过以下机制实时更新：

1. **定时器更新**：通过`model_timer`定时器定期调用显示函数
2. **DLL函数调用**：通过DLL函数获取实时数据
3. **事件驱动**：用户操作触发事件，更新显示
4. **状态检查**：检查设备状态，动态切换图标

---

### 10.7 总结

本章节详细分析了CHRNOBYL RBMK-1000模拟器中所有面板的显示机制和控制元素：

1. **堆芯示意图显示机制**：通过5×5网格的PictureBox数组显示燃料状态，使用5种不同的图标表示不同的燃料状态（新燃料、正常燃料、高燃耗燃料、无燃料、燃料更换中）

2. **CRT示意图显示机制**：通过21个PictureBox显示系统流程图，使用8组图标数组表示设备状态，同时显示33个工艺参数

3. **控制元素类型**：包括滑条（连续调整）、按钮（开关控制）、图像按钮（可视化控制）、双击区域（选择器）

4. **显示元素类型**：包括标签（数值显示）、图像（图标显示）、面板（容器显示）

5. **数据更新机制**：通过定时器、DLL函数、事件驱动和状态检查实现实时更新

这种设计提供了直观的人机界面，操作员可以通过滑条和按钮精确控制各种参数，同时通过图标和标签实时监控系统状态。

---

## 十一、辅助面板显示机制详细分析

### 11.1 反应堆芯状态面板（reactr_0.cs）

#### 界面结构

反应堆芯状态面板使用 `Picture1` 作为主容器（Panel），在其中放置了8个 `Label9` 控件（Label数组），用于显示堆芯的关键参数。

```csharp
// Picture1 是主容器
private Panel _Picture1;

// Label9 是包含8个Label的数组，用于显示堆芯参数
private LabelArray _Label9;
```

#### 显示参数

| 标签索引 | 参数名称 | DLL函数 | 单位 | 说明 |
|----------|----------|---------|------|------|
| Label9[0] | 再循环流量 | CIRFLO[0] | kg/s | 回路1再循环流量 |
| Label9[1] | 再循环流量 | CIRFLO[1] | kg/s | 回路2再循环流量 |
| Label9[2] | 堆芯温度 | GETCOR(0,0,2) | °C | 堆芯区域2温度 |
| Label9[3] | 堆芯温度 | GETCOR(0,0,3) | °C | 堆芯区域3温度 |
| Label9[4] | 控制棒位置 | 1-GETCOR(0,0,3) | % | 控制棒位置（抽出百分比） |
| Label9[5] | 控制棒位置 | 1-GETCOR(0,0,4) | % | 控制棒位置（抽出百分比） |
| Label9[6] | 平均热功率 | avgchp | MW | 堆芯平均热功率 |
| Label9[7] | 氙浓度 | XEN/32 | % | 堆芯氙浓度 |

#### 显示更新函数

```csharp
public static void DISP_REACTR_0()
{
    short num = 0;
    checked
    {
        short num2;
        short num3;
        do
        {
            MyProject.Forms.MainForm.CBStatic.reactr_0.Label9[num].Text = UNITSMDI.FLOWOUT1(ref CIRFLO[num]);
            num = (short)unchecked(num + 1);
            num2 = num;
            num3 = 1;
        }
        while (num2 <= num3);
        num = 2;
        short num4;
        do
        {
            short D = (short)(num + 1);
            short I = 0;
            short j = 0;
            float T = GETCOR(ref I, ref j, ref D);
            MyProject.Forms.MainForm.CBStatic.reactr_0.Label9[num].Text = UNITSMDI.TEMPOUT(ref T);
            num = (short)unchecked(num + 1);
            num4 = num;
            num3 = 3;
        }
        while (num4 <= num3);
        num = 4;
        short num5;
        do
        {
            short D = (short)(num + 1);
            short j = 0;
            short I = 0;
            float T = (float)(1.0 - (double)GETCOR(ref j, ref I, ref D));
            MyProject.Forms.MainForm.CBStatic.reactr_0.Label9[num].Text = Support.Format(T, "##0.0%");
            num = (short)unchecked(num + 1);
            num5 = num;
            num3 = 5;
        }
        while (num5 <= num3);
        MyProject.Forms.MainForm.CBStatic.reactr_0.Label9[6].Text = Support.Format(avgchp, "##0.0%");
        MyProject.Forms.MainForm.CBStatic.reactr_0.Label9[7].Text = Support.Format((double)XEN / 32.0, "###0.0%");
    }
}
```

#### DLL函数说明

| 函数名 | 参数 | 返回值 | 说明 |
|--------|------|--------|------|
| `GETCOR(ref short I, ref short j, ref short D)` | I=0, j=0, D=区域编号 | float | 获取堆芯指定区域的温度或控制棒位置 |
| `CIRFLO[num]` | num=0或1 | float | 获取再循环流量（全局变量） |

---

### 13.2 给水系统面板（feedsys_0.cs）

#### 界面结构

给水系统面板使用 `Picture1` 作为主容器（Panel），在其中放置了10个 `Label3` 控件（Label数组），用于显示给水系统的关键参数。

```csharp
// Picture1 是主容器
private Panel _Picture1;

// Label3 是包含10个Label的数组，用于显示给水系统参数
private LabelArray _Label3;
```

#### 显示参数

| 标签索引 | 参数名称 | DLL函数 | 单位 | 说明 |
|----------|----------|---------|------|------|
| Label3[0] | 汽包压力 | GETDRM(0) | MPa | 汽包压力 |
| Label3[1] | 汽包温度 | GETDRM(1) | °C | 汽包温度 |
| Label3[2] | 汽包水位 | GETDRM(2) | m | 汽包水位 |
| Label3[3] | 汽包蒸汽流量 | GETDRM(3) | kg/s | 汽包蒸汽流量 |
| Label3[4] | 汽包给水流量 | GETDRM(4) | kg/s | 汽包给水流量 |
| Label3[5] | 给水泵状态 | GETFED(0) | % | 给水泵运行状态 |
| Label3[6] | 给水泵流量 | GETFED(1) | kg/s | 给水泵流量 |
| Label3[7] | 给水泵流量 | GETFED(6) | kg/s | 给水泵流量 |
| Label3[8] | 给水泵状态 | GETFED(10) | % | 给水泵运行状态 |
| Label3[9] | 给水泵状态 | GETFED(14) | % | 给水泵运行状态 |

#### 显示更新函数

```csharp
public static void DISP_FEEDSYS_0()
{
    Label label = MyProject.Forms.MainForm.CBStatic.feedsys_0.Label3[0];
    short I = 0;
    float P = GETDRM(ref I);
    label.Text = UNITSMDI.PRESSOUT2(ref P);
    Label label2 = MyProject.Forms.MainForm.CBStatic.feedsys_0.Label3[1];
    I = 1;
    P = GETDRM(ref I);
    label2.Text = UNITSMDI.TEMPOUT(ref P);
    Label label3 = MyProject.Forms.MainForm.CBStatic.feedsys_0.Label3[2];
    I = 2;
    P = GETDRM(ref I);
    label3.Text = UNITSMDI.LEVLOUT1(ref P);
    Label label4 = MyProject.Forms.MainForm.CBStatic.feedsys_0.Label3[3];
    I = 3;
    P = GETDRM(ref I);
    label4.Text = UNITSMDI.FLOWOUT1(ref P);
    Label label5 = MyProject.Forms.MainForm.CBStatic.feedsys_0.Label3[4];
    I = 4;
    P = GETDRM(ref I);
    label5.Text = UNITSMDI.FLOWOUT1(ref P);
    Label label6 = MyProject.Forms.MainForm.CBStatic.feedsys_0.Label3[5];
    I = 0;
    label6.Text = Support.Format(GETFED(ref I), "##0.0%");
    Label label7 = MyProject.Forms.MainForm.CBStatic.feedsys_0.Label3[6];
    I = 1;
    P = GETFED(ref I);
    label7.Text = UNITSMDI.FLOWOUT1(ref P);
    Label label8 = MyProject.Forms.MainForm.CBStatic.feedsys_0.Label3[7];
    I = 6;
    P = GETFED(ref I);
    label8.Text = UNITSMDI.FLOWOUT1(ref P);
    Label label9 = MyProject.Forms.MainForm.CBStatic.feedsys_0.Label3[8];
    I = 10;
    label9.Text = Support.Format(GETFED(ref I), "##0.0%");
    Label label10 = MyProject.Forms.MainForm.CBStatic.feedsys_0.Label3[9];
    I = 14;
    label10.Text = Support.Format(GETFED(ref I), "##0.0%");
}
```

#### DLL函数说明

| 函数名 | 参数 | 返回值 | 说明 |
|--------|------|--------|------|
| `GETDRM(ref short I)` | I=0-4 | float | 获取汽包参数（压力、温度、水位、流量） |
| `GETFED(ref short I)` | I=0,1,6,10,14 | float | 获取给水泵参数（状态、流量） |

---

### 13.3 汽轮机状态面板（turbine_0.cs）

#### 界面结构

汽轮机状态面板使用 `Label1` 作为包含26个Label的数组，用于显示汽轮机的各种参数。

```csharp
// Label1 是包含26个Label的数组，用于显示汽轮机参数
private LabelArray _Label1;
```

#### 显示参数

| 标签索引 | 参数名称 | DLL函数 | 单位 | 说明 |
|----------|----------|---------|------|------|
| Label1[0] | 主蒸汽压力 | GETTRB(13) | MPa | 主蒸汽压力 |
| Label1[1] | 主蒸汽温度 | GETTRB(14) | °C | 主蒸汽温度 |
| Label1[2] | 高压缸排汽温度 | GETTRB(17) | °C | 高压缸排汽温度 |
| Label1[3] | 中压缸排汽温度 | GETTRB(18) | °C | 中压缸排汽温度 |
| Label1[4] | 低压缸排汽温度 | GETTRB(19) | °C | 低压缸排汽温度 |
| Label1[5] | 汽轮机长度 | GETTRB(16) | m | 汽轮机长度 |
| Label1[6] | 给水流量 | GETTRB(10) | kg/s | 给水流量 |
| Label1[7] | 负荷百分比 | GETTRB(41) | % | 汽轮机负荷百分比 |
| Label1[8] | 蒸汽流量 | GETTRB(12) | kg/s | 蒸汽流量 |

#### 显示更新函数

```csharp
public static void disp_turb_0()
{
    short I = 10;
    float X = default(float);
    short tRB = GETTRB(ref X, ref I);
    MyProject.Forms.MainForm.CBStatic.turbine_0.Label1[6].Text = UNITSMDI.FLOWOUT1(ref X);
    I = 12;
    tRB = GETTRB(ref X, ref I);
    MyProject.Forms.MainForm.CBStatic.turbine_0.Label1[8].Text = UNITSMDI.FLOWOUT1(ref X);
    I = 13;
    tRB = GETTRB(ref X, ref I);
    MyProject.Forms.MainForm.CBStatic.turbine_0.Label1[0].Text = UNITSMDI.PRESSOUT2(ref X);
    I = 14;
    tRB = GETTRB(ref X, ref I);
    MyProject.Forms.MainForm.CBStatic.turbine_0.Label1[1].Text = UNITSMDI.TEMPOUT(ref X);
    I = 16;
    tRB = GETTRB(ref X, ref I);
    MyProject.Forms.MainForm.CBStatic.turbine_0.Label1[5].Text = UNITSMDI.LENTOUT2(ref X);
    I = 17;
    tRB = GETTRB(ref X, ref I);
    MyProject.Forms.MainForm.CBStatic.turbine_0.Label1[2].Text = UNITSMDI.TEMPOUT(ref X);
    I = 18;
    tRB = GETTRB(ref X, ref I);
    MyProject.Forms.MainForm.CBStatic.turbine_0.Label1[3].Text = UNITSMDI.TEMPOUT(ref X);
    I = 19;
    tRB = GETTRB(ref X, ref I);
    MyProject.Forms.MainForm.CBStatic.turbine_0.Label1[4].Text = UNITSMDI.TEMPOUT(ref X);
    I = 41;
    tRB = GETTRB(ref X, ref I);
    MyProject.Forms.MainForm.CBStatic.turbine_0.Label1[7].Text = Support.Format(X, "##0.0%");
}
```

#### DLL函数说明

| 函数名 | 参数 | 返回值 | 说明 |
|--------|------|--------|------|
| `GETTRB(ref float X, ref short I)` | I=10,12,13,14,16,17,18,19,41 | float | 获取汽轮机参数（流量、压力、温度、长度、负荷） |

---

### 11.4 除氧器面板（DEAER_0.cs）

#### 界面结构

除氧器面板使用 `Label1` 作为包含10个Label的数组，用于显示除氧器的各种参数。

```csharp
// Label1 是包含10个Label的数组，用于显示除氧器参数
private LabelArray _Label1;
```

#### 显示参数

| 标签索引 | 参数名称 | DLL函数 | 单位 | 说明 |
|----------|----------|---------|------|------|
| Label1[0] | 凝结水流量 | GETDAR(9) | kg/s | 凝结水流量 |
| Label1[1] | 抽汽流量 | GETDAR(8) | kg/s | 抽汽流量 |
| Label1[2] | 除氧器压力 | GETDAR(5) | MPa | 除氧器压力 |
| Label1[3] | 除氧器水位 | GETDAR(3) | m | 除氧器水位 |
| Label1[4] | 除氧器温度 | GETDAR(4) | °C | 除氧器温度 |
| Label1[5] | 给水流量 | GETFED(1) | kg/s | 给水流量 |
| Label1[6] | 除氧器出口流量 | GETDAR(7) | kg/s | 除氧器出口流量 |
| Label1[8] | 补水流量 | GETDAR(17) | kg/s | 补水流量 |
| Label1[9] | 蒸汽流量 | GETDAR(18) | kg/s | 蒸汽流量 |

#### 显示更新函数

```csharp
public static void DISP_DEAER_0()
{
    short I = 17;
    float X = default(float);
    short dAR = GETDAR(ref X, ref I);
    MyProject.Forms.MainForm.CBStatic.DEAER_0.Label1[8].Text = UNITSMDI.FLOWOUT1(ref X);
    I = 9;
    dAR = GETDAR(ref X, ref I);
    MyProject.Forms.MainForm.CBStatic.DEAER_0.Label1[0].Text = UNITSMDI.FLOWOUT1(ref X);
    I = 8;
    dAR = GETDAR(ref X, ref I);
    MyProject.Forms.MainForm.CBStatic.DEAER_0.Label1[1].Text = UNITSMDI.FLOWOUT1(ref X);
    I = 18;
    dAR = GETDAR(ref X, ref I);
    MyProject.Forms.MainForm.CBStatic.DEAER_0.Label1[9].Text = UNITSMDI.FLOWOUT1(ref X);
    I = 5;
    dAR = GETDAR(ref X, ref I);
    MyProject.Forms.MainForm.CBStatic.DEAER_0.Label1[2].Text = UNITSMDI.PRESSOUT2(ref X);
    I = 3;
    dAR = GETDAR(ref X, ref I);
    MyProject.Forms.MainForm.CBStatic.DEAER_0.Label1[3].Text = UNITSMDI.LEVLOUT1(ref X);
    I = 4;
    dAR = GETDAR(ref X, ref I);
    MyProject.Forms.MainForm.CBStatic.DEAER_0.Label1[4].Text = UNITSMDI.TEMPOUT(ref X);
    Label label = MyProject.Forms.MainForm.CBStatic.DEAER_0.Label1[5];
    I = 1;
    float F = GETFED(ref I);
    label.Text = UNITSMDI.FLOWOUT1(ref F);
    I = 7;
    dAR = GETDAR(ref X, ref I);
    MyProject.Forms.MainForm.CBStatic.DEAER_0.Label1[6].Text = UNITSMDI.FLOWOUT1(ref X);
}
```

#### DLL函数说明

| 函数名 | 参数 | 返回值 | 说明 |
|--------|------|--------|------|
| `GETDAR(ref float X, ref short I)` | I=3,4,5,7,8,9,17,18 | float | 获取除氧器参数（水位、温度、压力、流量） |
| `GETFED(ref short I)` | I=1 | float | 获取给水流量 |

---

### 11.5 凝汽器面板（CNDSR_0.cs）

#### 界面结构

凝汽器面板使用 `Label4` 和 `Label10` 作为Label数组，用于显示凝汽器的各种参数和状态。

```csharp
// Label4 是包含4个Label的数组，用于显示泵状态
private LabelArray _Label4;

// Label10 是包含4个Label的数组，用于显示凝汽器参数
private LabelArray _Label10;
```

#### 显示参数

| 标签索引 | 参数名称 | DLL函数 | 单位 | 说明 |
|----------|----------|---------|------|------|
| Label10[0] | 凝汽器压力 | GETCND(0) | kPa | 凝汽器压力 |
| Label10[1] | 凝汽器温度 | GETCND(1) | °C | 凝汽器温度 |
| Label10[2] | 循环水流量 | GETCND(23) | kg/s | 循环水流量 |
| Label10[3] | 凝汽器温度 | GETCND(4) | °C | 凝汽器温度 |
| Label10[4] | 凝汽器温度 | GETCND(5) | °C | 凝汽器温度 |
| Label4[0-3] | 循环水泵状态 | GETCND(6-9) | - | 循环水泵运行状态（颜色指示） |

#### 显示更新函数

```csharp
public static void DISP_CNDSR_0()
{
    short num = 0;
    checked
    {
        short num2;
        short num3;
        short I;
        do
        {
            I = (short)Math.Round(6.0 + (double)num / 2.0);
            if ((double)GETCND(ref I) > 0.5)
            {
                MyProject.Forms.MainForm.CBStatic.CNDSR_0.Label4[num].ForeColor = ColorTranslator.FromOle(Information.QBColor(12));
                MyProject.Forms.MainForm.CBStatic.CNDSR_0.Label4[(short)(num + 1)].ForeColor = ColorTranslator.FromOle(Information.QBColor(4));
            }
            else
            {
                MyProject.Forms.MainForm.CBStatic.CNDSR_0.Label4[num].ForeColor = ColorTranslator.FromOle(Information.QBColor(4));
                MyProject.Forms.MainForm.CBStatic.CNDSR_0.Label4[(short)(num + 1)].ForeColor = ColorTranslator.FromOle(Information.QBColor(12));
            }
            num = (short)unchecked(num + 2);
            num2 = num;
            num3 = 2;
        }
        while (num2 <= num3);
        Label label = MyProject.Forms.MainForm.CBStatic.CNDSR_0.Label3[0];
        I = 23;
        float F = GETCND(ref I);
        label.Text = UNITSMDI.FLOWOUT3(ref F);
        Label label2 = MyProject.Forms.MainForm.CBStatic.CNDSR_0.Label10[0];
        I = 0;
        F = GETCND(ref I);
        label2.Text = UNITSMDI.PRESSOUT3(ref F);
        Label label3 = MyProject.Forms.MainForm.CBStatic.CNDSR_0.Label10[1];
        I = 1;
        F = GETCND(ref I);
        label3.Text = UNITSMDI.TEMPOUT(ref F);
        Label label4 = MyProject.Forms.MainForm.CBStatic.CNDSR_0.Label10[2];
        I = 4;
        F = GETCND(ref I);
        label4.Text = UNITSMDI.TEMPOUT(ref F);
        Label label5 = MyProject.Forms.MainForm.CBStatic.CNDSR_0.Label10[3];
        I = 5;
        F = GETCND(ref I);
        label5.Text = UNITSMDI.TEMPOUT(ref F);
    }
}
```

#### DLL函数说明

| 函数名 | 参数 | 返回值 | 说明 |
|--------|------|--------|------|
| `GETCND(ref short I)` | I=0,1,4,5,6,7,8,9,23 | float | 获取凝汽器参数（压力、温度、泵状态、流量） |

---

### 11.6 汽轮机辅助系统面板（turb_aux.cs）

#### 界面结构

汽轮机辅助系统面板使用 `Label1` 作为包含3个Label的数组，以及 `Image2`、`Image3`、`Image4`、`Image5` 作为PictureBox数组，用于显示辅助系统的参数和状态。

```csharp
// Label1 是包含3个Label的数组，用于显示辅助系统压力
private LabelArray _Label1;

// Image2-Image5 是包含2个PictureBox的数组，用于显示泵状态
private PictureBoxArray _Image2;
private PictureBoxArray _Image3;
private PictureBoxArray _Image4;
private PictureBoxArray _Image5;
```

#### 显示参数

| 标签索引 | 参数名称 | DLL函数 | 单位 | 说明 |
|----------|----------|---------|------|------|
| Label1[0] | 润滑油压力 | GETTRB(37) | MPa | 润滑油压力 |
| Label1[1] | 冷却水压力 | GETTRB(38) | MPa | 冷却水压力 |
| Label1[2] | 密封水压力 | GETTRB(39) | MPa | 密封水压力 |

#### 状态指示

| 图标数组 | 设备 | DLL函数 | 状态 |
|----------|------|---------|------|
| Image2 | 润滑油泵 | GETTRB(33) | 1=运行，0=停止 |
| Image3 | 冷却水泵 | GETTRB(34) | 1=运行，0=停止 |
| Image4 | 真空泵 | GETTRB(35) | 1=运行，0=停止 |
| Image5 | 密封水泵 | GETTRB(36) | 1=运行，0=停止 |

#### 显示更新函数

```csharp
public static void disp_turb_aux()
{
    short num = 0;
    checked
    {
        float X = default(float);
        short num2;
        short num3;
        short tRB;
        do
        {
            short I = (short)(37 + num);
            tRB = GETTRB(ref X, ref I);
            MyProject.Forms.MainForm.CBStatic.turb_aux.Label1[num].Text = UNITSMDI.PRESSOUT2(ref X);
            num = (short)unchecked(num + 1);
            num2 = num;
            num3 = 2;
        }
        while (num2 <= num3);
        short I2 = 33;
        float X2 = default(float);
        tRB = GETTRB(ref X2, ref I2);
        if (X2 == 1f)
        {
            if (!MyProject.Forms.MainForm.CBStatic.turb_aux.Image2[1].Image.Equals(MyProject.Forms.MainForm.CBStatic.turb_aux.Image1[1].Image))
            {
                MyProject.Forms.MainForm.CBStatic.turb_aux.Image2[0].Image = MyProject.Forms.MainForm.CBStatic.turb_aux.Image1[0].Image;
                MyProject.Forms.MainForm.CBStatic.turb_aux.Image2[1].Image = MyProject.Forms.MainForm.CBStatic.turb_aux.Image1[1].Image;
            }
        }
        else if (X2 == 0f && !MyProject.Forms.MainForm.CBStatic.turb_aux.Image2[0].Image.Equals(MyProject.Forms.MainForm.CBStatic.turb_aux.Image1[2].Image))
        {
            MyProject.Forms.MainForm.CBStatic.turb_aux.Image2[0].Image = MyProject.Forms.MainForm.CBStatic.turb_aux.Image1[2].Image;
            MyProject.Forms.MainForm.CBStatic.turb_aux.Image2[1].Image = MyProject.Forms.MainForm.CBStatic.turb_aux.Image1[0].Image;
        }
        // ... 其他泵的状态更新逻辑类似
    }
}
```

#### DLL函数说明

| 函数名 | 参数 | 返回值 | 说明 |
|--------|------|--------|------|
| `GETTRB(ref float X, ref short I)` | I=33-39 | float | 获取汽轮机辅助系统参数（泵状态、压力） |

---

### 11.7 辅助面板显示机制总结

#### 显示机制特点

1. **统一的数据获取接口**：所有辅助面板都通过DLL函数获取实时数据
   - `GETDRM()` - 获取汽包参数
   - `GETCOR()` - 获取堆芯参数
   - `GETTRB()` - 获取汽轮机参数
   - `GETCND()` - 获取凝汽器参数
   - `GETDAR()` - 获取除氧器参数
   - `GETFED()` - 获取给水泵参数

2. **统一的显示更新函数**：每个面板都有对应的 `DISP_XXX()` 函数
   - `DISP_REACTR_0()` - 更新反应堆芯状态面板
   - `DISP_FEEDSYS_0()` - 更新给水系统面板
   - `disp_turb_0()` - 更新汽轮机状态面板
   - `DISP_DEAER_0()` - 更新除氧器面板
   - `DISP_CNDSR_0()` - 更新凝汽器面板
   - `disp_turb_aux()` - 更新汽轮机辅助系统面板

3. **统一的界面结构**：
   - 使用 `Panel` 作为主容器
   - 使用 `LabelArray` 显示数值参数
   - 使用 `PictureBoxArray` 显示状态图标
   - 背景图片用于显示系统流程图

4. **统一的单位转换**：通过 `UNITSMDI` 类的方法进行单位转换
   - `PRESSOUT2()` - 压力单位转换（MPa）
   - `TEMPOUT()` - 温度单位转换（°C）
   - `FLOWOUT1()` - 流量单位转换（kg/s）
   - `LEVLOUT1()` - 水位单位转换（m）
   - `LENTOUT2()` - 长度单位转换（m）

5. **统一的状态指示**：
   - 使用颜色区分状态（红色=运行/开启，绿色=停止/关闭）
   - 使用图标切换显示设备状态
   - 使用百分比显示相对参数

#### 数据更新流程

1. 定时器触发更新（通常每100-500ms）
2. 调用对应的 `DISP_XXX()` 函数
3. 通过DLL函数获取最新数据
4. 更新Label的Text属性显示数值
5. 更新PictureBox的Image属性显示状态图标
6. 更新Label的ForeColor属性显示状态颜色

#### 显示参数分类

| 参数类型 | 显示方式 | 示例 |
|----------|----------|------|
| 压力 | Label.Text + 单位转换 | 主蒸汽压力：15.5 MPa |
| 温度 | Label.Text + 单位转换 | 主蒸汽温度：280 °C |
| 流量 | Label.Text + 单位转换 | 给水流量：500 kg/s |
| 水位 | Label.Text + 单位转换 | 汽包水位：3.5 m |
| 百分比 | Label.Text + 格式化 | 控制棒位置：75.0% |
| 状态 | PictureBox.Image + 颜色 | 泵运行/停止图标 |

这种设计确保了所有辅助面板具有一致的显示风格和用户体验，同时通过DLL接口实现了与物理模型的实时数据交互。

---

## 十二、结论与建议

### 12.1 主要发现

通过对项目代码、CHRNOBYL RBMK-1000模拟器、物理公式文档和切尔诺贝利遗产延续手册的深度分析，我们得出以下主要发现：

**当前模拟器的优势**：
1. 基本功能完整：实现了22个控制面板和基本的物理模拟系统
2. 界面友好：提供了直观的用户界面
3. 可扩展性强：代码架构支持进一步的扩展和优化

**当前模拟器的不足**：
1. 物理模型简化：缺乏真实的热工水力计算和中子物理模型
2. 参数不准确：许多参数与真实RBMK-1000系统不符
3. 系统间耦合不足：各系统之间的相互影响不够详细
4. 缺乏高级特性：如故障模拟、预测算法等

### 12.2 优先级建议

基于以上发现，我们提出以下优先级建议：

**高优先级**：
1. 实现质量守恒和能量守恒方程
2. 实现正空泡系数效应
3. 实现氙-135中毒效应
4. 校准所有参数以匹配真实RBMK-1000系统
5. 实现系统间详细耦合

**中优先级**：
1. 实现三冲量水位控制
2. 实现汽轮机旁路系统
3. 实现故障模拟系统
4. 改进用户界面
5. 实现操作确认机制

**低优先级**：
1. 实现虚拟现实界面
2. 实现语音控制
3. 实现AI辅助决策
4. 实现预测算法
5. 实现优化建议系统

### 12.3 预期成果

通过实施以上建议，我们预期达到以下成果：

**短期成果（1-2个月）**：
- 基础物理模型运行正常
- 用户界面更加直观和易用
- 代码架构更加清晰和可维护
- 性能提升30-50%

**中期成果（2-3个月）**：
- 物理模型更加准确和真实
- 系统功能更加完整
- 用户界面更加功能丰富
- 模拟器真实性提升50-70%

**长期成果（3-4个月）**：
- 物理模型达到专业级精度
- 系统功能完全实现
- 用户界面达到现代化水平
- 模拟器真实性提升80-100%
- 性能提升50-70%

### 12.4 实施建议

**分阶段实施**：
- 建议分三个阶段实施优化计划
- 每个阶段都有明确的目标和任务
- 每个阶段完成后进行评估和调整

**持续改进**：
- 建立持续改进机制
- 定期评估模拟器的性能
- 根据评估结果进行改进

**用户反馈**：
- 收集用户反馈
- 根据用户反馈进行改进
- 确保改进符合用户需求

**文档完善**：
- 完善技术文档
- 提供详细的用户手册
- 建立知识库

### 12.5 风险评估

**技术风险**：
- 物理模型实现复杂度高
- 需要专业的核工程知识
- 可能需要外部专家支持

**时间风险**：
- 优化计划时间较长
- 可能遇到技术难题
- 需要合理安排时间

**资源风险**：
- 需要投入大量资源
- 可能需要额外的资金支持
- 需要协调多个团队

**建议**：
- 建立风险管理机制
- 制定应急预案
- 定期进行风险评估

---

## 附录

### 附录A：术语表

- **RBMK**：俄语缩写，意为"大功率管道式反应堆"
- **SCRAM**：紧急停堆
- **ECCS**：紧急堆芯冷却系统
- **HEPA**：高效 particulate 空气过滤器
- **IAPWS-97**：国际水和蒸汽性质协会1997年标准

### 附录B：参考文献

1. 切尔诺贝利遗产延续手册
2. CHRNOBYL RBMK-1000模拟器源代码
3. 核反应堆物理教科书
4. IAPWS-97标准文档
5. RBMK-1000技术手册

### 附录C：联系方式

如有任何问题或建议，请联系项目团队。

---

**文档版本**：1.0  
**最后更新**：2026年2月15日  
**文档作者**：项目团队
